"use strict";

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

!function (e, t) {
  if ("object" == (typeof exports === "undefined" ? "undefined" : _typeof(exports)) && "object" == (typeof module === "undefined" ? "undefined" : _typeof(module))) module.exports = t();else if ("function" == typeof define && define.amd) define([], t);else {
    var n = t();for (var i in n) {
      ("object" == (typeof exports === "undefined" ? "undefined" : _typeof(exports)) ? exports : e)[i] = n[i];
    }
  }
}(undefined, function () {
  return function (e) {
    function t(i) {
      if (n[i]) return n[i].exports;var r = n[i] = { exports: {}, id: i, loaded: !1 };return e[i].call(r.exports, r, r.exports, t), r.loaded = !0, r.exports;
    }var n = {};return t.m = e, t.c = n, t.p = "", t(0);
  }([function (e, t, n) {
    "use strict";
    function i(e) {
      return e && e.__esModule ? e : { default: e };
    }Object.defineProperty(t, "__esModule", { value: !0 }), t.RabbitMQ = void 0;var r = n(1),
        o = i(r);t.RabbitMQ = o.default;
  }, function (e, t, n) {
    "use strict";
    function i(e) {
      return e && e.__esModule ? e : { default: e };
    }function r(e, t) {
      if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function");
    }function o(e) {
      if (console.log(e.client.ws), 3 == e.client.ws.readyState) {
        e.client._cleanUp();var t = e.client.debug,
            n = e.client.onreceive,
            i = new WebSocket(e.url);e.client = a.default.over(i), e.client.debug = t, e.client.onreceive = n, e.client.connect(e.usr, e.passwd, function () {
          console.log("reconnect to " + e.url);var t = e.subCallBack;e.subCallBack = {};for (var n in t) {
            e.subscribe(n, t[n].callback);
          }
        }, function () {
          return console.log("error");
        }, e.host), i.onclose = function () {
          return o(e);
        }, console.log(e.client.ws);
      }
    }Object.defineProperty(t, "__esModule", { value: !0 });var s = function () {
      function e(e, t) {
        for (var n = 0; n < t.length; n++) {
          var i = t[n];i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i);
        }
      }return function (t, n, i) {
        return n && e(t.prototype, n), i && e(t, i), t;
      };
    }(),
        u = n(2),
        a = i(u),
        c = function () {
      function e(t, n, i, s) {
        var u = this;r(this, e), this.url = t, this.usr = n, this.passwd = i, this.host = s;var c = new WebSocket(t);this.rpcCallBack = {}, this.subCallBack = {}, this.client = a.default.over(c), this.client.connect(n, i, function () {
          console.log("connect to " + t), u.onConnected && u.onConnected();
        }, function () {
          console.log("error"), u.onError && u.onError();
        }, s), this.count = 0, this.onreceive = function (e) {
          var t = null;e.headers.rpc_id && (t = u.rpcCallBack[e.headers.rpc_id]) ? (t(e), delete u.rpcCallBack[e.headers.rpc_id]) : (console.log("unhandled message:"), console.log(e));
        }, c.onclose = function () {
          return o(u);
        };
      }return s(e, [{ key: "subscribe", value: function value(e, t) {
          var n = this.client.subscribe(e, t);return n.destination = e, this.subCallBack[e] = { callback: t, id: n.id }, n;
        } }, { key: "unsubscribe", value: function value(e) {
          var t = this.subCallBack[e.destination];t && (this.client.unsubscribe(t.id), delete this.subCallBack[e.destination]);
        } }, { key: "send", value: function value(e, t) {
          return this.client.send(e, null, t);
        } }, { key: "call", value: function value(e, t, n) {
          var i = { "reply-to": "/temp-queue/rpc", rpc_id: this.count };return this.rpcCallBack[this.count++] = n, this.client.send(e, i, t);
        } }, { key: "debug", set: function set(e) {
          this.client.debug = e;
        } }, { key: "onreceive", set: function set(e) {
          this.client.onreceive = e;
        } }]), e;
    }();t.default = c;
  }, function (e, t) {
    "use strict";
    function n(e, t) {
      if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function");
    }Object.defineProperty(t, "__esModule", { value: !0 });var i,
        r,
        o,
        s,
        u = "function" == typeof Symbol && "symbol" == _typeof(Symbol.iterator) ? function (e) {
      return typeof e === "undefined" ? "undefined" : _typeof(e);
    } : function (e) {
      return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e === "undefined" ? "undefined" : _typeof(e);
    },
        a = function () {
      function e(e, t) {
        for (var n = 0; n < t.length; n++) {
          var i = t[n];i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i);
        }
      }return function (t, n, i) {
        return n && e(t.prototype, n), i && e(t, i), t;
      };
    }(),
        c = {}.hasOwnProperty,
        l = [].slice;i = { LF: "\n", NULL: "\0" }, o = function () {
      function e(e) {
        var n, r, o, s, u, a, c, l, f, h, d, b, p, g, v, y, m;for (s = e.search(RegExp("" + i.LF + i.LF)), u = e.substring(0, s).split(i.LF), o = u.shift(), a = {}, b = function b(e) {
          return e.replace(/^\s+|\s+$/g, "");
        }, y = u.reverse(), p = 0, v = y.length; p < v; p++) {
          h = y[p], l = h.indexOf(":"), a[b(h.substring(0, l))] = b(h.substring(l + 1));
        }if (n = "", d = s + 2, a["content-length"]) f = parseInt(a["content-length"]), n = ("" + e).substring(d, d + f);else for (r = null, c = g = d, m = e.length; (d <= m ? g < m : g > m) && (r = e.charAt(c), r !== i.NULL); c = d <= m ? ++g : --g) {
          n += r;
        }return new t(o, a, n);
      }var t = function () {
        function t(e, i, r) {
          n(this, t), this.command = e, this.headers = null != i ? i : {};try {
            if (/^\s*(\{.*\}|\[.*\])\s*$/.test(r)) {
              var o = JSON.parse(r);o && (r = o);
            }
          } catch (e) {}this.body = null != r ? r : "";
        }return a(t, [{ key: "toString", value: function value() {
            var e, n, r, o, s;e = [this.command], r = this.headers["content-length"] === !1, r && delete this.headers["content-length"], s = this.headers;for (n in s) {
              c.call(s, n) && (o = s[n], e.push("" + n + ":" + o));
            }var a = this.body;return a && "object" === ("undefined" == typeof a ? "undefined" : u(a)) && (a = JSON.stringify(a)), a && !r && e.push("content-length:" + t.sizeOfUTF8(a)), e.push(i.LF + a), e.join(i.LF);
          } }], [{ key: "sizeOfUTF8", value: function value(e) {
            return e ? encodeURI(e).match(/%..|./g).length : 0;
          } }, { key: "unmarshall", value: function value(t) {
            var n, r, o, s;return r = t.split(RegExp("" + i.NULL + i.LF + "*")), s = { frames: [], partial: "" }, s.frames = function () {
              var t, i, o, s;for (o = r.slice(0, -1), s = [], t = 0, i = o.length; t < i; t++) {
                n = o[t], s.push(e(n));
              }return s;
            }(), o = r.slice(-1)[0], o === i.LF || o.search(RegExp("" + i.NULL + i.LF + "*$")) !== -1 ? s.frames.push(e(o)) : s.partial = o, s;
          } }, { key: "marshall", value: function value(e, n, r) {
            var o;return o = new t(e, n, r), o.toString() + i.NULL;
          } }]), t;
      }();return t;
    }(), r = function () {
      function e() {
        return Date.now ? Date.now() : new Date().valueOf;
      }var t = function () {
        function t(e) {
          n(this, t), this.ws = e, this.ws.binaryType = "arraybuffer", this.counter = 0, this.connected = !1, this.heartbeat = { outgoing: 1e4, incoming: 1e4 }, this.maxWebSocketFrameSize = 16384, this.subscriptions = {}, this.partialData = "", this.debug = null;
        }return a(t, [{ key: "_transmit", value: function value(e, t, n) {
            var i;for (i = o.marshall(e, t, n), "function" == typeof this.debug && this.debug(">>> " + i);;) {
              if (!(i.length > this.maxWebSocketFrameSize)) return this.ws.send(i);this.ws.send(i.substring(0, this.maxWebSocketFrameSize)), i = i.substring(this.maxWebSocketFrameSize), "function" == typeof this.debug && this.debug("remaining = " + i.length);
            }
          } }, { key: "_setupHeartbeat", value: function value(e) {
            var t, n, r, o, u, a;(u = e.version) !== s.VERSIONS.V1_1 && u !== s.VERSIONS.V1_2 || (a = function () {
              var t, n, i, r;for (i = e["heart-beat"].split(","), r = [], t = 0, n = i.length; t < n; t++) {
                o = i[t], r.push(parseInt(o));
              }return r;
            }(), n = a[0], t = a[1], 0 !== this.heartbeat.outgoing && 0 !== t && (r = Math.max(this.heartbeat.outgoing, t), "function" == typeof this.debug && this.debug("send PING every " + r + "ms"), this.pinger = s.setInterval(r, function (e) {
              return function () {
                return e.ws.send(i.LF), "function" == typeof e.debug ? e.debug(">>> PING") : void 0;
              };
            }(this))), 0 !== this.heartbeat.incoming && 0 !== n && (r = Math.max(this.heartbeat.incoming, n), "function" == typeof this.debug && this.debug("check PONG every " + r + "ms")));
          } }, { key: "_parseConnect", value: function value() {
            var e, t, n, i;switch (e = 1 <= arguments.length ? l.call(arguments, 0) : [], i = {}, e.length) {case 2:
                i = e[0], t = e[1];break;case 3:
                e[1] instanceof Function ? (i = e[0], t = e[1], n = e[2]) : (i.login = e[0], i.passcode = e[1], t = e[2]);break;case 4:
                i.login = e[0], i.passcode = e[1], t = e[2], n = e[3];break;default:
                i.login = e[0], i.passcode = e[1], t = e[2], n = e[3], i.host = e[4];}return [i, t, n];
          } }, { key: "connect", value: function value() {
            var t, n, r, u;return t = 1 <= arguments.length ? l.call(arguments, 0) : [], u = this._parseConnect.apply(this, t), r = u[0], this.connectCallback = u[1], n = u[2], "function" == typeof this.debug && this.debug("Opening Web Socket..."), this.ws.onmessage = function (t) {
              return function (r) {
                var s, u, a, c, l, f, h, d, b, p, g, v, y;if (c = "undefined" != typeof ArrayBuffer && r.data instanceof ArrayBuffer ? (s = new Uint8Array(r.data), "function" == typeof t.debug ? t.debug("--- got data length: " + s.length) : void 0, function () {
                  var e, t, n;for (n = [], e = 0, t = s.length; e < t; e++) {
                    u = s[e], n.push(String.fromCharCode(u));
                  }return n;
                }().join("")) : r.data, t.serverActivity = e(), c === i.LF) return void ("function" == typeof t.debug && t.debug("<<< PONG"));for ("function" == typeof t.debug && t.debug("<<< " + c), b = o.unmarshall(t.partialData + c), t.partialData = b.partial, v = b.frames, y = [], p = 0, g = v.length; p < g; p++) {
                  switch (l = v[p], l.command) {case "CONNECTED":
                      "function" == typeof t.debug && t.debug("connected to server " + l.headers.server), t.connected = !0, t._setupHeartbeat(l.headers), y.push("function" == typeof t.connectCallback ? t.connectCallback(l) : void 0);break;case "MESSAGE":
                      d = l.headers.subscription, h = t.subscriptions[d] || t.onreceive, h ? (a = t, f = l.headers["message-id"], l.ack = function (e) {
                        return null == e && (e = {}), a.ack(f, d, e);
                      }, l.nack = function (e) {
                        return null == e && (e = {}), a.nack(f, d, e);
                      }, y.push(h(l))) : y.push("function" == typeof t.debug ? t.debug("Unhandled received MESSAGE: " + l) : void 0);break;case "RECEIPT":
                      y.push("function" == typeof t.onreceipt ? t.onreceipt(l) : void 0);break;case "ERROR":
                      y.push("function" == typeof n ? n(l) : void 0);break;default:
                      y.push("function" == typeof t.debug ? t.debug("Unhandled frame: " + l) : void 0);}
                }return y;
              };
            }(this), this.ws.onclose = function (e) {
              return function () {
                var t;return t = "Whoops! Lost connection to " + e.ws.url, "function" == typeof e.debug && e.debug(t), e._cleanUp(), "function" == typeof n ? n(t) : void 0;
              };
            }(this), this.ws.onopen = function (e) {
              return function () {
                return "function" == typeof e.debug && e.debug("Web Socket Opened..."), r["accept-version"] = s.VERSIONS.supportedVersions(), r["heart-beat"] = [e.heartbeat.outgoing, e.heartbeat.incoming].join(","), e._transmit("CONNECT", r);
              };
            }(this);
          } }, { key: "disconnect", value: function value(e, t) {
            return null == t && (t = {}), this._transmit("DISCONNECT", t), this.ws.onclose = null, this.ws.close(), this._cleanUp(), "function" == typeof e ? e() : void 0;
          } }, { key: "_cleanUp", value: function value() {
            if (this.connected = !1, this.pinger && s.clearInterval(this.pinger), this.ponger) return s.clearInterval(this.ponger);
          } }, { key: "send", value: function value(e, t, n) {
            return null == t && (t = {}), null == n && (n = ""), t.destination = e, this._transmit("SEND", t, n);
          } }, { key: "subscribe", value: function value(e, t, n) {
            var i;return null == n && (n = {}), n.id || (n.id = "sub-" + this.counter++), n.destination = e, this.subscriptions[n.id] = t, this._transmit("SUBSCRIBE", n), i = this, { id: n.id, unsubscribe: function unsubscribe() {
                return i.unsubscribe(n.id);
              } };
          } }, { key: "unsubscribe", value: function value(e) {
            return delete this.subscriptions[e], this._transmit("UNSUBSCRIBE", { id: e });
          } }, { key: "begin", value: function value(e) {
            var t, n;return n = e || "tx-" + this.counter++, this._transmit("BEGIN", { transaction: n }), t = this, { id: n, commit: function commit() {
                return t.commit(n);
              }, abort: function abort() {
                return t.abort(n);
              } };
          } }, { key: "commit", value: function value(e) {
            return this._transmit("COMMIT", { transaction: e });
          } }, { key: "abort", value: function value(e) {
            return this._transmit("ABORT", { transaction: e });
          } }, { key: "ack", value: function value(e, t, n) {
            return null == n && (n = {}), n["message-id"] = e, n.subscription = t, this._transmit("ACK", n);
          } }, { key: "nack", value: function value(e, t, n) {
            return null == n && (n = {}), n["message-id"] = e, n.subscription = t, this._transmit("NACK", n);
          } }]), t;
      }();return t;
    }(), s = { VERSIONS: { V1_0: "1.0", V1_1: "1.1", V1_2: "1.2", supportedVersions: function supportedVersions() {
          return "1.1,1.0";
        } }, client: function client(e, t) {
        var n, i;return null == t && (t = ["v10.stomp", "v11.stomp"]), n = s.WebSocketClass || WebSocket, i = new n(e, t), new r(i);
      }, over: function over(e) {
        return new r(e);
      }, Frame: o, setInterval: function setInterval(e, t) {
        return window.setInterval(t, e);
      }, clearInterval: function clearInterval(e) {
        return window.clearInterval(e);
      } }, t.default = s;
  }]);
});
//# sourceMappingURL=rabbitMQ.min.js.map