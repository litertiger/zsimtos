{
 "hidden": true,
 "children": [{
  "configs": {
   "head": "<script src=\"supcan/binary/dynaload.js?109\"><\/script>\
<script>\
  var locrec;\
  function OnReady(id)\
  {\
    if(id=='AF1'){\
      AF1.func(\"Build\", 'supcan/report/bill/vbillHead.xml');\
      AF1.func(\"Build\", 'supcan/report/bill/vbillHead.xml');\
    }\
  }\
  function OnEvent(id, Event, p1, p2, p3, p4){}\
<\/script>\
",
   "itemId": "module"
  },
  "expanded": true,
  "children": [
   {
    "configs": {
     "layout": "border",
     "itemId": "disWin",
     "dialog": "true",
     "closeAction": "hide",
     "width": "500",
     "height": "400"
    },
    "expanded": false,
    "children": [
     {
      "configs": {
       "itemId": "tbar",
       "region": "north"
      },
      "expanded": true,
      "children": [{
       "configs": {
        "itemId": "W_TYPE",
        "width": "200"
       },
       "expanded": true,
       "children": [
        {
         "configs": {
          "itemId": "radio1",
          "boxLabel": "班组   ",
          "flex": "1",
          "checked": "true"
         },
         "expanded": false,
         "children": [],
         "type": "radio"
        },
        {
         "configs": {
          "itemId": "radio2",
          "boxLabel": "拖车  ",
          "flex": "1"
         },
         "expanded": false,
         "children": [],
         "type": "radio"
        },
        {
         "configs": {
          "itemId": "radio4",
          "boxLabel": "设备  ",
          "flex": "1"
         },
         "expanded": false,
         "children": [],
         "type": "radio"
        }
       ],
       "type": "radiogroup",
       "events": {"change": "app.disGrid.store.load({\
  params: {\
    taskId: app.taskId,\
    type:newValue\
  }\
});"}
      }],
      "type": "toolbar"
     },
     {
      "configs": {
       "itemId": "disGrid",
       "selType": "checkboxmodel",
       "disabled": "false",
       "region": "center",
       "multiSelect": "true"
      },
      "expanded": true,
      "children": [
       {
        "configs": {
         "groupField": "WTYPE",
         "itemId": "store",
         "pageSize": "-1",
         "sorters": "'ID'",
         "url": "m?xwl=controlManage/task/worktaskcraneedit/unselect"
        },
        "expanded": false,
        "children": [],
        "type": "store"
       },
       {
        "configs": {"itemId": "columns"},
        "expanded": true,
        "children": [
         {
          "configs": {
           "itemId": "colID",
           "hidden": "true",
           "dataIndex": "ID",
           "text": "ID"
          },
          "expanded": false,
          "children": [],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "colTENANCY_ID",
           "hidden": "true",
           "dataIndex": "TENANCY_ID",
           "text": "租户"
          },
          "expanded": false,
          "children": [],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "column1",
           "xtype": "rownumberer"
          },
          "expanded": false,
          "children": [],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "colRESOURCE_ID",
           "dataIndex": "RESOURCE_ID",
           "width": "80",
           "text": "工号"
          },
          "expanded": false,
          "children": [],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "RESOURCE_NAMECOLUMN",
           "dataIndex": "RESOURCE_NAME",
           "width": "80",
           "text": "名称"
          },
          "expanded": false,
          "children": [],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "RESOURCE_NAMECOLUMN1",
           "dataIndex": "GROUPING",
           "width": "80",
           "keyName": "C_EMPLOYEE_TEAM",
           "text": "班组"
          },
          "expanded": false,
          "children": [],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "colW_TYPE",
           "renderer": "if (value == '0') {\
  return \"操作人员\";\
}\
if (value == '1') {\
  return \"车辆\";\
}\
if (value == '2') {\
  return \"拖卡\";\
}\
if (value == '3') {\
  return \"场内机械设备\";\
}",
           "hidden": "true",
           "dataIndex": "W_TYPE",
           "text": "类型"
          },
          "expanded": false,
          "children": [],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "colBEG_WORK_TIM",
           "dataIndex": "BEG_WORK_TIM",
           "width": "120",
           "text": "工作开始时间"
          },
          "expanded": false,
          "children": [],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "colEND_WORK_TIM",
           "dataIndex": "END_WORK_TIM",
           "width": "120",
           "text": "工作结束时间"
          },
          "expanded": false,
          "children": [],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "colREMARK_TXT",
           "hidden": "true",
           "dataIndex": "REMARK_TXT",
           "width": "260",
           "text": "备注"
          },
          "expanded": false,
          "children": [],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "colSTATUS",
           "hidden": "true",
           "dataIndex": "STATUS",
           "text": "状态"
          },
          "expanded": false,
          "children": [],
          "type": "column"
         }
        ],
        "type": "array"
       }
      ],
      "type": "grid"
     }
    ],
    "type": "window",
    "events": {
     "show": "app.disGrid.store.load({\
  params: {\
    taskId: app.taskId,\
    type:app.W_TYPE.getValue()\
  }\
});",
     "ok": "var s = app.disGrid.getSelection();\
var disArray = s.map(function(sel) {\
  return {\
    ID: sel.data.ID\
  };\
});\
Wb.request({\
  url: 'm?xwl=controlManage/task/worktaskcraneedit/insertDisWork',\
  params: {\
    task: disArray,\
    taskId: app.taskId\
  },\
  success: function(resp) {\
    //Wb.toast(\"保存成功\",true);\
    app.gridworkduty.store.load({\
      params: {\
        taskId: app.taskId\
      }\
    });\
    win.close();\
  }\
});"
    }
   },
   {
    "configs": {
     "itemId": "taskWin",
     "dialog": "true",
     "title": "新建任务"
    },
    "expanded": false,
    "children": [{
     "configs": {"itemId": "panel1"},
     "expanded": true,
     "children": [
      {
       "configs": {
        "itemId": "type",
        "allowBlank": "false",
        "fieldLabel": "任务类型",
        "keyName": "TASK_TYPE",
        "readOnly": "true"
       },
       "expanded": false,
       "children": [],
       "type": "combo",
       "events": {
        "afterrender": "combo.store.filters.add({filterFn:function(r) {\
  return ['GIN', 'GOUT', 'MOVE'].includes(r.data.K);\
}});",
        "change": "if(newValue === 'MOVE')\
  app.trade.hide();\
else\
  app.trade.show();"
       }
      },
      {
       "configs": {
        "itemId": "date",
        "allowBlank": "false",
        "fieldLabel": "任务日期"
       },
       "expanded": false,
       "children": [],
       "type": "date"
      },
      {
       "configs": {
        "itemId": "cfs",
        "allowBlank": "false",
        "fieldLabel": "场区",
        "keyName": "C_CFS"
       },
       "expanded": true,
       "children": [],
       "type": "combo"
      },
      {
       "configs": {
        "allowBlank": "false",
        "itemId": "trade",
        "fieldLabel": "内外贸",
        "keyName": "TRADE_ID"
       },
       "expanded": false,
       "children": [],
       "type": "combo"
      }
     ],
     "type": "panel"
    }],
    "type": "window",
    "events": {"ok": "var val = Wb.getValue(win);\
var task = {\
  task_type: val.type,\
  task_name: Wb.dateToText(val.date).split(' ')[0] + val[\"%cfs\"] + (app.trade.isHidden() ? '' : val[\"%trade\"])\
};\
Wb.request({\
  url: \"m?xwl=controlManage/task/worktaskcraneedit/insertTask\",\
  params:task,\
  success:function()\
  {\
    win.close();\
  }\
});"}
   },
   {
    "configs": {
     "itemId": "toPosWin",
     "dialog": "true",
     "title": "修改目标场位"
    },
    "expanded": false,
    "children": [{
     "configs": {"itemId": "panel1"},
     "expanded": true,
     "children": [
      {
       "configs": {
        "itemId": "old_pos",
        "fieldLabel": "原计划位置"
       },
       "expanded": false,
       "children": [],
       "type": "text"
      },
      {
       "configs": {
        "itemId": "to_pos",
        "allowBlank": "false",
        "fieldLabel": "新计划位置",
        "isUpperCase": "true"
       },
       "expanded": false,
       "children": [],
       "type": "text"
      }
     ],
     "type": "panel"
    }],
    "type": "window",
    "events": {"ok": "var val = Wb.getValue(win);\
var param = {\
  allBill: val.allBill,\
  to_pos: val.to_pos,\
  moves: win.moves,\
  ship: app.treeTask.getSelection()[0].raw.ship,\
  type: app.treeTask.getSelection()[0].parentNode.data.id,\
  taskId: app.taskId\
};\
Wb.request({\
  url: \"m?xwl=controlManage/task/worktaskcraneedit/modifyToPos\",\
  params: param,\
  success: function() {\
    win.close();\
  }\
});"}
   },
   {
    "configs": {
     "itemId": "writeCardWin",
     "dialog": "true",
     "title": "写卡"
    },
    "expanded": true,
    "children": [
     {
      "configs": {"itemId": "panel1"},
      "expanded": true,
      "children": [{
       "configs": {
        "itemId": "type",
        "allowBlank": "false",
        "labelAlign": "right",
        "fieldLabel": "业务类型",
        "displayField": "V",
        "readOnly": "false",
        "labelWidth": "120",
        "valueField": "K"
       },
       "expanded": false,
       "children": [],
       "type": "combo",
       "events": {"change": "var info = app.cardType[newValue];\
if(!info)\
  return;\
//清空动态控件面板\
var p2 = combo.findParentByType('panel').nextNode();\
p2.removeAll();\
\
//添加必输项\
if (info.need)\
  Ext.Object.getKeys(info.need).map(function(k) {\
    p2.add(new Ext.form.TextField({\
      appScope: app,\
      xtype: \"textfield\",\
      itemId: k,\
      fieldLabel: info.need[k],\
      allowBlank: false,\
      labelAlign: \"right\",\
      labelWidth:120\
    }));\
  });\
//添加可选项\
if (info.option)\
  Ext.Object.getKeys(info.option).map(function(k) {\
    p2.add(new Ext.form.TextField({\
      appScope: app,\
      xtype: \"textfield\",\
      itemId: k,\
      fieldLabel: info.option[k],\
      labelAlign: \"right\",\
      labelWidth:120\
    }));\
  });"}
      }],
      "type": "panel"
     },
     {
      "configs": {"itemId": "panel2"},
      "expanded": true,
      "children": [],
      "type": "panel"
     }
    ],
    "type": "window",
    "events": {
     "beforeshow": "if (app.moveGrid.selModel.lastFocused)\
  Wb.request({\
    url: 'm?xwl=controlManage/task/worktaskcraneedit/cardInfo',\
    params: {\
      handle_id: app.moveGrid.selModel.lastFocused.data.ID\
    },\
    success: function(resp) {\
      var ret = Wb.decode(resp.responseText);\
      if (!ret.success) {\
        Wb.error(\"获取写卡信息失败\");\
        return;\
      }\
      Wb.setValue(win, {\
        type: ret.info.type\
      });\
      setTimeout(function() {\
        Wb.setValue(win, ret.info);\
      }, 50);\
    }\
  });",
     "ok": "var val = Wb.getValue(win);\
Ext.data.JsonP.request({\
  url: \"http://127.0.0.1:81/writeCard\",\
  callbackKey: \"webletcallback\",\
  timeout: 10000,\
  params: val,\
  success: function(data) {\
    if (data.version != 'V2017.8.21') {\
      Wb.info(\"<font color='#FF0000' size=3>写卡组件版本不一致<\/font>,<br>请下载并解压安装包card.zip,<br>然后双击install.bat安装写卡驱动服务。<br>安装服务时如360等安全软件报警<font color='#FF0000' size=3>请选择允许<\/font><br>请在安装成功后重试写卡功能!\", function() {\
        Wb.download(\"ctgraph/card.zip\", null, false, \"GET\");\
      });\
      return;\
    }\
    if (data.success) {\
      Wb.tip(\"写入成功\", false, true);\
      Wb.request({\
        url: 'm?xwl=controlManage/task/worktaskcraneedit/cardOk',\
        params: {\
          id: app.moveGrid.selModel.lastFocused.data.ID\
        },\
        success: function(resp) {\
          var ret = Wb.decode(resp.responseText);\
          if (!ret.success) {\
            Wb.error(\"保存写卡标志失败\");\
            return;\
          }\
          app.moveGrid.selModel.lastFocused.set('CARD_WRITE_ID', 1);\
          app.moveGrid.selModel.lastFocused.commit();\
        }\
      });\
      win.close();\
    } else\
      Wb.error(data.error, null, null, \"写卡失败\");\
  },\
  failure: function() {\
    Wb.info(\"<font color='#FF0000' size=3>写卡组件版本不一致<\/font>,<br>请下载并解压安装包card.zip,<br>然后双击install.bat安装写卡驱动服务。<br>安装服务时如360等安全软件报警<font color='#FF0000' size=3>请选择允许<\/font><br>请在安装成功后重试写卡功能!\", function() {\
      Wb.download(\"ctgraph/card.zip\", null, false, \"GET\");\
    });\
  }\
});"
    }
   },
   {
    "configs": {
     "layout": "fit",
     "itemId": "viewport1"
    },
    "expanded": true,
    "children": [
     {
      "configs": {
       "layout": "border",
       "itemId": "panel2"
      },
      "expanded": true,
      "children": [
       {
        "configs": {
         "layout": "fit",
         "itemId": "panelTree",
         "split": "true",
         "width": "260",
         "region": "west"
        },
        "expanded": true,
        "children": [{
         "configs": {
          "itemId": "treeTask",
          "root": "{\
  text: '作业任务'\
}",
          "tools": "Wb.getTreeTools()"
         },
         "expanded": false,
         "children": [
          {
           "configs": {
            "itemId": "store",
            "autoLoad": "true",
            "url": "m?xwl=controlManage/task/worktaskcraneedit/loadTask"
           },
           "expanded": false,
           "children": [],
           "type": "treestore"
          },
          {
           "configs": {
            "itemId": "popupMenu",
            "normalName": "menu1"
           },
           "expanded": true,
           "children": [
            {
             "configs": {
              "itemId": "disBtn",
              "tooltip": "派工",
              "text": "派工",
              "iconCls": "slider_icon"
             },
             "expanded": false,
             "children": [],
             "type": "item",
             "events": {"click": "\
app.disWin.show();\
"}
            },
            {
             "configs": {
              "itemId": "sendBtn",
              "tooltip": "发送",
              "text": "发送",
              "iconCls": "flag1_icon"
             },
             "expanded": false,
             "children": [],
             "type": "item",
             "events": {"click": "var s= app.treeTask.getSelection()[0].parentNode.data.id;\
\
Wb.request({\
  url: 'm?xwl=controlManage/task/worktaskcraneedit/taskDubbo/instSplit',\
  params: {\
  id:app.taskId,type:s\
  },\
  success: function(resp) {\
    Wb.info(resp.responseText);\
  }\
});\
"}
            },
            {
             "configs": {
              "itemId": "finBtn",
              "tooltip": "任务完成确认",
              "text": "完成确认",
              "iconCls": "check_icon"
             },
             "expanded": false,
             "children": [],
             "type": "item",
             "events": {"click": "\
Wb.request({\
  url: \"m?xwl=controlManage/task/worktaskcraneedit/finishTask\",\
  params: {\
    id: app.taskId,\
    taskType:app.sels[0].raw.type\
  }\
});"}
            },
            {
             "configs": {
              "itemId": "delBtn",
              "tooltip": "删除任务",
              "text": "删除任务",
              "iconCls": "file_delete_icon"
             },
             "expanded": false,
             "children": [],
             "type": "item",
             "events": {"click": "Wb.confirm(\"只能删除计划状态的任务，是否要删除当前任务？\", function() {\
  Wb.request({\
    url: \"m?xwl=controlManage/task/worktaskcraneedit/deleteTask\",\
    params: {\
      id: app.taskId\
    }\
  });\
});"}
            },
            {
             "configs": {
              "itemId": "cancelBtn",
              "tooltip": "取消发送",
              "text": "取消发送",
              "iconCls": "undo_icon"
             },
             "expanded": false,
             "children": [],
             "type": "item",
             "events": {"click": "Wb.request({\
  url: 'm?xwl=controlManage/task/worktaskcraneedit/taskDubbo/delInstSplit',\
  params: {\
    taskId: app.sels[0].data.id,\
    ship: app.sels[0].raw.ship,\
    type: app.treeTask.getSelection()[0].parentNode.data.id\
  },\
  success: function(resp) {\
    Wb.info(\"成功\"); //resp.responseText);\
  }\
});"}
            }
           ],
           "type": "menu",
           "events": {"show": "var rows = app.treeTask.getSelection();\
app.sels = rows;\
if (!(rows && rows[0])) {\
  menu.hide();\
  return;\
}\
var sel = rows[0];\
var isLeaf = sel.isLeaf();\
if (isLeaf) {\
  menu.down(\"#disBtn\").show();\
  menu.down(\"#sendBtn\").show();\
  menu.down(\"#delBtn\").show();\
  menu.down(\"#finBtn\").show();\
  menu.down(\"#cancelBtn\").show();\
} else {\
  menu.hide();\
}"}
          }
         ],
         "type": "tree",
         "events": {
          "selectionchange": "var record = selected[0];\
if (!record)\
  return;\
app.taskId = record.data.id;\
if (!record.raw.leaf)\
  return;\
if (!app.taskId)\
  return;\
if (app.lastSubKey)\
  app.xwl1.unsubscribe(app.lastSubKey);\
app.taskType = record.parentNode.data.id;\
switch (app.taskType) {\
  case 'GOUT':\
  case 'GIN':\
    app.lastSubKey = '/exchange/ex_instruction/gate.#';\
    break;\
  case 'VIN':\
  case 'VOUT':\
    app.lastSubKey = '/exchange/ex_instruction/ship.' + record.raw.ship;\
    break;\
  case 'MOVE':\
    app.lastSubKey = '/exchange/ex_instruction/cy.#';\
    break;\
}\
app.xwl1.subscribe(app.lastSubKey, function(d) {\
  var msg = d.body;\
  //console.log(msg);\
  var record = app.moveGrid.store.data.findBy(function(r, k) {\
    return r.data.ID === msg.data.id;\
  });\
  switch (msg.info.action) {\
    case 'create':\
    case 'update':\
    case 'confirm':\
      Wb.request({\
        url: \"m?xwl=controlManage/task/worktaskcraneedit/moveListMsg\",\
        params: Wb.apply(msg.data, {\
          taskType: app.taskType\
        }),\
        success: function(res) {\
          data = Wb.decode(res.responseText);\
          if (!record)\
            Wb.add(app.moveGrid, data.rows);\
          else\
            Wb.update(record, data.rows[0]);\
        }\
      });\
      break;\
    case 'delete':\
      if (record) {\
        Wb.remove(app.moveGrid, [record]);\
      }\
      break;\
    case 'batch':\
      if (app.taskId === msg.data.id)\
        app.moveGrid.store.reload();\
      break;\
    default:\
      console.log(msg);\
      break;\
  }\
  app.chart1.store.reload();\
});\
app.gridworkduty.store.load({\
  params: {\
    taskId: app.taskId\
  }\
});\
var oldMoveCount = app.moveGrid.store.getCount();\
var oldMovebCount = app.moveGridb.store.getCount();\
var newMoveCount = -1;\
var newMovebCount = -1;\
\
function setHeight() {\
  if (newMoveCount < 0 || newMovebCount < 0)\
    return;\
  var b = app.moveListPanel.getBox();\
  if (newMoveCount) {\
    app.moveListPanel.expand(false);\
  } else\
    app.moveListPanel.collapse(false);\
\
  if (newMovebCount) {\
    if (newMoveCount)\
      app.moveListbPanel.setHeight((window.innerHeight - b.top) / 2);\
    else\
      app.moveListbPanel.setHeight(window.innerHeight - b.top - 24);\
    app.moveListbPanel.expand(false);\
  } else\
    app.moveListbPanel.collapse(false);\
\
}\
app.moveGrid.store.load({\
  params: {\
    QUEUE_ID: app.taskId\
  },\
  callback: function() {\
    newMoveCount = app.moveGrid.store.getCount();\
    setHeight();\
  }\
});\
app.moveGridb.store.load({\
  params: {\
    QUEUE_ID: app.taskId\
  },\
  callback: function() {\
    newMovebCount = app.moveGridb.store.getCount();\
    setHeight();\
  }\
});\
app.chart1.store.load({\
  params: {\
    QUEUE_ID: app.taskId\
  }\
});",
          "load": "if (app.taskId) {\
  var rec = app.treeTask.getRootNode().findChildBy(function(n) {\
    return n.data.id === app.taskId;\
  }, null, 2);\
  if (rec) {\
    rec.parentNode.expand();\
    app.treeTask.selModel.select(rec);\
  }\
}",
          "afterrender": "app.xwl1.subscribe(\"/exchange/ex_task/#\", function(d) {\
  var sels = app.treeTask.getSelection();\
  var id;\
  if (sels.length) {\
    var node = sels[0];\
    if (node && node.isLeaf())\
      node = node.parentNode;\
    if (node)\
      id = node.data.id;\
  }\
  app.treeTask.store.reload({\
    callback: function() {\
      var r = app.treeTask.getRootNode();\
      for(var i in r.childNodes)\
        if(r.childNodes[i].data.id ===id)\
        {\
          r.childNodes[i].expand();\
          break;\
        }\
    }\
  });\
});"
         }
        }],
        "type": "panel"
       },
       {
        "configs": {
         "layout": "border",
         "itemId": "panel1",
         "region": "center"
        },
        "expanded": true,
        "children": [
         {
          "configs": {
           "layout": "border",
           "itemId": "panel1",
           "split": "true",
           "region": "north",
           "height": "200"
          },
          "expanded": true,
          "children": [
           {
            "configs": {
             "layout": "fit",
             "itemId": "panel1",
             "split": "true",
             "width": "480",
             "region": "west",
             "height": "320"
            },
            "expanded": false,
            "children": [{
             "configs": {"itemId": "chart1"},
             "expanded": true,
             "children": [
              {
               "configs": {
                "itemId": "store",
                "url": "m?xwl=controlManage/task/worktaskcraneedit/loadTaskChart"
               },
               "expanded": false,
               "children": [],
               "type": "store"
              },
              {
               "configs": {"itemId": "axes"},
               "expanded": true,
               "children": [
                {
                 "configs": {
                  "itemId": "leftAxis",
                  "position": "left",
                  "type": "numeric"
                 },
                 "expanded": true,
                 "children": [],
                 "type": "axis"
                },
                {
                 "configs": {
                  "itemId": "bottomAxis",
                  "position": "bottom",
                  "type": "category",
                  "fields": "CAT"
                 },
                 "expanded": true,
                 "children": [],
                 "type": "axis"
                }
               ],
               "type": "array"
              },
              {
               "configs": {"itemId": "series"},
               "expanded": true,
               "children": [{
                "configs": {
                 "itemId": "plan",
                 "renderer": "var yField = this.items[index].yField;\
var color = app.TASK_STATE && app.TASK_STATE[yField] || '#bbbbbb';\
return Wb.apply(attributes,{fill:color});",
                 "xField": "name",
                 "stacked": "true",
                 "yField": "['PLN','SND','TMP','EXE','FIN']",
                 "axis": "left",
                 "type": "column",
                 "tips": "{\
  trackMouse:true,\
  renderer: function(record, item) {\
    var tip = \"尺码类型:\" + record.data.CAT;\
    for (var k in record.data) {\
      var name = '';\
      switch (k) {\
        case 'PLN':\
          name = '计划状态:';\
          break;\
        case 'SND':\
          name = '发送状态:';\
          break;\
        case 'TMP':\
          name = '暂存状态:';\
          break;\
        case 'EXE':\
          name = '执行状态:';\
          break;\
        case 'FIN':\
          name = '完成状态:';\
          break;\
      }\
      if (name && record.data[k])\
        tip += \"<br><br>\" + name + record.data[k];\
    }\
    this.update(tip);\
  }\
}"
                },
                "expanded": true,
                "children": [{
                 "configs": {
                  "itemId": "label",
                  "padding": "20",
                  "createInstance": "false",
                  "field": "[\"PLN\",\"SND\",\"TMP\",\"EXE\",\"FIN\"]",
                  "color": "black",
                  "display": "insideEnd"
                 },
                 "expanded": false,
                 "children": [],
                 "type": "chartlabel"
                }],
                "type": "series",
                "events": {"itemdblclick": "var phase = item.yField;\
var cat = item.storeItem.data.CAT;\
var records = app.moveGrid.store.queryBy(function(r) {\
  return r.data.PHASE === phase && cat === (r.data.CNTR_SIZE + r.data.E_F_ID);\
});\
app.moveGrid.selModel.select(records.items);"}
               }],
               "type": "array"
              }
             ],
             "type": "chart"
            }],
            "type": "panel"
           },
           {
            "configs": {
             "itemId": "gridworkduty",
             "selType": "checkboxmodel",
             "disabled": "false",
             "region": "center",
             "multiSelect": "true"
            },
            "expanded": false,
            "children": [
             {
              "configs": {
               "groupField": "W_TYPE",
               "itemId": "store",
               "pageSize": "-1",
               "sorters": "'ID'",
               "url": "m?xwl=controlManage/task/worktaskcraneedit/select"
              },
              "expanded": false,
              "children": [],
              "type": "store"
             },
             {
              "configs": {
               "itemId": "features",
               "ftype": "grouping",
               "groupHeaderTpl": "{name} ({rows.length} 条)"
              },
              "expanded": false,
              "children": [],
              "type": "feature"
             },
             {
              "configs": {"itemId": "columns"},
              "expanded": true,
              "children": [
               {
                "configs": {
                 "itemId": "colID",
                 "hidden": "true",
                 "dataIndex": "ID",
                 "text": "ID"
                },
                "expanded": false,
                "children": [],
                "type": "column"
               },
               {
                "configs": {
                 "itemId": "colTENANCY_ID",
                 "hidden": "true",
                 "dataIndex": "TENANCY_ID",
                 "text": "租户"
                },
                "expanded": false,
                "children": [],
                "type": "column"
               },
               {
                "configs": {
                 "itemId": "column1",
                 "xtype": "rownumberer"
                },
                "expanded": false,
                "children": [],
                "type": "column"
               },
               {
                "configs": {
                 "itemId": "colRESOURCE_ID",
                 "dataIndex": "RESOURCE_ID",
                 "width": "140",
                 "text": "工号"
                },
                "expanded": false,
                "children": [],
                "type": "column"
               },
               {
                "configs": {
                 "itemId": "RESOURCE_NAMECOLUMN",
                 "dataIndex": "RESOURCE_NAME",
                 "width": "80",
                 "text": "名称"
                },
                "expanded": false,
                "children": [],
                "type": "column"
               },
               {
                "configs": {
                 "itemId": "colW_TYPE",
                 "renderer": "if (value == '0') {\
  return \"操作人员\";\
}\
if (value == '1') {\
  return \"车辆\";\
}\
if (value == '2') {\
  return \"拖卡\";\
}\
if (value == '3') {\
  return \"场内机械设备\";\
}",
                 "dataIndex": "W_TYPE",
                 "groupable": "true",
                 "text": "类型"
                },
                "expanded": false,
                "children": [],
                "type": "column"
               },
               {
                "configs": {
                 "itemId": "colBEG_WORK_TIM",
                 "dataIndex": "BEG_WORK_TIM",
                 "width": "120",
                 "text": "工作开始时间"
                },
                "expanded": false,
                "children": [],
                "type": "column"
               },
               {
                "configs": {
                 "itemId": "colEND_WORK_TIM",
                 "dataIndex": "END_WORK_TIM",
                 "width": "120",
                 "text": "工作结束时间"
                },
                "expanded": false,
                "children": [],
                "type": "column"
               },
               {
                "configs": {
                 "itemId": "colREMARK_TXT",
                 "hidden": "true",
                 "dataIndex": "REMARK_TXT",
                 "width": "260",
                 "text": "备注"
                },
                "expanded": false,
                "children": [],
                "type": "column"
               },
               {
                "configs": {
                 "itemId": "colSTATUS",
                 "hidden": "true",
                 "dataIndex": "STATUS",
                 "text": "状态"
                },
                "expanded": false,
                "children": [],
                "type": "column"
               }
              ],
              "type": "array"
             }
            ],
            "type": "grid"
           }
          ],
          "type": "panel"
         },
         {
          "configs": {
           "layout": "fit",
           "itemId": "moveListPanel",
           "collapsed": "true",
           "region": "center",
           "collapsible": "true"
          },
          "expanded": true,
          "children": [{
           "configs": {
            "itemId": "moveGrid",
            "multiColumnSort": "true",
            "tbar": "app.tbarMove",
            "disabled": "false",
            "multiSelect": "true"
           },
           "expanded": true,
           "children": [
            {
             "configs": {
              "itemId": "store",
              "pageSize": "1000",
              "sorters": "'ID'",
              "url": "m?xwl=controlManage/task/worktaskcraneedit/moveListSelect"
             },
             "expanded": false,
             "children": [],
             "type": "store"
            },
            {
             "configs": {"itemId": "columns"},
             "expanded": true,
             "children": [
              {
               "configs": {
                "itemId": "column1",
                "xtype": "rownumberer"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "BILL_NO",
                "dataIndex": "BILL_NO",
                "text": "提单号码"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "CNTR99",
                "dataIndex": "CNTR",
                "width": "120",
                "text": "箱号"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "RELEASE_ID",
                "renderer": "var color = value =='1' ? 'green' : 'red';\
metaData.style = 'background-color:' + color + \";\";\
return value =='1' ? '已放行' : '未放行';",
                "dataIndex": "RELEASE_ID",
                "width": "50",
                "text": "海关"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "CARD_WRITE_ID",
                "renderer": "/*var color = value =='1' ? 'green' : 'red';\
metaData.style = 'background-color:' + color + \";\";*/\
return value =='1' ? '已写卡' : '';",
                "dataIndex": "CARD_WRITE_ID",
                "width": "50",
                "text": "已写卡"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "PHASE",
                "renderer": "var map = {\
  PLN: '计划',\
  SND: '发送',\
  EXE: '执行',\
  TMP: '暂存',\
  FIN: '完成'\
};\
var color = app.TASK_STATE && app.TASK_STATE[value] || '#bbbbbb';\
metaData.style = 'background-color:' + color + \";\";\
return map[value] || value;",
                "dataIndex": "PHASE",
                "width": "40",
                "text": "状态",
                "align": "center"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "FROM_POS",
                "dataIndex": "FROM_POS",
                "width": "65",
                "text": "起点"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TO_POS",
                "dataIndex": "TO_POS",
                "width": "65",
                "text": "终点"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "E_F_ID",
                "renderer": "var color = app.E_F_ID && app.E_F_ID[value] || '#bbbbbb';\
metaData.style = 'background-color:' + color + \";\";\
return value === 'P' ? '拼柜' : value === 'F' ? '重柜' : '空柜';",
                "dataIndex": "E_F_ID",
                "width": "40",
                "text": "吉重"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "C_CNTR_SIZ",
                "dataIndex": "CNTR_SIZE",
                "width": "40",
                "text": "尺寸"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "C_CNTR_TYP99",
                "dataIndex": "CNTR_TYPE",
                "width": "40",
                "text": "类型"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TRCLASS199",
                "dataIndex": "TRCLASS1",
                "width": "40",
                "text": "机械类型1"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TRCLASS1995",
                "dataIndex": "TRANSPORTER1",
                "width": "40",
                "text": "机械1"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TRCLASS1991",
                "dataIndex": "TRCLASS2",
                "width": "40",
                "text": "机械类型2"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TRCLASS19911",
                "dataIndex": "TRANSPORTER2",
                "width": "40",
                "text": "机载2"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TRCLASS1992",
                "dataIndex": "TRCLASS3",
                "width": "40",
                "text": "机械类型3"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TRCLASS19921",
                "dataIndex": "TRANSPORTER3",
                "width": "40",
                "text": "机载3"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TRCLASS1993",
                "dataIndex": "TRCLASS4",
                "width": "40",
                "text": "机械类型4"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TRCLASS19931",
                "dataIndex": "TRANSPORTER4",
                "width": "40",
                "text": "机械4"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TRCLASS1994",
                "dataIndex": "TRCLASS5",
                "text": "机械类型5"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TRCLASS19941",
                "dataIndex": "TRANSPORTER5",
                "text": "机械5"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "FROM_YPOINT99",
                "dataIndex": "FROM_YPOINT",
                "text": "起始坐标"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TO_XPOINT99",
                "dataIndex": "TO_XPOINT",
                "text": "目标坐标"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "ORIGIN99",
                "dataIndex": "CARRIER_CODE",
                "text": "原始位置"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "CARRIER_ATA99",
                "dataIndex": "CARRIER_ATA",
                "text": "来的时间"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "SAFE_WT99",
                "dataIndex": "SAFE_WT",
                "text": "安全重量"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "SCALE_WT99",
                "dataIndex": "SCALE_WT",
                "text": "过磅重量"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "SERVICE99",
                "dataIndex": "SERVICE",
                "text": "航线"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "OPL99",
                "dataIndex": "OPL",
                "text": "装货港"
               },
               "expanded": true,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TRUCKING_CO99",
                "dataIndex": "TRUCKING_CO",
                "text": "车队"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TRANSPORTER199",
                "dataIndex": "TRANSPORTER1",
                "text": "作业机械"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "LINE99",
                "dataIndex": "LINE",
                "width": "120",
                "text": "船公司"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "CREATED_MAN99",
                "hidden": "true",
                "dataIndex": "CREATED_BY",
                "text": "创建人"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "CREATED_ON99",
                "hidden": "true",
                "dataIndex": "CREATED_ON",
                "text": "创建时间"
               },
               "expanded": true,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "UPDATED_MAN99",
                "hidden": "true",
                "dataIndex": "UPDATED_BY",
                "text": "修改人"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "CNTR_LENGTH99",
                "hidden": "true",
                "dataIndex": "CNTR_LENGTH",
                "text": "长度"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "CNTR_HIGHT99",
                "hidden": "true",
                "dataIndex": "CNTR_HIGHT",
                "text": "高度"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "OVERHEIGHT99",
                "hidden": "true",
                "dataIndex": "OVERHEIGHT",
                "text": "超重"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "UPDATED_ON99",
                "hidden": "true",
                "dataIndex": "UPDATED_ON",
                "text": "修改时间"
               },
               "expanded": true,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "POSITION_STATUS99",
                "dataIndex": "POSITION_STATUS",
                "text": "位置状态"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              }
             ],
             "type": "array"
            },
            {
             "configs": {
              "itemId": "popupMenu",
              "normalName": "menu1"
             },
             "expanded": true,
             "children": [
              {
               "configs": {
                "itemId": "popupComp",
                "tooltip": "查看在场箱信息",
                "text": "查看在场箱信息",
                "iconCls": "object_icon"
               },
               "expanded": false,
               "children": [],
               "type": "item",
               "events": {"click": "Wb.run({\
  url: 'm?xwl=controlManage/portcntr/control-module',\
  params: {\
    ID: app.moveGrid.selModel.lastFocused.data.CNTR_ID\
  },\
  success: function(appnew) {\
    var wins = new Ext.window.Window(appnew._cntrWin);\
    app.test = appnew.test;\
 // win.setPosition(\"100\",\"400\");\
\
    wins.show();\
  }\
});"}
              },
              {
               "configs": {
                "itemId": "sendBtn",
                "tooltip": "发送",
                "text": "发送",
                "iconCls": "flag1_icon"
               },
               "expanded": false,
               "children": [],
               "type": "item",
               "events": {"click": "Wb.request({\
  url: 'm?xwl=controlManage/task/worktaskcraneedit/taskDubbo/instSplit',\
  params: {\
    id: app.taskId,\
    type: app.treeTask.getSelection()[0].parentNode.data.id,\
    cntrs: app.moveGrid.getSelection().map(function(sel) {\
      return sel.data.CNTR;\
    })\
  },\
  success: function(resp) {\
    Wb.info(resp.responseText);\
  }\
});"}
              },
              {
               "configs": {
                "itemId": "cancelBtn",
                "tooltip": "取消发送",
                "text": "取消",
                "iconCls": "undo_icon"
               },
               "expanded": false,
               "children": [],
               "type": "item",
               "events": {"click": "Wb.request({\
  url: 'm?xwl=controlManage/task/worktaskcraneedit/taskDubbo/delInstSplit',\
  params: {\
    taskId: app.taskId,\
    ship: app.treeTask.getSelection()[0].raw.ship,\
    type: app.treeTask.getSelection()[0].parentNode.data.id,\
    cntrs: app.moveGrid.getSelection().map(function(sel) {\
      return sel.data.CNTR;\
    })\
  },\
  success: function(resp) {\
    Wb.info(\"成功\"); //resp.responseText);\
  }\
});"}
              },
              {
               "configs": {
                "itemId": "enableBtn",
                "tooltip": "启用指令",
                "text": "启用",
                "iconCls": "lamp_green_icon"
               },
               "expanded": false,
               "children": [],
               "type": "item",
               "events": {"click": "// Wb.info(app.menu1.popupComp.itemId); //同一menu可以用于多个控件，popupComp指向使菜单弹出的控件\
//(激活现在就先改下状态)\
var sels = app.moveGrid.getSelection();\
Wb.request({\
  url: 'm?xwl=controlManage/task/worktaskcraneedit/enableIns',\
  params: {\
    ship: app.treeTask.getSelection()[0].raw.ship,\
    type: app.treeTask.getSelection()[0].parentNode.data.id,\
    ids: sels.map(function(s){return s.data.ID;}),\
    taskId: app.taskId\
  },\
  success: function(resp) {}\
});"}
              },
              {
               "configs": {
                "itemId": "disableBtn",
                "tooltip": "禁用指令",
                "text": "禁用",
                "iconCls": "lamp_red_icon"
               },
               "expanded": false,
               "children": [],
               "type": "item",
               "events": {"click": "// Wb.info(app.menu1.popupComp.itemId); //同一menu可以用于多个控件，popupComp指向使菜单弹出的控件\
//(激活现在就先改下状态)\
var sels = app.moveGrid.getSelection();\
Wb.request({\
  url: 'm?xwl=controlManage/task/worktaskcraneedit/disableIns',\
  params: {\
    ship: app.treeTask.getSelection()[0].raw.ship,\
    type: app.treeTask.getSelection()[0].parentNode.data.id,\
    ids: sels.map(function(s) {\
      return s.data.ID;\
    }),\
    taskId: app.taskId\
  },\
  success: function(resp) {}\
});"}
              },
              {
               "configs": {
                "itemId": "writeCardBtn",
                "tooltip": "写卡",
                "text": "写卡",
                "iconCls": "book_icon"
               },
               "expanded": false,
               "children": [],
               "type": "item",
               "events": {"click": "app.writeCardWin.show();\
"}
              },
              {
               "configs": {
                "itemId": "unloadBtn",
                "tooltip": "卸船测试",
                "text": "卸船测试",
                "iconCls": "anonymous_icon"
               },
               "expanded": false,
               "children": [],
               "type": "item",
               "events": {"click": "var sels = app.moveGrid.getSelection();\
Wb.each(sels, function(sel) {\
  Wb.request({\
    url: 'appFun',\
    params: {\
      funId: 'SAVE_UNLOAD',\
      cntr: sel.data.CNTR,\
      ship:app.treeTask.selModel.selected.items[0].raw.ship\
    },\
    success: function(resp) {\
      var ret = Wb.decode(resp.responseText);\
      if (!ret.sucess && ret.errstr)\
        Wb.error(ret.errstr);\
    }\
  });\
});"}
              },
              {
               "configs": {
                "itemId": "loadBtn",
                "tooltip": "装船测试",
                "text": "装船测试",
                "iconCls": "anonymous_icon"
               },
               "expanded": false,
               "children": [],
               "type": "item",
               "events": {"click": "var sels = app.moveGrid.getSelection();\
Wb.each(sels, function(sel) {\
  Wb.request({\
    url: 'appFun',\
    params: {\
      funId: 'SAVE_LOAD',\
      cntr: sel.data.CNTR,\
      ship:app.treeTask.selModel.selected.items[0].raw.ship\
    },\
    success: function(resp) {\
      var ret = Wb.decode(resp.responseText);\
      if (!ret.sucess && ret.errstr)\
        Wb.error(ret.errstr);\
    }\
  });\
});"}
              },
              {
               "configs": {
                "itemId": "modifyCyBtn",
                "tooltip": "指定目标场位",
                "text": "指定目标场位",
                "iconCls": "boxs_icon"
               },
               "expanded": false,
               "children": [],
               "type": "item",
               "events": {"click": "var sels = app.moveGrid.getSelection();\
if (!(sels && sels.length))\
  return;\
var olds = [];\
var moves = [];\
Wb.each(sels, function(r) {\
  if ((r.data.TO_POS_TYP === 'B' || r.data.TRCLASS4 === 'YC') && r.data.PHASE !== 'FIN') {\
    if (!olds.includes(r.data.TO_POS))\
      olds.push(r.data.TO_POS);\
    moves.push(r.data.ID);\
  }\
});\
Wb.setValue(app.toPosWin, {\
  old_pos: olds ? olds.join(',') : '',\
  to_pos: ''\
});\
app.toPosWin.moves = moves;\
app.toPosWin.show();"}
              }
             ],
             "type": "menu",
             "events": {"show": "var rows = app.moveGrid.getSelection();\
if (!(rows && rows[0])) {\
  menu.hide();\
  return;\
}\
//发送按钮是否可见\
if (Ext.Array.findBy(rows, function(r) {\
    return r.data.PHASE === 'PLN';\
  }))\
  menu.down(\"#sendBtn\").show();\
else\
  menu.down(\"#sendBtn\").hide();\
\
//取消按钮是否可见\
if (Ext.Array.findBy(rows, function(r) {\
    return r.data.PHASE === 'SND';\
  }))\
  menu.down(\"#cancelBtn\").show();\
else\
  menu.down(\"#cancelBtn\").hide();\
\
//启用按钮是否可见\
if (Ext.Array.findBy(rows, function(r) {\
    return r.data.ENABLE_ID === 0;\
  }))\
  menu.down(\"#enableBtn\").show();\
else\
  menu.down(\"#enableBtn\").hide();\
\
//取消按钮是否可见\
if (Ext.Array.findBy(rows, function(r) {\
    return r.data.ENABLE_ID === 1;\
  }))\
  menu.down(\"#disableBtn\").show();\
else\
  menu.down(\"#disableBtn\").hide();\
\
//写卡按钮是否可见\
if (Ext.Array.findBy(rows, function(r) {\
    return r.data.RELEASE_ID ==1 && (r.data.Y2Y_ID === 1 || r.data.TO_POS_TYP === 'G' || r.data.FROM_POS_TYP === 'G');\
  }))\
  menu.down(\"#writeCardBtn\").show();\
else\
  menu.down(\"#writeCardBtn\").hide();\
\
//卸船测试是否可见\
if (app.taskType === 'VIN' && Ext.Array.findBy(rows, function(r) {\
    return r.data.PHASE === 'PLN' || r.data.PHASE === 'SND' || r.data.PHASE === 'TMP';\
  }))\
  menu.down(\"#unloadBtn\").show();\
else\
  menu.down(\"#unloadBtn\").hide();\
\
//装船测试是否可见\
if (app.taskType === 'VOUT' && Ext.Array.findBy(rows, function(r) {\
    return r.data.PHASE === 'EXE' || r.data.PHASE === 'TMP';\
  }))\
  menu.down(\"#loadBtn\").show();\
else\
  menu.down(\"#loadBtn\").hide();\
\
//修改场位是否可见\
if (Ext.Array.findBy(rows, function(r) {\
    return (r.data.TO_POS_TYP === 'B' || r.data.TRCLASS4 === 'YC') && r.data.PHASE !== 'FIN';\
  }))\
  menu.down(\"#modifyCyBtn\").show();\
else\
  menu.down(\"#modifyCyBtn\").hide();"}
            }
           ],
           "type": "grid"
          }],
          "type": "panel"
         },
         {
          "configs": {
           "layout": "fit",
           "itemId": "moveListbPanel",
           "split": "true",
           "collapsed": "true",
           "region": "south",
           "collapsible": "true",
           "height": "150"
          },
          "expanded": false,
          "children": [{
           "configs": {
            "itemId": "moveGridb",
            "multiColumnSort": "true",
            "tbar": "app.tbarMoveb",
            "disabled": "false",
            "multiSelect": "true"
           },
           "expanded": true,
           "children": [
            {
             "configs": {
              "itemId": "store",
              "pageSize": "50",
              "sorters": "'ID'",
              "url": "m?xwl=controlManage/task/worktaskcraneedit/moveListbSelect"
             },
             "expanded": false,
             "children": [],
             "type": "store"
            },
            {
             "configs": {"itemId": "columns"},
             "expanded": true,
             "children": [
              {
               "configs": {
                "itemId": "column1",
                "xtype": "rownumberer"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "BILL_NO99",
                "dataIndex": "BILL_NO",
                "text": "提单号码"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "CNTR99",
                "dataIndex": "GOODS_NOTES",
                "width": "120",
                "text": "货名"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "PHASE999",
                "renderer": "var map = {\
  PLN: '计划',\
  SND: '发送',\
  EXE: '执行',\
  TMP: '暂存',\
  FIN: '完成'\
};\
var color = app.TASK_STATE && app.TASK_STATE[value] || '#bbbbbb';\
metaData.style = 'background-color:' + color + \";\";\
return map[value] || value;",
                "dataIndex": "PHASE",
                "width": "40",
                "text": "状态",
                "align": "center"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "FROM_POS99",
                "dataIndex": "FROM_POS",
                "width": "65",
                "text": "起点"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TO_POS99",
                "dataIndex": "TO_POS",
                "width": "65",
                "text": "终点"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "C_CNTR_TYP99",
                "dataIndex": "CNTR_TYPE",
                "width": "40",
                "text": "类型"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TRCLASS199",
                "dataIndex": "TRCLASS1",
                "width": "40",
                "text": "机械类型1"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TRCLASS1995",
                "dataIndex": "TRANSPORTER1",
                "width": "40",
                "text": "机械1"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TRCLASS1991",
                "dataIndex": "TRCLASS2",
                "width": "40",
                "text": "机械类型2"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TRCLASS19911",
                "dataIndex": "TRANSPORTER2",
                "width": "40",
                "text": "机载2"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TRCLASS1992",
                "dataIndex": "TRCLASS3",
                "width": "40",
                "text": "机械类型3"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TRCLASS19921",
                "dataIndex": "TRANSPORTER3",
                "width": "40",
                "text": "机载3"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TRCLASS1993",
                "dataIndex": "TRCLASS4",
                "width": "40",
                "text": "机械类型4"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TRCLASS19931",
                "dataIndex": "TRANSPORTER4",
                "width": "40",
                "text": "机械4"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TRCLASS1994",
                "dataIndex": "TRCLASS5",
                "text": "机械类型5"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TRCLASS19941",
                "dataIndex": "TRANSPORTER5",
                "text": "机械5"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "FROM_YPOINT99",
                "dataIndex": "FROM_YPOINT",
                "text": "起始坐标"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TO_XPOINT99",
                "dataIndex": "TO_XPOINT",
                "text": "目标坐标"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "ORIGIN99",
                "dataIndex": "CARRIER_CODE",
                "text": "原始位置"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "CARRIER_ATA99",
                "dataIndex": "CARRIER_ATA",
                "text": "来的时间"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "SAFE_WT99",
                "dataIndex": "SAFE_WT",
                "text": "安全重量"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "SCALE_WT99",
                "dataIndex": "SCALE_WT",
                "text": "过磅重量"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "SERVICE99",
                "dataIndex": "SERVICE",
                "text": "航线"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "OPL99",
                "dataIndex": "OPL",
                "text": "装货港"
               },
               "expanded": true,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TRUCKING_CO99",
                "dataIndex": "TRUCKING_CO",
                "text": "车队"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TRANSPORTER199",
                "dataIndex": "TRANSPORTER1",
                "text": "作业机械"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "LINE99",
                "dataIndex": "LINE",
                "width": "120",
                "text": "船公司"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "CREATED_MAN99",
                "hidden": "true",
                "dataIndex": "CREATED_BY",
                "text": "创建人"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "CREATED_ON99",
                "hidden": "true",
                "dataIndex": "CREATED_ON",
                "text": "创建时间"
               },
               "expanded": true,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "UPDATED_MAN99",
                "hidden": "true",
                "dataIndex": "UPDATED_BY",
                "text": "修改人"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "CNTR_LENGTH99",
                "hidden": "true",
                "dataIndex": "CNTR_LENGTH",
                "text": "长度"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "CNTR_HIGHT99",
                "hidden": "true",
                "dataIndex": "CNTR_HIGHT",
                "text": "高度"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "OVERHEIGHT99",
                "hidden": "true",
                "dataIndex": "OVERHEIGHT",
                "text": "超重"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "UPDATED_ON99",
                "hidden": "true",
                "dataIndex": "UPDATED_ON",
                "text": "修改时间"
               },
               "expanded": true,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "POSITION_STATUS99",
                "dataIndex": "POSITION_STATUS",
                "text": "位置状态"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              }
             ],
             "type": "array"
            },
            {
             "configs": {
              "itemId": "popupMenu",
              "normalName": "menu1"
             },
             "expanded": true,
             "children": [
              {
               "configs": {
                "itemId": "popupComp",
                "tooltip": "查看在场箱信息",
                "text": "查看在场箱信息",
                "iconCls": "object_icon"
               },
               "expanded": false,
               "children": [],
               "type": "item",
               "events": {"click": "Wb.run({\
  url: 'm?xwl=controlManage/portcntr/control-module',\
  params: {\
    ID: app.moveGrid.selModel.lastFocused.data.CNTR_ID\
  },\
  success: function(appnew) {\
    var wins = new Ext.window.Window(appnew._cntrWin);\
    app.test = appnew.test;\
 // win.setPosition(\"100\",\"400\");\
\
    wins.show();\
  }\
});"}
              },
              {
               "configs": {
                "itemId": "sendBtn",
                "tooltip": "发送",
                "text": "发送",
                "iconCls": "flag1_icon"
               },
               "expanded": false,
               "children": [],
               "type": "item",
               "events": {"click": "Wb.request({\
  url: 'm?xwl=controlManage/task/worktaskcraneedit/taskDubbo/instSplit',\
  params: {\
    id: app.taskId,\
    type: app.treeTask.getSelection()[0].parentNode.data.id,\
    cntrs: app.moveGrid.getSelection().map(function(sel) {\
      return sel.data.CNTR;\
    })\
  },\
  success: function(resp) {\
    Wb.info(resp.responseText);\
  }\
});"}
              },
              {
               "configs": {
                "itemId": "cancelBtn",
                "tooltip": "取消发送",
                "text": "取消",
                "iconCls": "undo_icon"
               },
               "expanded": false,
               "children": [],
               "type": "item",
               "events": {"click": "Wb.request({\
  url: 'm?xwl=controlManage/task/worktaskcraneedit/taskDubbo/delInstSplit',\
  params: {\
    taskId: app.taskId,\
    ship: app.treeTask.getSelection()[0].raw.ship,\
    type: app.treeTask.getSelection()[0].parentNode.data.id,\
    cntrs: app.moveGrid.getSelection().map(function(sel) {\
      return sel.data.CNTR;\
    })\
  },\
  success: function(resp) {\
    Wb.info(\"成功\"); //resp.responseText);\
  }\
});"}
              },
              {
               "configs": {
                "itemId": "enableBtn",
                "tooltip": "启用指令",
                "text": "启用",
                "iconCls": "lamp_green_icon"
               },
               "expanded": false,
               "children": [],
               "type": "item",
               "events": {"click": "// Wb.info(app.menu1.popupComp.itemId); //同一menu可以用于多个控件，popupComp指向使菜单弹出的控件\
//(激活现在就先改下状态)\
var sels = app.moveGrid.getSelection();\
Wb.request({\
  url: 'm?xwl=controlManage/task/worktaskcraneedit/enableIns',\
  params: {\
    ship: app.treeTask.getSelection()[0].raw.ship,\
    type: app.treeTask.getSelection()[0].parentNode.data.id,\
    ids: sels.map(function(s){return s.data.ID;}),\
    taskId: app.taskId\
  },\
  success: function(resp) {}\
});"}
              },
              {
               "configs": {
                "itemId": "disableBtn",
                "tooltip": "禁用指令",
                "text": "禁用",
                "iconCls": "lamp_red_icon"
               },
               "expanded": false,
               "children": [],
               "type": "item",
               "events": {"click": "// Wb.info(app.menu1.popupComp.itemId); //同一menu可以用于多个控件，popupComp指向使菜单弹出的控件\
//(激活现在就先改下状态)\
var sels = app.moveGrid.getSelection();\
Wb.request({\
  url: 'm?xwl=controlManage/task/worktaskcraneedit/disableIns',\
  params: {\
    ship: app.treeTask.getSelection()[0].raw.ship,\
    type: app.treeTask.getSelection()[0].parentNode.data.id,\
    ids: sels.map(function(s) {\
      return s.data.ID;\
    }),\
    taskId: app.taskId\
  },\
  success: function(resp) {}\
});"}
              },
              {
               "configs": {
                "itemId": "writeCardBtn",
                "tooltip": "写卡",
                "text": "写卡",
                "iconCls": "book_icon"
               },
               "expanded": false,
               "children": [],
               "type": "item",
               "events": {"click": "app.writeCardWin.show();\
"}
              },
              {
               "configs": {
                "itemId": "unloadBtn",
                "tooltip": "卸船测试",
                "text": "卸船测试",
                "iconCls": "anonymous_icon"
               },
               "expanded": false,
               "children": [],
               "type": "item",
               "events": {"click": "var sels = app.moveGrid.getSelection();\
Wb.each(sels, function(sel) {\
  Wb.request({\
    url: 'appFun',\
    params: {\
      funId: 'SAVE_UNLOAD',\
      cntr: sel.data.CNTR,\
      ship:app.treeTask.selModel.selected.items[0].raw.ship\
    },\
    success: function(resp) {\
      var ret = Wb.decode(resp.responseText);\
      if (!ret.sucess && ret.errstr)\
        Wb.error(ret.errstr);\
    }\
  });\
});"}
              },
              {
               "configs": {
                "itemId": "loadBtn",
                "tooltip": "装船测试",
                "text": "装船测试",
                "iconCls": "anonymous_icon"
               },
               "expanded": false,
               "children": [],
               "type": "item",
               "events": {"click": "var sels = app.moveGrid.getSelection();\
Wb.each(sels, function(sel) {\
  Wb.request({\
    url: 'appFun',\
    params: {\
      funId: 'SAVE_LOAD',\
      cntr: sel.data.CNTR,\
      ship:app.treeTask.selModel.selected.items[0].raw.ship\
    },\
    success: function(resp) {\
      var ret = Wb.decode(resp.responseText);\
      if (!ret.sucess && ret.errstr)\
        Wb.error(ret.errstr);\
    }\
  });\
});"}
              },
              {
               "configs": {
                "itemId": "modifyCyBtn",
                "tooltip": "指定目标场位",
                "text": "指定目标场位",
                "iconCls": "boxs_icon"
               },
               "expanded": false,
               "children": [],
               "type": "item",
               "events": {"click": "var sels = app.moveGrid.getSelection();\
if (!(sels && sels.length))\
  return;\
var olds = [];\
var moves = [];\
Wb.each(sels, function(r) {\
  if ((r.data.TO_POS_TYP === 'B' || r.data.TRCLASS4 === 'YC') && r.data.PHASE !== 'FIN') {\
    if (!olds.includes(r.data.TO_POS))\
      olds.push(r.data.TO_POS);\
    moves.push(r.data.ID);\
  }\
});\
Wb.setValue(app.toPosWin, {\
  old_pos: olds ? olds.join(',') : '',\
  to_pos: ''\
});\
app.toPosWin.moves = moves;\
app.toPosWin.show();"}
              }
             ],
             "type": "menu",
             "events": {"show": "var rows = app.moveGrid.getSelection();\
if (!(rows && rows[0])) {\
  menu.hide();\
  return;\
}\
//发送按钮是否可见\
if (Ext.Array.findBy(rows, function(r) {\
    return r.data.PHASE === 'PLN';\
  }))\
  menu.down(\"#sendBtn\").show();\
else\
  menu.down(\"#sendBtn\").hide();\
\
//取消按钮是否可见\
if (Ext.Array.findBy(rows, function(r) {\
    return r.data.PHASE === 'SND';\
  }))\
  menu.down(\"#cancelBtn\").show();\
else\
  menu.down(\"#cancelBtn\").hide();\
\
//启用按钮是否可见\
if (Ext.Array.findBy(rows, function(r) {\
    return r.data.ENABLE_ID === 0;\
  }))\
  menu.down(\"#enableBtn\").show();\
else\
  menu.down(\"#enableBtn\").hide();\
\
//取消按钮是否可见\
if (Ext.Array.findBy(rows, function(r) {\
    return r.data.ENABLE_ID === 1;\
  }))\
  menu.down(\"#disableBtn\").show();\
else\
  menu.down(\"#disableBtn\").hide();\
\
//写卡按钮是否可见\
if (Ext.Array.findBy(rows, function(r) {\
    return r.data.Y2Y_ID === 1 || r.data.TO_POS_TYP === 'G' || r.data.FROM_POS_TYP === 'G';\
  }))\
  menu.down(\"#writeCardBtn\").show();\
else\
  menu.down(\"#writeCardBtn\").hide();\
\
//卸船测试是否可见\
if (app.taskType === 'VIN' && Ext.Array.findBy(rows, function(r) {\
    return r.data.PHASE === 'PLN' || r.data.PHASE === 'SND' || r.data.PHASE === 'TMP';\
  }))\
  menu.down(\"#unloadBtn\").show();\
else\
  menu.down(\"#unloadBtn\").hide();\
\
//装船测试是否可见\
if (app.taskType === 'VOUT' && Ext.Array.findBy(rows, function(r) {\
    return r.data.PHASE === 'EXE' || r.data.PHASE === 'TMP';\
  }))\
  menu.down(\"#loadBtn\").show();\
else\
  menu.down(\"#loadBtn\").hide();\
\
//修改场位是否可见\
if (Ext.Array.findBy(rows, function(r) {\
    return (r.data.TO_POS_TYP === 'B' || r.data.TRCLASS4 === 'YC') && r.data.PHASE !== 'FIN';\
  }))\
  menu.down(\"#modifyCyBtn\").show();\
else\
  menu.down(\"#modifyCyBtn\").hide();"}
            }
           ],
           "type": "grid"
          }],
          "type": "panel"
         },
         {
          "configs": {
           "itemId": "label",
           "padding": "20",
           "field": "['PLN','SND','EXE','FIN']",
           "color": "black",
           "display": "insideEnd"
          },
          "expanded": false,
          "children": [],
          "type": "chartlabel"
         }
        ],
        "type": "panel"
       }
      ],
      "type": "panel"
     },
     {
      "configs": {
       "itemId": "xwl1",
       "file": "m?xwl=system/common/rabbitMq"
      },
      "expanded": false,
      "children": [],
      "type": "xwl"
     }
    ],
    "type": "viewport"
   }
  ],
  "type": "module",
  "events": {"finalize": "Wb.request({\
  url: \"m?xwl=controlManage/task/worktaskcraneedit/taskColor\",\
  success: function(res) {\
    Wb.apply(app, Wb.decode(res.responseText));\
  }\
});\
\
app.cardType = {\
  IZ: {\
    text: \"进口重柜\",\
    need: {\
      cntr1: \"集装箱号1\"\
    },\
    option: {\
      cntr2: \"集装箱号2\"\
    }\
  },\
  ZG: {\
    text: \"转关车辆（出场）\",\
    need: {\
      plate: \"车牌号\",\
      custno: \"车辆海关编号\"\
    },\
    option: {\
      cntr1: \"集装箱号1\",\
      cntr2: \"集装箱号2\"\
    }\
  },\
  JS: {\
    text: \"进口散货（拼柜）\",\
    need: {\
      billno: \"散货出闸申报单号\",\
      plate: \"车牌号\"\
    }\
  },\
  DS: {\
    text: \"大宗散货分批出场\",\
    need: {\
      billno: \"申报单号\",\
      plate: \"车牌号\"\
    }\
  },\
  KC: {\
    text: \"空车出场\",\
    need: {\
      plate: \"车牌号\"\
    }\
  },\
  KX: {\
    text: \"空箱出场\",\
    need: {\
      cntr1: \"集装箱号1\"\
    },\
    option: {\
      cntr2: \"集装箱号2\"\
    }\
  },\
  TG: {\
    text: \"退货出场\",\
    need: {\
      billno: \"申报单号\",\
      plate: \"车牌号\"\
    },\
    option: {\
      cntr1: \"集装箱号1\",\
      cntr2: \"集装箱号2\"\
    }\
  },\
  DB: {\
    text: \"港区调拨\",\
    need: {\
      billno: \"调拨单号\",\
      plate: \"车牌号\",\
      cntr1: \"集装箱号1\"\
    },\
    option: {\
      cntr2: \"集装箱号2\"\
    }\
  },\
  XZ: {\
    text: \"行政车卡\",\
    need: {\
      plate: \"车牌号\"\
    }\
  },\
  TB: {\
    text: \"特别放行卡\",\
    need: {\
      plate: \"车牌号\"\
    }\
  }\
};\
var type = app.writeCardWin.queryById(\"type\");\
type.bindStore({\
  data: Ext.Object.getKeys(app.cardType).map(function(k) {\
    return {\
      K: k,\
      V: app.cardType[k].text\
    };\
  }),\
  fields: ['K', 'V'],\
  type: 'store'\
});\
\
var mt1 = bldStr(\"BCV1.TreeList\", \"AF1\", \"\", \"99%\");\
app.billPanel.update(mt1);"}
 }],
 "roles": {
  "SCANJB": 1,
  "xlablh": 1,
  "xlczb": 1,
  "xlcd": 1,
  "xlnmzk": 1
 },
 "title": "任务指令",
 "iconCls": "",
 "inframe": true,
 "pageLink": ""
}