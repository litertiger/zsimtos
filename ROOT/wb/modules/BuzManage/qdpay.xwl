{
 "hidden": false,
 "children": [{
  "configs": {
   "itemId": "module",
   "serverScript": "app.set({\
  JSESSIONID: request.getSession().getId()\
});"
  },
  "expanded": true,
  "children": [
   {
    "configs": {"itemId": "hjbar"},
    "expanded": false,
    "children": [{
     "configs": {
      "itemId": "lblhj",
      "text": "合计：0"
     },
     "expanded": false,
     "children": [],
     "type": "label"
    }],
    "type": "toolbar"
   },
   {
    "configs": {
     "layout": "fit",
     "itemId": "winAccDetails",
     "dialog": "true",
     "closeAction": "destroy",
     "width": "620",
     "height": "230"
    },
    "expanded": true,
    "children": [{
     "configs": {
      "layout": "@{type:'table',columns:2}",
      "border": "false",
      "itemId": "panelAccDetails",
      "defaults": "{\
  labelWidth: 80,\
  width: 280,\
  margin: '8 0 0 8'\
}",
      "region": "north"
     },
     "expanded": true,
     "children": [
      {
       "configs": {
        "tagConfigs": "matchFieldWidth: false",
        "hideTrigger": "true",
        "itemId": "CUSTOMER_ID",
        "allowBlank": "false",
        "labelAlign": "right",
        "fieldLabel": "货主",
        "displayField": "CNAME",
        "enterKeyTriggerClick": "true",
        "listConfig": "{width:250}",
        "valueField": "ID",
        "queryDelay": "500",
        "forceSelection": "true"
       },
       "expanded": true,
       "children": [{
        "configs": {
         "itemId": "store",
         "autoLoad": "true",
         "url": "m?xwl=system/common/client/clientSelect"
        },
        "expanded": false,
        "children": [],
        "type": "store"
       }],
       "type": "combo",
       "events": {"select": "app.CUSTOMER_NAM.setValue(combo.getRawValue());"}
      },
      {
       "configs": {
        "itemId": "CUSTOMER_NAM",
        "hidden": "true",
        "labelAlign": "right",
        "fieldLabel": "货主"
       },
       "expanded": false,
       "children": [],
       "type": "text"
      },
      {
       "configs": {
        "tagConfigs": "matchFieldWidth: false",
        "hideTrigger": "true",
        "itemId": "ACCOUNT_CUSTOMER_CODE",
        "allowBlank": "false",
        "labelAlign": "right",
        "fieldLabel": "计费对象",
        "displayField": "CNAME",
        "enterKeyTriggerClick": "true",
        "listConfig": "{width:250}",
        "valueField": "ID",
        "queryDelay": "500",
        "forceSelection": "true"
       },
       "expanded": true,
       "children": [{
        "configs": {
         "itemId": "store",
         "autoLoad": "true",
         "url": "m?xwl=system/common/client/clientSelect"
        },
        "expanded": false,
        "children": [],
        "type": "store"
       }],
       "type": "combo",
       "events": {"select": "app.ACCOUNT_CUSTOMER_NAM.setValue(combo.getRawValue());"}
      },
      {
       "configs": {
        "itemId": "ACCOUNT_CUSTOMER_NAM",
        "hidden": "true",
        "labelAlign": "right",
        "fieldLabel": "计费对象"
       },
       "expanded": false,
       "children": [],
       "type": "text"
      },
      {
       "configs": {
        "tagConfigs": "matchFieldWidth: false",
        "hideTrigger": "true",
        "itemId": "PAYMENT_CUSTOMER_CODE",
        "allowBlank": "false",
        "labelAlign": "right",
        "fieldLabel": "付费对象",
        "displayField": "CNAME",
        "enterKeyTriggerClick": "true",
        "listConfig": "{width:250}",
        "valueField": "ID",
        "queryDelay": "500",
        "forceSelection": "true"
       },
       "expanded": true,
       "children": [{
        "configs": {
         "itemId": "store",
         "autoLoad": "true",
         "url": "m?xwl=system/common/client/clientSelect"
        },
        "expanded": false,
        "children": [],
        "type": "store"
       }],
       "type": "combo",
       "events": {"select": "app.PAYMENT_CUSTOMER_NAM.setValue(combo.getRawValue());"}
      },
      {
       "configs": {
        "itemId": "PAYMENT_CUSTOMER_NAM",
        "hidden": "true",
        "labelAlign": "right",
        "fieldLabel": "付费对象"
       },
       "expanded": false,
       "children": [],
       "type": "text"
      },
      {
       "configs": {
        "itemId": "CNTR_OPERATOR_COD",
        "hidden": "true",
        "labelAlign": "right",
        "fieldLabel": "船公司"
       },
       "expanded": false,
       "children": [],
       "type": "text"
      },
      {
       "configs": {
        "itemId": "FEE_LIST_ID",
        "allowBlank": "false",
        "labelAlign": "right",
        "fieldLabel": "费目",
        "keyName": "C_BASE_CHARGING_ITEM",
        "anyMatch": "true"
       },
       "expanded": true,
       "children": [],
       "type": "combo",
       "events": {"change": "// Wb.request({\
//   url: \"m?xwl=BuzManage/bandanedit/getReat\",\
//   params: {\
//     mth: \"find\",\
//     bill_no: app.ACCBILL_NO.getValue(),\
//     FEE_LIST_ID: app.FEE_LIST_ID.getValue(),\
//     CNTR: app.CNTR.getValue()\
//   },\
//   success: function(resp) {\
//     var result = Wb.decode(resp.responseText);\
//     console.log(result);\
//     if (result.length > 0) {\
//       app.ACTUAL_JOB_COUNT.setValue(result[0].actualJobCount);\
//       app.AMOUNT1.setValue(result[0].amount);\
//       app.DWELLDAYS.setValue(result[0].dwellDays);\
//       app.AMOUNT.setValue(result[0].amount);\
//     }\
//   }\
// });"}
      },
      {
       "configs": {
        "itemId": "CNTR",
        "labelAlign": "right",
        "fieldLabel": "箱号",
        "readOnly": "true"
       },
       "expanded": false,
       "children": [],
       "type": "text"
      },
      {
       "configs": {
        "itemId": "CNTR_SIZE",
        "hidden": "true",
        "labelAlign": "right",
        "fieldLabel": "尺寸",
        "readOnly": "true"
       },
       "expanded": false,
       "children": [],
       "type": "text"
      },
      {
       "configs": {
        "itemId": "CNTR_TYPE",
        "hidden": "true",
        "labelAlign": "right",
        "fieldLabel": "箱型",
        "readOnly": "true"
       },
       "expanded": false,
       "children": [],
       "type": "text"
      },
      {
       "configs": {
        "itemId": "I_E_ID",
        "hidden": "true",
        "labelAlign": "right",
        "fieldLabel": "进出口",
        "readOnly": "true"
       },
       "expanded": false,
       "children": [],
       "type": "text"
      },
      {
       "configs": {
        "itemId": "TRADE_ID",
        "hidden": "true",
        "labelAlign": "right",
        "fieldLabel": "内外贸",
        "readOnly": "true"
       },
       "expanded": false,
       "children": [],
       "type": "text"
      },
      {
       "configs": {
        "itemId": "BILL_TYPE",
        "hidden": "true",
        "labelAlign": "right",
        "fieldLabel": "bill_type",
        "readOnly": "true"
       },
       "expanded": false,
       "children": [],
       "type": "text"
      },
      {
       "configs": {
        "itemId": "ACTUAL_JOB_COUNT",
        "allowBlank": "false",
        "minValue": "1",
        "labelAlign": "right",
        "fieldLabel": "数量",
        "value": "1"
       },
       "expanded": true,
       "children": [],
       "type": "number",
       "events": {"change": "if (Wb.isEmpty(app.ACTUAL_JOB_COUNT.getValue()) || Wb.isEmpty(app.DWELLDAYS.getValue()) || Wb.isEmpty(app.RATE.getValue()))\
  return;\
var a = app.ACTUAL_JOB_COUNT.getValue();\
var b = app.DWELLDAYS.getValue();\
var c = app.RATE.getValue();\
app.AMOUNT.setValue(a * b * c);"}
      },
      {
       "configs": {
        "itemId": "DWELLDAYS",
        "allowBlank": "false",
        "minValue": "1",
        "labelAlign": "right",
        "fieldLabel": "天数",
        "value": "1"
       },
       "expanded": false,
       "children": [],
       "type": "number",
       "events": {"change": "if (Wb.isEmpty(app.ACTUAL_JOB_COUNT.getValue()) || Wb.isEmpty(app.DWELLDAYS.getValue()) || Wb.isEmpty(app.RATE.getValue()))\
  return;\
var a = app.ACTUAL_JOB_COUNT.getValue();\
var b = app.DWELLDAYS.getValue();\
var c = app.RATE.getValue();\
app.AMOUNT.setValue(a * b * c);"}
      },
      {
       "configs": {
        "itemId": "RATE",
        "allowBlank": "false",
        "labelAlign": "right",
        "fieldLabel": "单价"
       },
       "expanded": false,
       "children": [],
       "type": "number",
       "events": {"change": "if (Wb.isEmpty(app.ACTUAL_JOB_COUNT.getValue()) || Wb.isEmpty(app.DWELLDAYS.getValue()) || Wb.isEmpty(app.RATE.getValue()))\
  return;\
var a = app.ACTUAL_JOB_COUNT.getValue();\
var b = app.DWELLDAYS.getValue();\
var c = app.RATE.getValue();\
app.AMOUNT.setValue(a * b * c);"}
      },
      {
       "configs": {
        "itemId": "AMOUNT",
        "allowBlank": "false",
        "labelAlign": "right",
        "fieldLabel": "金额"
       },
       "expanded": false,
       "children": [],
       "type": "number"
      },
      {
       "configs": {
        "itemId": "NOTES",
        "labelAlign": "right",
        "fieldLabel": "备注"
       },
       "expanded": false,
       "children": [],
       "type": "text"
      },
      {
       "configs": {
        "itemId": "ACCBILL_NO",
        "hidden": "true",
        "labelAlign": "right",
        "fieldLabel": "提单"
       },
       "expanded": false,
       "children": [],
       "type": "text"
      }
     ],
     "type": "panel"
    }],
    "type": "window",
    "events": {"ok": "if (!Wb.verify(app.panelAccDetails))\
  return false;\
\
var AF1 = document.getElementById(opt);\
var tenid = '{#sys.TENANCY_ID#}';\
Wb.request({\
  url: \"m?xwl=BuzManage/bandanedit/insertAccountJava\",\
  params: {\
    billno: app.ACCBILL_NO.getValue(),\
    cntr: app.CNTR.getValue(),\
    cntr_size: app.CNTR_SIZE.getValue(),\
    cntr_type: app.CNTR_TYPE.getValue(),\
    i_e_id: app.I_E_ID.getValue(),\
    trade_id: app.TRADE_ID.getValue(),\
    bill_type: app.BILL_TYPE.getValue(),\
    CNTR_OPERATOR_COD: app.CNTR_OPERATOR_COD.getValue(),\
    FEE_LIST_ID: app.FEE_LIST_ID.getValue(),\
    AMOUNT: Wb.isEmpty(app.AMOUNT.getValue()) ? 0 : app.AMOUNT.getValue(),\
    ACTUAL_JOB_COUNT: Wb.isEmpty(app.ACTUAL_JOB_COUNT.getValue()) ? 0 : app.ACTUAL_JOB_COUNT.getValue(),\
    DWELLDAYS: app.DWELLDAYS.getValue(),\
    RATE: app.RATE.getValue(),\
    CUSTOMER_ID: app.CUSTOMER_ID.getValue(),\
    CUSTOMER_NAM: app.CUSTOMER_NAM.getValue(),\
    ACCOUNT_CUSTOMER_CODE: app.ACCOUNT_CUSTOMER_CODE.getValue(),\
    ACCOUNT_CUSTOMER_NAM: app.ACCOUNT_CUSTOMER_NAM.getValue(),\
    PAYMENT_CUSTOMER_CODE: app.PAYMENT_CUSTOMER_CODE.getValue(),\
    PAYMENT_CUSTOMER_NAM: app.PAYMENT_CUSTOMER_NAM.getValue(),\
    PAYMENT_TYPE: 1,\
    notes: app.NOTES.getValue()\
  },\
  success: function(resp) {\
    app.winAccDetails.close();\
    AF1.func(\"Load\", Wb.loadSupcanData(\"m?xwl=BuzManage/bandanedit/selectAccDetials\", {\
      billno: app.txtBILL_NO_RB.getValue()\
    }));\
  }\
});"}
   },
   {
    "configs": {
     "layout": "@{type:'table',columns:1}",
     "itemId": "winCargoType",
     "dialog": "true",
     "defaults": "{\
  labelWidth: 80,\
  width: 280,\
  margin: '8 0 0 8'\
}",
     "closeAction": "destroy",
     "width": "310",
     "height": "100"
    },
    "expanded": true,
    "children": [
     {
      "configs": {
       "itemId": "CGCNTR",
       "hidden": "true",
       "isUpperCase": "true"
      },
      "expanded": true,
      "children": [],
      "type": "text"
     },
     {
      "configs": {
       "itemId": "CARGO_TYPE",
       "allowBlank": "false",
       "labelAlign": "right",
       "fieldLabel": "货物属性",
       "keyName": "CARGO_TYPE",
       "forceSelection": "true"
      },
      "expanded": true,
      "children": [],
      "type": "combo"
     }
    ],
    "type": "window",
    "events": {"ok": "if (!Wb.verify(app.winCargoType))\
  return false;\
\
var tenid = '{#sys.TENANCY_ID#}';\
Wb.request({\
  url: \"m?xwl=BuzManage/bandanedit/updateCargo\",\
  params: {\
    billno: app.txtBILL_NO_RB.getValue(),\
    cntr: app.CGCNTR.getValue(),\
    cargo_type: app.CARGO_TYPE.getValue()\
  },\
  success: function(resp) {\
    app.winCargoType.close();\
    app.searchBtn.fireEvent(\"click\");\
  }\
});"}
   },
   {
    "configs": {
     "layout": "fit",
     "itemId": "winSETTLEMENTBODY",
     "dialog": "true",
     "closeAction": "destroy",
     "width": "1200",
     "title": "账单",
     "height": "460"
    },
    "expanded": false,
    "children": [{
     "configs": {
      "border": "false",
      "itemId": "gridSETTLEBODY",
      "selType": "checkboxmodel",
      "pagingBar": "false",
      "disabled": "false",
      "region": "center",
      "bbar": "app.hjbar"
     },
     "expanded": true,
     "children": [
      {
       "configs": {
        "itemId": "tbar",
        "enableOverflow": "true",
        "normalName": "tbarsetbody",
        "region": "north"
       },
       "expanded": true,
       "children": [
        {
         "configs": {
          "itemId": "cboP",
          "labelAlign": "right",
          "pickList": "[\
  ['2', '普票'],\
  ['0', '专票']\
]",
          "fieldLabel": "发票类型",
          "width": "140",
          "labelWidth": "70",
          "forceSelection": "true"
         },
         "expanded": false,
         "children": [],
         "type": "combo",
         "events": {"select": " Wb.request({\
   url: \"m?xwl=BuzManage/bandanedit/fapiaohao\",\
   params: {\
     invoiceType: app.cboP.getValue()\
   },\
   success: function(resp) {\
     console.log(resp.responseText);\
     app.txtSETTLEMENT_CODE.setValue(resp.responseText);\
   }\
 });"}
        },
        {
         "configs": {
          "itemId": "txtSETTLEMENT_CODE",
          "allowBlank": "false",
          "labelAlign": "right",
          "fieldLabel": "发票号",
          "labelWidth": "60"
         },
         "expanded": true,
         "children": [],
         "type": "text"
        },
        {
         "configs": {
          "tagConfigs": "matchFieldWidth: false",
          "allowBlank": "false",
          "pageSize": "50",
          "enterKeyTriggerClick": "true",
          "labelWidth": "50",
          "listConfig": "{width:250}",
          "valueField": "ID",
          "queryDelay": "500",
          "hideTrigger": "true",
          "itemId": "ACCOUNT_CUSTOMER_ID",
          "labelAlign": "right",
          "fieldLabel": "抬头",
          "displayField": "CNAME",
          "forceSelection": "true",
          "height": "22"
         },
         "expanded": true,
         "children": [{
          "configs": {
           "itemId": "store",
           "autoLoad": "false",
           "url": "m?xwl=system/common/client/clientSelect"
          },
          "expanded": false,
          "children": [],
          "type": "store"
         }],
         "type": "combo"
        },
        {
         "configs": {
          "itemId": "kpBtn",
          "text": "现金开票",
          "iconCls": "write_icon"
         },
         "expanded": false,
         "children": [],
         "type": "item",
         "events": {"click": "var sels = app.gridSETTLEBODY.getSelection();\
if (sels.length < 1) {\
  Wb.warn(\"请选择账单\");\
  return;\
}\
var sids = \"\";\
Wb.each(sels, function(sel) {\
  sids += sel.data.ID + \",\";\
});\
Wb.request({\
  url: \"m?xwl=BuzManage/link_kp/select\",\
  success: function(resp) {\
    var onoff = resp.responseText;\
    Wb.request({\
      url: \"m?xwl=BuzManage/bandanedit/kaipiao\",\
      params: {\
        invoiceType: app.cboP.getValue(),\
        invoiceNo: app.txtSETTLEMENT_CODE.getValue(),\
        bodyIds: sids,\
        ACCOUNT_CUSTOMER_ID: app.ACCOUNT_CUSTOMER_ID.getValue(),\
        PAYMENT_TYPE: \"0\",\
        isLinkTax: onoff\
      },\
      success: function(resp) {\
        Wb.info(\"开票完成\");\
        Wb.request({ //更新签到表收费状态\
          url: 'm?xwl=BuzManage/bandanedit/shoufei',\
          params: {\
            billno: app.txtBILL_NO_RB.getValue()\
          },\
          success: function(resp) {}\
        });\
        var AF1 = document.getElementById(opt);\
        app.gridSETTLEBODY.store.load({\
          params: {\
            billno: app.txtBILL_NO_RB.getValue()\
          },\
          callback: function(r, options, success) {\
            if (success) {\
              if (r.length > 0) {\
                Wb.request({\
                  url: \"m?xwl=BuzManage/bandanedit/fapiaohao\",\
                  params: {\
                    invoiceType: app.cboP.getValue()\
                  },\
                  success: function(resp) {\
                    app.txtSETTLEMENT_CODE.setValue(resp.responseText);\
                  }\
                });\
                //显示费用\
                AF1.func(\"Load\", Wb.loadSupcanData(\"m?xwl=BuzManage/bandanedit/selectAccDetials\", {\
                  billno: app.txtBILL_NO_RB.getValue()\
                }));\
              } else {\
                app.winSETTLEMENTBODY.close();\
                //显示费用\
                AF1.func(\"Load\", Wb.loadSupcanData(\"m?xwl=BuzManage/bandanedit/selectAccDetials\", {\
                  billno: app.txtBILL_NO_RB.getValue()\
                }));\
              }\
            }\
          }\
        });\
      }\
    });\
  }\
});"}
        },
        {
         "configs": {
          "itemId": "gzBtn",
          "text": "挂账开票",
          "iconCls": "write_icon"
         },
         "expanded": false,
         "children": [],
         "type": "item",
         "events": {"click": "var sels = app.gridSETTLEBODY.getSelection();\
if (sels.length < 1) {\
  Wb.warn(\"请选择账单\");\
  return;\
}\
var sids = \"\";\
Wb.each(sels, function(sel) {\
  sids += sel.data.ID + \",\";\
});\
Wb.request({\
  url: \"m?xwl=BuzManage/link_kp/select\",\
  success: function(resp) {\
    var onoff = resp.responseText;\
    Wb.request({\
      url: \"m?xwl=BuzManage/bandanedit/kaipiao\",\
      params: {\
        invoiceType: app.cboP.getValue(),\
        invoiceNo: app.txtSETTLEMENT_CODE.getValue(),\
        bodyIds: sids,\
        ACCOUNT_CUSTOMER_ID: app.ACCOUNT_CUSTOMER_ID.getValue(),\
        PAYMENT_TYPE: \"1\",\
        isLinkTax: onoff\
      },\
      success: function(resp) {\
        Wb.info(\"开票完成\");\
        var AF1 = document.getElementById(opt);\
        app.gridSETTLEBODY.store.load({\
          params: {\
            billno: app.txtBILL_NO_RB.getValue()\
          },\
          callback: function(r, options, success) {\
            if (success) {\
              if (r.length > 0) {\
                Wb.request({\
                  url: \"m?xwl=BuzManage/bandanedit/fapiaohao\",\
                  params: {\
                    invoiceType: app.cboP.getValue()\
                  },\
                  success: function(resp) {\
                    app.txtSETTLEMENT_CODE.setValue(resp.responseText);\
                  }\
                });\
                //显示费用\
                AF1.func(\"Load\", Wb.loadSupcanData(\"m?xwl=BuzManage/bandanedit/selectAccDetials\", {\
                  billno: app.txtBILL_NO_RB.getValue()\
                }));\
              } else {\
                app.winSETTLEMENTBODY.close();\
                //显示费用\
                AF1.func(\"Load\", Wb.loadSupcanData(\"m?xwl=BuzManage/bandanedit/selectAccDetials\", {\
                  billno: app.txtBILL_NO_RB.getValue()\
                }));\
              }\
            }\
          }\
        });\
      }\
    });\
  }\
});"}
        },
        {
         "configs": {
          "itemId": "item1",
          "text": "-"
         },
         "expanded": false,
         "children": [],
         "type": "item"
        },
        {
         "configs": {
          "itemId": "txtHB_NO",
          "labelAlign": "right",
          "fieldLabel": "提单号",
          "labelWidth": "60"
         },
         "expanded": true,
         "children": [],
         "type": "text",
         "events": {"specialkey": "if (e.getKey() == e.ENTER)\
  app.addzdBtn.fireEvent(\"click\");"}
        },
        {
         "configs": {
          "itemId": "addzdBtn",
          "text": "添加账单",
          "iconCls": "add_icon"
         },
         "expanded": false,
         "children": [],
         "type": "item",
         "events": {"click": "if (Wb.isEmpty(app.txtHB_NO.getValue())) {\
  Wb.warn(\"请输入提单号\");\
  return;\
}\
var hbbill = app.txtHB_NO.getValue();\
app.txtbills.setValue(app.txtbills.getValue() + app.txtHB_NO.getValue() + ',');\
var bills = app.txtbills.getValue();\
bills = bills.substring(0, bills.length - 1);\
app.txtHB_NO.setValue(\"\");\
Wb.request({\
  url: \"m?xwl=BuzManage/bandanedit/getReat1\",\
  params: {\
    bill_no: hbbill\
  },\
  success: function(resp) {\
    Wb.request({\
      url: \"m?xwl=BuzManage/toll/invoiceSerial/testSettlement\",\
      params: {\
        billNo: hbbill\
      },\
      success: function(resp) {\
        app.gridSETTLEBODY.store.load({\
          params: {\
            billno: app.txtBILL_NO_RB.getValue(),\
            bills: bills\
          }\
        });\
      }\
    });\
  }\
});"}
        },
        {
         "configs": {
          "itemId": "hbBtn",
          "text": "合并账单",
          "iconCls": "arrow_join_icon"
         },
         "expanded": false,
         "children": [],
         "type": "item",
         "events": {"click": "if (Wb.isEmpty(app.txtbills.getValue())) {\
  Wb.warn(\"没有要合并的账单\");\
  return;\
}\
var bills = app.txtbills.getValue();\
bills = bills.substring(0, bills.length - 1);\
Wb.request({\
  url: \"m?xwl=BuzManage/bandanedit/hebing\",\
  params: {\
    mainBillNo: app.txtBILL_NO_RB.getValue(),\
    subBillNos: app.txtbills.getValue()\
  },\
  success: function(resp) {\
    app.gridSETTLEBODY.store.load({\
      params: {\
        billno: app.txtBILL_NO_RB.getValue(),\
        bills: bills\
      }\
    });\
  }\
});"}
        },
        {
         "configs": {
          "itemId": "txtbills",
          "hidden": "true",
          "labelAlign": "right"
         },
         "expanded": true,
         "children": [],
         "type": "text"
        }
       ],
       "type": "toolbar"
      },
      {
       "configs": {
        "itemId": "store",
        "pageSize": "-1",
        "sorters": "'BILL_NO'",
        "url": "m?xwl=BuzManage/bandanedit/selectSETBODY"
       },
       "expanded": false,
       "children": [],
       "type": "store"
      },
      {
       "configs": {"itemId": "columns"},
       "expanded": true,
       "children": [
        {
         "configs": {
          "itemId": "column1",
          "xtype": "rownumberer"
         },
         "expanded": false,
         "children": [],
         "type": "column"
        },
        {
         "configs": {
          "itemId": "colBILL_NO",
          "dataIndex": "BILL_NO",
          "width": "130",
          "text": "提单号"
         },
         "expanded": false,
         "children": [],
         "type": "column"
        },
        {
         "configs": {
          "itemId": "colINVOICE_NAME",
          "renderer": "if(value == '港口建设费发票'){\
  return \"<font color='red'>港口建设费发票<\/font>\";\
}else{\
  return value;\
}",
          "dataIndex": "INVOICE_NAME",
          "width": "110",
          "text": "发票明细"
         },
         "expanded": false,
         "children": [],
         "type": "column"
        },
        {
         "configs": {
          "itemId": "colUNIT",
          "renderer": "if (value == 0) {\
  return \"票\";\
}",
          "dataIndex": "UNIT",
          "width": "40",
          "text": "单位"
         },
         "expanded": false,
         "children": [],
         "type": "column"
        },
        {
         "configs": {
          "itemId": "colNO_TAX_RATE",
          "dataIndex": "NO_TAX_RATE",
          "width": "90",
          "text": "单价(不含税)"
         },
         "expanded": false,
         "children": [],
         "type": "column"
        },
        {
         "configs": {
          "itemId": "colACTUAL_COUNT",
          "dataIndex": "ACTUAL_COUNT",
          "width": "40",
          "text": "数量"
         },
         "expanded": false,
         "children": [],
         "type": "column"
        },
        {
         "configs": {
          "itemId": "colNO_TAX_AMOUNT",
          "dataIndex": "NO_TAX_AMOUNT",
          "width": "90",
          "text": "金额(不含税)"
         },
         "expanded": false,
         "children": [],
         "type": "column"
        },
        {
         "configs": {
          "itemId": "colTAX_RATE",
          "dataIndex": "TAX_RATE",
          "width": "66",
          "text": "税率(%)"
         },
         "expanded": false,
         "children": [],
         "type": "column"
        },
        {
         "configs": {
          "itemId": "colTAX_AMOUNT",
          "dataIndex": "TAX_AMOUNT",
          "width": "110",
          "text": "税额(单价*税率)"
         },
         "expanded": false,
         "children": [],
         "type": "column"
        },
        {
         "configs": {
          "itemId": "colTOTAL_AMOUNT",
          "dataIndex": "TOTAL_AMOUNT",
          "width": "80",
          "text": "金额(含税)"
         },
         "expanded": false,
         "children": [],
         "type": "column"
        },
        {
         "configs": {
          "itemId": "colENABLED",
          "renderer": "if (value == 0)\
  return \"失效\";\
if (value == 1)\
  return \"有效\";",
          "dataIndex": "ENABLED",
          "width": "66",
          "text": "是否有效"
         },
         "expanded": false,
         "children": [],
         "type": "column"
        },
        {
         "configs": {
          "itemId": "colPAYMENT_TYPE",
          "renderer": "if (value == 1)\
  return \"现金\";\
if (value == 2)\
  return \"月结\";",
          "dataIndex": "PAYMENT_TYPE",
          "width": "66",
          "text": "收费类型"
         },
         "expanded": false,
         "children": [],
         "type": "column"
        },
        {
         "configs": {
          "itemId": "colSETTLE_STATUS",
          "renderer": "if (value == 0)\
  return \"未结算\";\
if (value == 1)\
  return \"已结算\";\
if (value == 2)\
  return \"已开票\";",
          "hidden": "true",
          "dataIndex": "SETTLE_STATUS",
          "width": "66",
          "text": "结算状态"
         },
         "expanded": false,
         "children": [],
         "type": "column"
        },
        {
         "configs": {
          "itemId": "colACCOUNT_CUSTOMER_ID",
          "renderer": "return Wb.getCustomerByCode(value);",
          "dataIndex": "ACCOUNT_CUSTOMER_ID",
          "width": "190",
          "text": "客户"
         },
         "expanded": false,
         "children": [],
         "type": "column"
        },
        {
         "configs": {
          "itemId": "colREMARK",
          "dataIndex": "REMARK",
          "width": "114",
          "text": "备注"
         },
         "expanded": false,
         "children": [],
         "type": "column"
        }
       ],
       "type": "array"
      }
     ],
     "type": "grid",
     "events": {"selectionchange": "var msg = \"合计：\";\
var hj = 0;\
var sels = app.gridSETTLEBODY.getSelection();\
Wb.each(sels, function(sel) {\
  hj += sel.data.TOTAL_AMOUNT;\
});\
app.lblhj.setText(msg + hj);"}
    }],
    "type": "window",
    "events": {
     "ok": "app.winSETTLEMENTBODY.close();",
     "close": "Wb.request({\
  url: \"m?xwl=BuzManage/bandanedit/delsettlement\",\
  params: {\
    billNo: app.txtBILL_NO_RB.getValue()\
  },\
  success: function(resp) {}\
});"
    }
   },
   {
    "configs": {
     "layout": "@{type:'table',columns:1}",
     "itemId": "winSADDRESS",
     "dialog": "true",
     "defaults": "{\
  labelWidth: 80,\
  width: 280,\
  margin: '8 0 0 8'\
}",
     "closeAction": "destroy",
     "width": "310",
     "height": "100"
    },
    "expanded": true,
    "children": [{
     "configs": {
      "tagConfigs": "matchFieldWidth: false",
      "itemId": "S_ADRESS",
      "tpl": "<table cellspacing='0' width='100%'>\
  <tr>\
    <td>\
      地址\
    <\/td>\
    <td>\
      距离\
    <\/td>\
    <td>\
      区域\
    <\/td>\
    <td>\
      内外贸\
    <\/td>\
  <\/tr>\
  <tpl for='.'>\
    <tr class='x-boundlist-item' >\
      <td >\
        {NAME}\
      <\/td>\
      <td>\
        {DISTANCE}\
      <\/td>\
      <td>\
        {AREANAME}\
      <\/td>\
      <td>\
        {TRADE_ID}\
      <\/td>\
    <\/tr>\
  <\/tpl>\
<\/table>",
      "allowBlank": "false",
      "labelAlign": "right",
      "fieldLabel": "拖送地址",
      "displayField": "NAME",
      "listConfig": "{\
  width: 300\
}",
      "valueField": "ID",
      "forceSelection": "true",
      "minChars": "2"
     },
     "expanded": true,
     "children": [{
      "configs": {
       "itemId": "store",
       "autoLoad": "true",
       "pageSize": "-1",
       "url": "m?xwl=receiptInout/receipt/receiptedit/selectADRESS"
      },
      "expanded": true,
      "children": [],
      "type": "store"
     }],
     "type": "combo"
    }],
    "type": "window",
    "events": {"ok": "if (!Wb.verify(app.winSADDRESS))\
  return false;\
\
Wb.request({\
  url: \"m?xwl=BuzManage/bandanedit/updateBillAddr\",\
  params: {\
    billno: app.txtBILL_NO_RB.getValue(),\
    address: app.S_ADRESS.getValue()\
  },\
  success: function(resp) {\
    app.winSADDRESS.close();\
    Wb.info(\"修改完成\");\
  }\
});"}
   },
   {
    "configs": {
     "layout": "border",
     "itemId": "viewport1"
    },
    "expanded": true,
    "children": [
     {
      "configs": {
       "layout": "border",
       "border": "false",
       "itemId": "panelGrid",
       "region": "north",
       "height": "240"
      },
      "expanded": true,
      "children": [
       {
        "configs": {
         "border": "false",
         "itemId": "tbarPanel",
         "enableOverflow": "true",
         "region": "north"
        },
        "expanded": true,
        "children": [
         {
          "configs": {
           "itemId": "txtBILL_NO",
           "emptyText": "提单号/箱号",
           "isUpperCase": "true"
          },
          "expanded": true,
          "children": [],
          "type": "text",
          "events": {"specialkey": "if (e.getKey() == e.ENTER){\
  app.searchBtn.fireEvent(\"click\");}"}
         },
         {
          "configs": {
           "itemId": "txtCNTR",
           "hidden": "true",
           "emptyText": "箱号",
           "isUpperCase": "true"
          },
          "expanded": true,
          "children": [],
          "type": "text",
          "events": {"specialkey": "if (e.getKey() == e.ENTER)\
  app.searchBtnC.fireEvent(\"click\");"}
         },
         {
          "configs": {
           "itemId": "searchBtn1",
           "hidden": "true",
           "text": "@Str.find",
           "iconCls": "search_icon"
          },
          "expanded": false,
          "children": [],
          "type": "item",
          "events": {"click": "if (Wb.isEmpty(app.txtBILL_NO.getValue()) && Wb.isEmpty(app.txtCNTR.getValue()))\
  return false;\
var AF1 = document.getElementById(opt);\
//根据提单号办单\
if (!Wb.isEmpty(app.txtBILL_NO.getValue())) {\
  app.searchBtn.fireEvent(\"click\");\
}\
//根据提箱号办单\
if (!Wb.isEmpty(app.txtCNTR.getValue()) && Wb.isEmpty(app.txtBILL_NO.getValue())) {\
  app.searchBtnC.fireEvent(\"click\");\
}"}
         },
         {
          "configs": {
           "itemId": "searchBtn",
           "text": "查询",
           "iconCls": "search_icon"
          },
          "expanded": false,
          "children": [],
          "type": "item",
          "events": {"click": "if (Wb.isEmpty(app.txtBILL_NO.getValue())) {\
  app.txtMsgqd.setValue(\"\");\
  app.txtMsgbd.setValue(\"\");\
  return false;\
}\
\
Wb.request({\
  url: \"m?xwl=BuzManage/bandanedit/getBillNoBycntr\",\
  params: {\
    cntr: app.txtBILL_NO.getValue()\
  },\
  success: function(resp) {\
    var result = Wb.decode(resp.responseText);\
    if (result.rows.length < 1) {\
      app.txtMsgqd.setValue(\"\");\
      app.txtMsgbd.setValue(\"\");\
      var AF1 = document.getElementById(opt);\
      //根据提单号办单\
      // if (!Wb.isEmpty(app.txtBILL_NO.getValue())) {\
      app.txtBILL_NO_RB.setValue(app.txtBILL_NO.getValue());\
      //插入buz表\
      Wb.request({\
        url: \"m?xwl=BuzManage/bandanedit/insertBUZ\",\
        params: {\
          billno: app.txtBILL_NO.getValue()\
        },\
        success: function(resp) {\
          //查询buz显示\
          app.gridPortcntr.store.load({\
            out: app.tbarPanel,\
            callback: function(r, options, success) { //r:返回的数据,r.length,r[0].data.属性 success:是否回调成功,true,false\
              Wb.request({\
                url: \"m?xwl=BuzManage/bandanedit/getReat1\",\
                params: {\
                  bill_no: app.txtBILL_NO_RB.getValue()\
                },\
                success: function(resp) {\
                  AF1.func(\"Load\", Wb.loadSupcanData(\"m?xwl=BuzManage/bandanedit/selectAccDetials\", {\
                    billno: app.txtBILL_NO_RB.getValue()\
                  }));\
                }\
              });\
              Wb.request({\
                url: \"m?xwl=BuzManage/bandanedit/delsettlement\",\
                params: {\
                  billNo: app.txtBILL_NO_RB.getValue()\
                },\
                success: function(resp) {}\
              });\
            }\
          });\
          //箱统计\
          app.gridXiang.store.load({\
            params: {\
              bill_no: app.txtBILL_NO_RB.getValue()\
            },\
            callback: function(r, options, success) {\
              if (success) {\
                if (r.length > 0) {\
                  app.lclId = Wb.isEmpty(r[0].data.LCL_ID) ? 0 : r[0].data.LCL_ID;\
                  //箱签到条件判断\
                  Wb.request({\
                    url: \"m?xwl=BuzManage/bandanedit/getBdMessage\",\
                    params: {\
                      billNo: app.txtBILL_NO_RB.getValue()\
                    },\
                    success: function(resp) {\
                      var rk = \"\";\
                      if (r[0].data.BILL_TYPE == \"P\" || r[0].data.BILL_TYPE == \"S\") {\
                        if (r[0].data.INQUTY == 0) {\
                          rk += \" 入库数为0\";\
                        }\
                        if (r[0].data.PIECES != r[0].data.INQUTY) {\
                          rk += \" 计划入库和实际入库不相等\";\
                        }\
                      }\
                      var msg = Wb.decode(resp.responseText);\
                      var bt = \"\";\
                      if (r[0].data.BILL_TYPE == \"E\")\
                        bt = \"吉柜\";\
                      if (r[0].data.BILL_TYPE == \"C\")\
                        bt = \"整柜\";\
                      if (r[0].data.BILL_TYPE == \"P\")\
                        bt = \"拼柜\";\
                      if (r[0].data.BILL_TYPE == \"S\")\
                        bt = \"散货\";\
                      var ie = \"\";\
                      if (r[0].data.I_E_ID == \"I\")\
                        ie = \"进口\";\
                      if (r[0].data.I_E_ID == \"E\")\
                        ie = \"出口\";\
                      if (msg.iserror == \"1\" || !Wb.isEmpty(rk)) {\
                        app.txtMsgqd.setValue(ie + bt + msg.message + rk);\
                        app.txtMsgqd.setFieldStyle(\"color:red;\");\
                      }\
                      if (msg.iserror == \"0\" && Wb.isEmpty(rk)) {\
                        app.txtMsgqd.setValue(ie + bt + msg.message + \"可以签到\");\
                        app.txtMsgqd.setFieldStyle(\"color:green;\");\
                      }\
                    }\
                  });\
                }\
              }\
            }\
          });\
        }\
      });\
    } else if (result.rows.length > 1) {\
      Wb.warn(\"输入的箱号不够准确,请输入更准确的箱号\");\
    } else {\
      app.txtMsgqd.setValue(\"\");\
      app.txtMsgbd.setValue(\"\");\
      var AF1 = document.getElementById(opt);\
      //根据提单号办单\
      // if (!Wb.isEmpty(app.txtBILL_NO.getValue())) {\
      app.txtBILL_NO_RB.setValue(result.rows[0].BILL_NO);\
      //插入buz表\
      Wb.request({\
        url: \"m?xwl=BuzManage/bandanedit/insertBUZ\",\
        params: {\
          billno: app.txtBILL_NO_RB.getValue()\
        },\
        success: function(resp) {\
          //查询buz显示\
          app.gridPortcntr.store.load({\
            out: app.tbarPanel,\
            callback: function(r, options, success) { //r:返回的数据,r.length,r[0].data.属性 success:是否回调成功,true,false\
              Wb.request({\
                url: \"m?xwl=BuzManage/bandanedit/getReat1\",\
                params: {\
                  bill_no: app.txtBILL_NO_RB.getValue()\
                },\
                success: function(resp) {\
                  AF1.func(\"Load\", Wb.loadSupcanData(\"m?xwl=BuzManage/bandanedit/selectAccDetials\", {\
                    billno: app.txtBILL_NO_RB.getValue()\
                  }));\
                }\
              });\
              Wb.request({\
                url: \"m?xwl=BuzManage/bandanedit/delsettlement\",\
                params: {\
                  billNo: app.txtBILL_NO_RB.getValue()\
                },\
                success: function(resp) {}\
              });\
            }\
          });\
          //箱统计\
          app.gridXiang.store.load({\
            params: {\
              bill_no: app.txtBILL_NO_RB.getValue()\
            },\
            callback: function(r, options, success) {\
              if (success) {\
                if (r.length > 0) {\
                  app.lclId = Wb.isEmpty(r[0].data.LCL_ID) ? 0 : r[0].data.LCL_ID;\
                  //箱签到条件判断\
                  Wb.request({\
                    url: \"m?xwl=BuzManage/bandanedit/getBdMessage\",\
                    params: {\
                      billNo: app.txtBILL_NO_RB.getValue()\
                    },\
                    success: function(resp) {\
                      var rk = \"\";\
                      if (r[0].data.BILL_TYPE == \"P\" || r[0].data.BILL_TYPE == \"S\") {\
                        if (r[0].data.INQUTY == 0) {\
                          rk += \" 入库数为0,不能签到\";\
                        }\
                        if (r[0].data.PIECES != r[0].data.INQUTY) {\
                          rk += \" 计划入库和实际入库不相等,不能签到\";\
                        }\
                      }\
                      var msg = Wb.decode(resp.responseText);\
                      var bt = \"\";\
                      if (r[0].data.BILL_TYPE == \"E\")\
                        bt = \"吉柜\";\
                      if (r[0].data.BILL_TYPE == \"C\")\
                        bt = \"整柜\";\
                      if (r[0].data.BILL_TYPE == \"P\")\
                        bt = \"拼柜\";\
                      if (r[0].data.BILL_TYPE == \"S\")\
                        bt = \"散货\";\
                      var ie = \"\";\
                      if (r[0].data.I_E_ID == \"I\")\
                        ie = \"进口\";\
                      if (r[0].data.I_E_ID == \"E\")\
                        ie = \"出口\";\
                      if (msg.iserror == \"1\" || !Wb.isEmpty(rk)) {\
                        app.txtMsgqd.setValue(ie + bt + msg.message + rk);\
                        app.txtMsgqd.setFieldStyle(\"color:red;\");\
                      }\
                      if (msg.iserror == \"0\" && Wb.isEmpty(rk)) {\
                        app.txtMsgqd.setValue(ie + bt + msg.message + \"可以签到\");\
                        app.txtMsgqd.setFieldStyle(\"color:green;\");\
                      }\
                    }\
                  });\
                }\
              }\
            }\
          });\
        }\
      });\
    }\
  }\
});\
\
app.txtBILL_NO.selectText();"}
         },
         {
          "configs": {
           "itemId": "searchBtnC",
           "hidden": "true",
           "text": "箱号查询",
           "iconCls": "search_icon"
          },
          "expanded": false,
          "children": [],
          "type": "item",
          "events": {"click": "Wb.request({\
  url: \"m?xwl=BuzManage/bandanedit/getBillNoBycntr\",\
  params: {\
    cntr: app.txtCNTR.getValue()\
  },\
  success: function(resp) {\
    var result = Wb.decode(resp.responseText);\
    if (result.rows.length < 1) {\
      Wb.warn(\"没有找到提单\");\
      return;\
    }\
    if (result.rows.length > 1) {\
      Wb.warn(\"输入的箱号不够准确,请输入更准确的箱号\");\
      return;\
    }\
    app.txtBILL_NO.setValue(result.rows[0].BILL_NO);\
    app.searchBtn.fireEvent(\"click\");\
  }\
});"}
         },
         {
          "configs": {
           "itemId": "item1",
           "text": "-"
          },
          "expanded": false,
          "children": [],
          "type": "item"
         },
         {
          "configs": {
           "itemId": "YJT_TIME",
           "allowBlank": "false",
           "labelAlign": "right",
           "fieldLabel": "提柜时间",
           "width": "170",
           "labelWidth": "70"
          },
          "expanded": false,
          "children": [],
          "type": "date",
          "events": {"specialkey": "if (e.getKey() == e.ENTER) {\
  var store = app.gridXiang.getStore();\
  var sels = app.gridPortcntr.getSelection();\
  var AF1 = document.getElementById(opt);\
  if (Wb.isEmpty(app.txtBILL_NO_RB.getValue())) {\
    Wb.warn(\"没有找到提单\");\
    return;\
  }\
  if (store.data.items[0].data.BILL_TYPE != \"S\") {\
    if (sels.length <= 0) {\
      Wb.warn(\"请选择箱子\");\
      return;\
    }\
  }\
  var ids = \"\";\
  var cntr = \"\";\
  var cntrdata = new Array();\
  Wb.each(sels, function(sel) {\
    ids += \"'\" + sel.data.ID + \"',\";\
    cntr += sel.data.CNTR + \",\";\
    cntrdata.push(sel.data);\
  });\
  ids = ids.substring(0, ids.length - 1);\
  //调用接口查询费用--堆存费\
  Wb.request({\
    url: \"m?xwl=BuzManage/bandanedit/getReat\",\
    params: {\
      mth: \"call\",\
      bill_no: app.txtBILL_NO_RB.getValue(),\
      cntr: cntr,\
      planTime: app.YJT_TIME.getValue(),\
      ids: ids,\
      lclId: app.lclId,\
      cntrdata: cntrdata\
    },\
    success: function(resp) {\
      app.gridPortcntr.store.load({\
        out: app.tbarPanel\
      });\
      //显示费用\
      AF1.func(\"Load\", Wb.loadSupcanData(\"m?xwl=BuzManage/bandanedit/selectAccDetials\", {\
        billno: app.txtBILL_NO_RB.getValue()\
      }));\
    }\
  });\
}"}
         },
         {
          "configs": {
           "itemId": "jgBtn1",
           "hidden": "true",
           "text": "计费",
           "iconCls": "write_icon"
          },
          "expanded": false,
          "children": [],
          "type": "item",
          "events": {"click": "var username = '{#sys.username#}';\
var AF1 = document.getElementById(opt);\
if (Wb.isEmpty(app.txtBILL_NO_RB.getValue())) {\
  Wb.warn(\"没有找到提单\");\
  return;\
}\
Wb.request({\
  url: \"m?xwl=BuzManage/bandanedit/getReat1\",\
  params: {\
    bill_no: app.txtBILL_NO_RB.getValue()\
  },\
  success: function(resp) {\
    //显示费用\
    AF1.func(\"Load\", Wb.loadSupcanData(\"m?xwl=BuzManage/bandanedit/selectAccDetials\", {\
      billno: app.txtBILL_NO_RB.getValue()\
    }));\
  }\
});"}
         },
         {
          "configs": {
           "itemId": "qiandaoBtn",
           "text": "签到",
           "iconCls": "write_icon"
          },
          "expanded": false,
          "children": [],
          "type": "item",
          "events": {"click": "var username = '{#sys.username#}';\
if (Wb.isEmpty(app.txtBILL_NO_RB.getValue())) {\
  Wb.warn(\"没有找到提单\");\
  return;\
}\
var store = app.gridXiang.getStore();\
var storeC = app.gridPortcntr.getStore();\
if (!Wb.isEmpty(store.data.items[0].data.QD_BY)) {\
  Wb.warn(\"不能重复签到\");\
  return;\
}\
if (store.data.items[0].data.BILL_TYPE == \"P\" || store.data.items[0].data.BILL_TYPE == \"S\") {\
  if (store.data.items[0].data.INQUTY == 0) {\
    Wb.warn(\"入库数为0,不能签到\");\
    return;\
  }\
  if (store.data.items[0].data.PIECES != store.data.items[0].data.INQUTY) {\
    Wb.warn(\"计划入库和实际入库不相等,不能签到\");\
    return;\
  }\
}\
var errmsg = \"\";\
if ((store.data.items[0].data.BILL_TYPE == \"C\" || store.data.items[0].data.BILL_TYPE == \"E\") && store.data.items[0].data.I_E_ID == \"E\") {\
  Wb.each(storeC.data.items, function(item) {\
    console.log(item.data.CFS);\
    console.log(!Wb.isEmpty(item.data.CFS) && item.data.CFS != \"JGQ\");\
    console.log(Wb.isEmpty(item.data.CFS) && item.data.IN_JGQ == \"1\");\
\
    if (((!Wb.isEmpty(item.data.CFS) && item.data.CFS != \"JGQ\") ||\
        item.data.PHASE == 'OUT' ||\
        (Wb.isEmpty(item.data.CFS) && item.data.IN_JGQ == \"1\"))) //&& item.data.PHASE!='DEP'\
      errmsg += \"箱:\" + item.data.CNTR + \"不在监管区,不能签到 \";\
    if (item.data.PEF != item.data.E_F_ID)\
      errmsg += \"箱:\" + item.data.CNTR + \"空重不符,不能签到 \";\
  });\
}\
if (!Wb.isEmpty(errmsg)) {\
  Wb.warn(errmsg);\
  return;\
}\
Wb.request({\
  url: \"m?xwl=BuzManage/bandanedit/qiandao\",\
  params: {\
    QD_BY: username,\
    QD_ON: new Date(),\
    billno: app.txtBILL_NO_RB.getValue(),\
    YJT_TIME: app.YJT_TIME.getValue()\
  },\
  success: function(resp) {\
    app.gridXiang.store.load({\
      params: {\
        bill_no: app.txtBILL_NO_RB.getValue()\
      },\
      callback: function(r, options, success) {\
        if (success) {\
          if (r.length > 0) {\
            var bt = \"\";\
            if (r[0].data.BILL_TYPE == \"E\")\
              bt = \"吉柜\";\
            if (r[0].data.BILL_TYPE == \"C\")\
              bt = \"整柜\";\
            if (r[0].data.BILL_TYPE == \"P\")\
              bt = \"拼柜\";\
            if (r[0].data.BILL_TYPE == \"S\")\
              bt = \"散货\";\
            var ie = \"\";\
            if (r[0].data.I_E_ID == \"I\")\
              ie = \"进口\";\
            if (r[0].data.I_E_ID == \"E\")\
              ie = \"出口\";\
            app.txtMsgqd.setValue(ie + bt + \"签到完成\");\
            app.txtMsgqd.setFieldStyle(\"color:red;\");\
            if ('{#sys.TENANCY_ID#}' == 'ZSG')\
              Wb.request({ //锁定舱单\
                url: 'm?xwl=shipBIlla/supcanVbill/billEdit/billStateEdit/lockBill',\
                params: {\
                  ID: [r[0].data.BILL_ID]\
                },\
                success: function(resp) {}\
              });\
          }\
        }\
      }\
    });\
  }\
});"}
         },
         {
          "configs": {
           "itemId": "rqiandaoBtn",
           "text": "取消签到",
           "iconCls": "undo_icon"
          },
          "expanded": false,
          "children": [],
          "type": "item",
          "events": {"click": "if (Wb.isEmpty(app.txtBILL_NO_RB.getValue())) {\
  Wb.warn(\"没有找到提单\");\
  return;\
}\
var bd = 0;\
var store = app.gridPortcntr.getStore();\
Wb.each(store.data.items, function(item) {\
  if (!Wb.isEmpty(item.data.BD_BY))\
    bd++;\
});\
if (bd > 0) {\
  Wb.warn(\"提单有箱子已经办单,不能取消签到\");\
  return;\
}\
Wb.request({\
  url: \"m?xwl=BuzManage/bandanedit/rqiandao\",\
  params: {\
    QD_BY: \"\",\
    QD_ON: \"\",\
    billno: app.txtBILL_NO_RB.getValue()\
  },\
  success: function(resp) {\
    app.gridXiang.store.load({\
      params: {\
        bill_no: app.txtBILL_NO_RB.getValue()\
      },\
      callback: function(r, options, success) {\
        if (success) {\
          if (r.length > 0) {\
            app.lclId = Wb.isEmpty(r[0].data.LCL_ID) ? 0 : r[0].data.LCL_ID;\
            //             if (r[0].data.I_E_ID == \"I\") {\
            //               app.bandanBtn.setDisabled(false);\
            //               app.rbandanBtn.setDisabled(false);\
            //             }\
            //             if (r[0].data.I_E_ID == \"E\") {\
            //               app.bandanBtn.setDisabled(true);\
            //               app.rbandanBtn.setDisabled(true);\
            //             }\
            //箱签到条件判断\
            Wb.request({\
              url: \"m?xwl=BuzManage/bandanedit/getBdMessage\",\
              params: {\
                billNo: app.txtBILL_NO_RB.getValue()\
              },\
              success: function(resp) {\
                var rk = \"\";\
                if (r[0].data.BILL_TYPE == \"P\" || r[0].data.BILL_TYPE == \"S\") {\
                  if (r[0].data.INQUTY == 0) {\
                    rk += \" 入库数为0\";\
                  }\
                  if (r[0].data.PIECES != r[0].data.INQUTY) {\
                    rk += \" 计划入库和实际入库不相等\";\
                  }\
                }\
                var msg = Wb.decode(resp.responseText);\
                var bt = \"\";\
                if (r[0].data.BILL_TYPE == \"E\")\
                  bt = \"吉柜\";\
                if (r[0].data.BILL_TYPE == \"C\")\
                  bt = \"整柜\";\
                if (r[0].data.BILL_TYPE == \"P\")\
                  bt = \"拼柜\";\
                if (r[0].data.BILL_TYPE == \"S\")\
                  bt = \"散货\";\
                var ie = \"\";\
                if (r[0].data.I_E_ID == \"I\")\
                  ie = \"进口\";\
                if (r[0].data.I_E_ID == \"E\")\
                  ie = \"出口\";\
                if (msg.iserror == \"1\" || !Wb.isEmpty(rk)) {\
                  app.txtMsgqd.setValue(ie + bt + msg.message + rk);\
                  app.txtMsgqd.setFieldStyle(\"color:red;\");\
                }\
                if (msg.iserror == \"0\" && Wb.isEmpty(rk)) {\
                  app.txtMsgqd.setValue(ie + bt + msg.message + \"可以签到\");\
                  app.txtMsgqd.setFieldStyle(\"color:green;\");\
                }\
              }\
            });\
          }\
        }\
      }\
    });\
  }\
});"}
         },
         {
          "configs": {
           "itemId": "selBjdc",
           "hidden": "true",
           "text": "补算堆存",
           "iconCls": "write_icon"
          },
          "expanded": false,
          "children": [],
          "type": "item",
          "events": {"click": "var AF1 = document.getElementById(opt);\
if (Wb.isEmpty(app.txtBILL_NO_RB.getValue())) {\
  Wb.warn(\"没有找到提单\");\
  return;\
}\
var sels = app.gridPortcntr.getSelection();\
if (sels.length <= 0) {\
  Wb.warn(\"请选择箱子\");\
  return;\
}\
var cntr = \"\";\
Wb.each(sels, function(sel) {\
  cntr += sel.data.CNTR + \",\";\
});\
//调用接口查询费用--堆存费\
Wb.request({\
  url: \"m?xwl=BuzManage/bandanedit/getReat\",\
  params: {\
    mth: \"call\",\
    bill_no: app.txtBILL_NO_RB.getValue(),\
    cntr: cntr,\
    planTime: app.YJT_TIME.getValue(),\
    lclId: app.lclId\
  },\
  success: function(resp) {\
    //显示费用\
    AF1.func(\"Load\", Wb.loadSupcanData(\"m?xwl=BuzManage/bandanedit/selectAccDetials\", {\
      billno: app.txtBILL_NO_RB.getValue()\
    }));\
  }\
});"}
         },
         {
          "configs": {
           "itemId": "txtBILL_NO_RB",
           "hidden": "true",
           "labelAlign": "right",
           "fieldLabel": "提单号",
           "labelWidth": "60"
          },
          "expanded": true,
          "children": [],
          "type": "text"
         },
         {
          "configs": {
           "itemId": "txtCNTRS",
           "hidden": "true",
           "labelAlign": "right",
           "fieldLabel": "选择的箱号",
           "labelWidth": "80"
          },
          "expanded": true,
          "children": [],
          "type": "text"
         },
         {
          "configs": {
           "itemId": "payBtn",
           "text": "确认收费",
           "iconCls": "textarea_icon"
          },
          "expanded": false,
          "children": [],
          "type": "item",
          "events": {"click": "if (Wb.isEmpty(app.txtBILL_NO_RB.getValue())) {\
  Wb.warn(\"没有找到提单\");\
  return;\
}\
var AF1 = document.getElementById(opt);\
Wb.request({\
  url: \"m?xwl=BuzManage/toll/invoiceSerial/testSettlement\",\
  params: {\
    billNo: app.txtBILL_NO_RB.getValue()\
  },\
  success: function(resp) {\
    var customer = Wb.decode(\"{\" + resp.responseText + \"}\");\
    var win = new Ext.window.Window(app._winSETTLEMENTBODY);\
    win.down('[iconCls=ok_icon]').hide(); //隐藏窗体确定按钮\
    win.show();\
    app.cboP.setValue(\"2\");\
    Wb.loadComboFilter(app.ACCOUNT_CUSTOMER_ID, {\
      query: customer.NAME\
    }, function() {\
      app.ACCOUNT_CUSTOMER_ID.setValue(customer.ID);\
    });\
    Wb.request({\
      url: \"m?xwl=BuzManage/bandanedit/fapiaohao\",\
      params: {\
        invoiceType: app.cboP.getValue()\
      },\
      success: function(resp) {\
        console.log(resp.responseText);\
        app.txtSETTLEMENT_CODE.setValue(resp.responseText);\
      }\
    });\
    app.gridSETTLEBODY.store.load({\
      params: {\
        billno: app.txtBILL_NO_RB.getValue()\
      }\
    });\
  }\
});"}
         },
         {
          "configs": {
           "itemId": "bandanBtn",
           "hidden": "'{#sys.TENANCY_ID#}'=='XLG'",
           "text": "办单",
           "iconCls": "write_icon"
          },
          "expanded": false,
          "children": [],
          "type": "item",
          "events": {"click": "var store = app.gridXiang.getStore();\
if (store.data.items.length < 1) {\
  Wb.warn(\"没有办单信息\");\
  return;\
}\
if (store.data.items[0].data.BILL_TYPE == \"S\")\
  app.bandanBtnS.fireEvent(\"click\");\
else\
  app.bandanBtnC.fireEvent(\"click\");"}
         },
         {
          "configs": {
           "itemId": "bandanBtnC",
           "hidden": "true",
           "text": "集装箱办单",
           "iconCls": "write_icon"
          },
          "expanded": false,
          "children": [],
          "type": "item",
          "events": {"click": "var username = '{#sys.username#}';\
if (!Wb.verify(app.tbarPanel))\
  return false;\
if (Wb.isEmpty(app.txtBILL_NO_RB.getValue())) {\
  Wb.warn(\"没有找到提单\");\
  return;\
}\
var sels = app.gridPortcntr.getSelection();\
if (sels.length <= 0) {\
  Wb.warn(\"请选择箱子\");\
  return;\
}\
var ids = \"\";\
var cntrs = \"\";\
var cntrdata = new Array();\
Wb.each(sels, function(sel) {\
  ids += \"'\" + sel.data.ID + \"',\";\
  cntrs += \"'\" + sel.data.CNTR + \"',\";\
  cntrdata.push(sel.data);\
});\
ids = ids.substring(0, ids.length - 1);\
cntrs = cntrs.substring(0, cntrs.length - 1);\
\
//检查是否能够办单\
Wb.request({\
  url: \"m?xwl=BuzManage/bandanedit/bandanCheck\",\
  params: {\
    cntrs: cntrs,\
    billno: app.txtBILL_NO_RB.getValue()\
  },\
  success: function(resp) {\
    var errmsg = resp.responseText;\
    if (!Wb.isEmpty(errmsg)) {\
      Wb.warn(errmsg);\
      app.txtMsgbd.setValue(errmsg);\
      return;\
    } else {\
      app.txtMsgbd.setValue(\"\");\
      //办单操作\
      Wb.request({\
        url: \"m?xwl=BuzManage/bandanedit/bandan\",\
        params: {\
          BD_BY: username,\
          BD_ON: new Date(),\
          YJT_TIME: app.YJT_TIME.getValue(),\
          ids: ids,\
          cntrdata: cntrdata,\
          bd: \"ban\"\
        },\
        success: function(resp) {\
          Wb.info(\"操作完成\");\
          app.gridPortcntr.store.load({\
            out: app.tbarPanel\
          });\
        }\
      });\
    }\
  }\
});"}
         },
         {
          "configs": {
           "itemId": "bandanBtnS",
           "hidden": "true",
           "text": "散货办单",
           "iconCls": "write_icon"
          },
          "expanded": false,
          "children": [],
          "type": "item",
          "events": {"click": "var username = '{#sys.username#}';\
//检查是否能够办单\
Wb.request({\
  url: \"m?xwl=BuzManage/bandanedit/sbandanCheck\",\
  params: {\
    billno: app.txtBILL_NO_RB.getValue()\
  },\
  success: function(resp) {\
    var errmsg = resp.responseText;\
    if (!Wb.isEmpty(errmsg)) {\
      Wb.warn(errmsg);\
      app.txtMsgbd.setValue(errmsg);\
      return;\
    } else {\
      app.txtMsgbd.setValue(\"\");\
      //办单操作\
      Wb.request({\
        url: \"m?xwl=BuzManage/bandanedit/sbandan\",\
        params: {\
          BD_BY: username,\
          BD_ON: new Date(),\
          billno: app.txtBILL_NO_RB.getValue()\
        },\
        success: function(resp) {\
          app.gridXiang.store.load({\
            params: {\
              bill_no: app.txtBILL_NO_RB.getValue()\
            }\
          });\
        }\
      });\
    }\
  }\
});"}
         },
         {
          "configs": {
           "itemId": "rbandanBtn",
           "hidden": "'{#sys.TENANCY_ID#}'=='XLG'",
           "text": "取消办单",
           "iconCls": "undo_icon"
          },
          "expanded": false,
          "children": [],
          "type": "item",
          "events": {"click": "var store = app.gridXiang.getStore();\
if (store.data.items.length < 1) {\
  Wb.warn(\"没有办单信息\");\
  return;\
}\
if (store.data.items[0].data.BILL_TYPE == \"S\")\
  app.rbandanBtnS.fireEvent(\"click\");\
else\
  app.rbandanBtnC.fireEvent(\"click\");"}
         },
         {
          "configs": {
           "itemId": "rbandanBtnC",
           "hidden": "true",
           "text": "集装箱取消办单",
           "iconCls": "undo_icon"
          },
          "expanded": false,
          "children": [],
          "type": "item",
          "events": {"click": "if (Wb.isEmpty(app.txtBILL_NO_RB.getValue())) {\
  Wb.warn(\"没有找到提单\");\
  return;\
}\
var sels = app.gridPortcntr.getSelection();\
if (sels.length <= 0) {\
  Wb.warn(\"请选择箱子\");\
  return;\
}\
var ids = \"\";\
Wb.each(sels, function(sel) {\
  ids += \"'\" + sel.data.ID + \"',\";\
});\
ids = ids.substring(0, ids.length - 1);\
Wb.request({\
  url: \"m?xwl=BuzManage/bandanedit/bandan\",\
  params: {\
    ids: ids\
  },\
  success: function(resp) {\
    Wb.info(\"操作完成\");\
    app.gridPortcntr.store.load({\
      out: app.tbarPanel\
    });\
  }\
});"}
         },
         {
          "configs": {
           "itemId": "rbandanBtnS",
           "hidden": "true",
           "text": "散货取消办单",
           "iconCls": "undo_icon"
          },
          "expanded": false,
          "children": [],
          "type": "item",
          "events": {"click": "var username = '{#sys.username#}';\
//办单操作\
Wb.request({\
  url: \"m?xwl=BuzManage/bandanedit/sbandan\",\
  params: {\
    BD_BY: \"\",\
    BD_ON: \"\",\
    billno: app.txtBILL_NO_RB.getValue()\
  },\
  success: function(resp) {\
    app.gridXiang.store.load({\
      params: {\
        bill_no: app.txtBILL_NO_RB.getValue()\
      }\
    });\
  }\
});"}
         },
         {
          "configs": {
           "itemId": "btnadd_s",
           "text": "散货添加费用",
           "iconCls": "add_icon"
          },
          "expanded": false,
          "children": [],
          "type": "item",
          "events": {"click": "var store = app.gridXiang.getStore();\
if (store.data.items.length < 1) {\
  Wb.warn(\"没有找到散货提单\");\
  return;\
}\
if (store.data.items[0].data.BILL_TYPE != \"S\") {\
  Wb.warn(\"不是散货,不能做此操作\");\
  return;\
}\
var win = new Ext.window.Window(app._winAccDetails);\
win.show();\
app.ACCBILL_NO.setValue(app.txtBILL_NO_RB.getValue());\
Wb.request({\
  url: \"m?xwl=BuzManage/bandanedit/copyAccount\",\
  params: {\
    billno: app.txtBILL_NO_RB.getValue()\
  },\
  success: function(resp) {\
    var result = Wb.decode(resp.responseText);\
    if (result.length > 0) {\
      Wb.setValue(app.panelAccDetails, result[0]);\
      app.CNTR_OPERATOR_COD.setValue(result[0].CNTR_OPERATOR_COD);\
      //货主\
      Wb.loadComboAdd(app.CUSTOMER_ID, [{\
        \"ID\": result[0].CUSTOMER_ID,\
        \"CNAME\": result[0].CUSTOMER_NAM\
      }], function() {\
        app.CUSTOMER_ID.setValue(result[0].CUSTOMER_ID);\
        app.CUSTOMER_NAM.setValue(result[0].CUSTOMER_NAM);\
      });\
      //计费对象\
      Wb.loadComboAdd(app.ACCOUNT_CUSTOMER_CODE, [{\
        \"ID\": result[0].CUSTOMER_ID,\
        \"CNAME\": result[0].CUSTOMER_NAM\
      }], function() {\
        app.ACCOUNT_CUSTOMER_CODE.setValue(result[0].CUSTOMER_ID);\
        app.ACCOUNT_CUSTOMER_NAM.setValue(result[0].CUSTOMER_NAM);\
      });\
      //付费对象\
      Wb.loadComboAdd(app.PAYMENT_CUSTOMER_CODE, [{\
        \"ID\": result[0].CUSTOMER_ID,\
        \"CNAME\": result[0].CUSTOMER_NAM\
      }], function() {\
        app.PAYMENT_CUSTOMER_CODE.setValue(result[0].CUSTOMER_ID);\
        app.PAYMENT_CUSTOMER_NAM.setValue(result[0].CUSTOMER_NAM);\
      });\
    }\
  }\
});\
// var s = AF.func(\"GetChangedXML\", \"level=\" + level + \"; returnFormat=\" + returnFmt);\
// if (s == \"0\") { //返回 0 , 表示失败\
//   return;\
// }\
// if (s == null || s == \"\") {\
//   AF.func(\"MessageBoxFloat\", \"请先作增、删、改操作!\t\");\
//   return;\
// }\
// //正常返回\
// if (s.length > 2000) {\
//   s = s.substr(0, 2000);\
//   s += \"\\r\\
(以下略)\";\
// }\
// s = s.replace(/\\r\\
/g, \"\\\\r\\\\
\");\
// AF.func(\"MessageBoxFloat\", s + \"\\r\\
 center=true;hold=120\");"}
         },
         {
          "configs": {
           "itemId": "btnsaddress",
           "text": "散货拖送地址",
           "iconCls": "vans_icon"
          },
          "expanded": false,
          "children": [],
          "type": "item",
          "events": {"click": "if (Wb.isEmpty(app.txtBILL_NO_RB.getValue())) {\
  Wb.warn(\"请输入提单号\");\
  return;\
}\
Wb.request({\
  url: 'm?xwl=BuzManage/bandanedit/selectBillAddr',\
  params: {\
    billno: app.txtBILL_NO_RB.getValue()\
  },\
  success: function(resp) {\
    var res = Wb.decode(resp.responseText);\
    console.log(res);\
    var win = new Ext.window.Window(app._winSADDRESS);\
    win.show();\
    if (!Wb.isEmpty(res[0].FORWARDER))\
      Wb.loadComboAdd(app.S_ADRESS, [{\
        \"ID\": res[0].FORWARDER,\
        \"NAME\": res[0].NAME\
      }], function() {\
        app.S_ADRESS.setValue(res[0].FORWARDER);\
      });\
  }\
});"}
         }
        ],
        "type": "toolbar"
       },
       {
        "configs": {
         "layout": "border",
         "border": "false",
         "itemId": "panelTidan",
         "width": "550",
         "region": "west"
        },
        "expanded": true,
        "children": [{
         "configs": {
          "itemId": "gridPortcntr",
          "selType": "checkboxmodel",
          "pagingBar": "false",
          "disabled": "false",
          "region": "center",
          "multiSelect": "true"
         },
         "expanded": true,
         "children": [
          {
           "configs": {
            "itemId": "store",
            "url": "m?xwl=BuzManage/bandanedit/selectBUZ"
           },
           "expanded": false,
           "children": [],
           "type": "store",
           "events": {"load": "app.gridPortcntr.setSelection(records);"}
          },
          {
           "configs": {"itemId": "columns"},
           "expanded": true,
           "children": [
            {
             "configs": {
              "itemId": "colID",
              "hidden": "true",
              "dataIndex": "ID",
              "text": "ID"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colTENANCY_ID",
              "hidden": "true",
              "dataIndex": "TENANCY_ID",
              "text": "租户"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "column1",
              "xtype": "rownumberer"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colop",
              "xtype": "actioncolumn",
              "dataIndex": "op",
              "width": "40",
              "text": "操作",
              "align": "center",
              "titleAlign": "center"
             },
             "expanded": true,
             "children": [{
              "configs": {"itemId": "items"},
              "expanded": true,
              "children": [
               {
                "configs": {
                 "itemId": "addfmBtn",
                 "handler": "var win = new Ext.window.Window(app._winAccDetails); //app._win指向配置对象而非实例\
win.setTitle('添加 - 费用明细');\
win.setIconCls('record_add_icon');\
win.show();\
app.ACCBILL_NO.setValue(app.txtBILL_NO_RB.getValue());\
app.CNTR.setValue(record.data.CNTR);\
Wb.request({\
  url: \"m?xwl=BuzManage/bandanedit/copyAccount\",\
  params: {\
    billno: app.txtBILL_NO_RB.getValue(),\
    cntr: app.CNTR.getValue()\
  },\
  success: function(resp) {\
    var result = Wb.decode(resp.responseText);\
    if (result.length > 0) {\
      Wb.setValue(app.panelAccDetails, result[0]);\
      //货主\
      Wb.loadComboAdd(app.CUSTOMER_ID, [{\
        \"ID\": result[0].CUSTOMER_ID,\
        \"CNAME\": result[0].CUSTOMER_NAM\
      }], function() {\
        app.CUSTOMER_ID.setValue(result[0].CUSTOMER_ID);\
        app.CUSTOMER_NAM.setValue(result[0].CUSTOMER_NAM);\
      });\
      //计费对象\
      Wb.loadComboAdd(app.ACCOUNT_CUSTOMER_CODE, [{\
        \"ID\": result[0].CUSTOMER_ID,\
        \"CNAME\": result[0].CUSTOMER_NAM\
      }], function() {\
        app.ACCOUNT_CUSTOMER_CODE.setValue(result[0].CUSTOMER_ID);\
        app.ACCOUNT_CUSTOMER_NAM.setValue(result[0].CUSTOMER_NAM);\
      });\
      //付费对象\
      Wb.loadComboAdd(app.PAYMENT_CUSTOMER_CODE, [{\
        \"ID\": result[0].CUSTOMER_ID,\
        \"CNAME\": result[0].CUSTOMER_NAM\
      }], function() {\
        app.PAYMENT_CUSTOMER_CODE.setValue(result[0].CUSTOMER_ID);\
        app.PAYMENT_CUSTOMER_NAM.setValue(result[0].CUSTOMER_NAM);\
      });\
    }\
  }\
});",
                 "tooltip": "添加费目",
                 "iconCls": "add_icon"
                },
                "expanded": false,
                "children": [],
                "type": "column"
               },
               {
                "configs": {
                 "itemId": "btncargotype",
                 "handler": "var win = new Ext.window.Window(app._winCargoType); //app._win指向配置对象而非实例\
win.setTitle('修改 - 货物属性');\
win.setIconCls('record_add_icon');\
win.show();\
app.CGCNTR.setValue(record.data.CNTR);\
app.CARGO_TYPE.setValue(record.data.CARGO_TYPE);",
                 "tooltip": "修改货物属性",
                 "iconCls": "record_edit_icon"
                },
                "expanded": false,
                "children": [],
                "type": "column"
               }
              ],
              "type": "array"
             }],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colCNTR",
              "dataIndex": "CNTR",
              "text": "箱号"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colRELEASE_ID",
              "xtype": "checkcolumn",
              "dataIndex": "RELEASE_ID",
              "width": "40",
              "text": "放行"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colYARD_POSITION",
              "dataIndex": "YARD_POSITION",
              "text": "位置"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colGOODS_NOTES",
              "dataIndex": "GOODS_NOTES",
              "text": "货物"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colPIECES",
              "dataIndex": "PIECES",
              "width": "40",
              "text": "件数"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colWEIGHT",
              "dataIndex": "WEIGHT",
              "width": "60",
              "text": "重量"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colVOLUME",
              "dataIndex": "VOLUME",
              "width": "60",
              "text": "体积"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colIN_PORT_TIME",
              "dataIndex": "IN_PORT_TIME",
              "width": "80",
              "text": "进场时间"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colYJT_TIME",
              "dataIndex": "YJT_TIME",
              "width": "80",
              "text": "提柜时间"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colBD_BY",
              "dataIndex": "BD_BY",
              "width": "60",
              "text": "办单人"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colBD_ON",
              "dataIndex": "BD_ON",
              "width": "120",
              "text": "办单时间"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colPHASE",
              "renderer": "if (value == \"ADV\")\
  return \"预报\";\
if (value == \"OUT\")\
  return \"闸外\";\
if (value == \"ACT\")\
  return \"闸内\";\
if (Wb.isEmpty(value))\
  return \"核销\";",
              "dataIndex": "PHASE",
              "width": "66",
              "text": "闸内闸外"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colE_F_ID",
              "dataIndex": "E_F_ID",
              "width": "40",
              "keyName": "E_F_ID",
              "text": "空重"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colCNTR_SIZE",
              "dataIndex": "CNTR_SIZE",
              "width": "40",
              "keyName": "CNTR_SIZE",
              "text": "尺寸"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colCNTR_TYPE",
              "dataIndex": "CNTR_TYPE",
              "width": "60",
              "keyName": "CNTR_TYPE",
              "text": "箱型"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colREEF_ID",
              "xtype": "checkcolumn",
              "dataIndex": "REEF_ID",
              "width": "40",
              "text": "冷冻"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colCARGO_TYPE",
              "dataIndex": "CARGO_TYPE",
              "width": "70",
              "keyName": "CARGO_TYPE",
              "text": "货物属性"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colCARGO_TYPE1",
              "dataIndex": "CFS",
              "width": "70",
              "text": "货物属性"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colCARGO_TYPE11",
              "dataIndex": "IN_JGQ",
              "width": "70",
              "text": "货物属性"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            }
           ],
           "type": "array"
          }
         ],
         "type": "grid"
        }],
        "type": "panel"
       },
       {
        "configs": {
         "layout": "border",
         "border": "false",
         "itemId": "panelEast",
         "region": "center"
        },
        "expanded": true,
        "children": [
         {
          "configs": {
           "layout": "border",
           "border": "false",
           "itemId": "panelMsg",
           "region": "north",
           "height": "80"
          },
          "expanded": true,
          "children": [
           {
            "configs": {
             "layout": "fit",
             "border": "false",
             "itemId": "panelMsgqd",
             "width": "300",
             "region": "west"
            },
            "expanded": true,
            "children": [{
             "configs": {
              "itemId": "txtMsgqd",
              "fieldStyle": "color:red;"
             },
             "expanded": false,
             "children": [],
             "type": "textarea"
            }],
            "type": "panel"
           },
           {
            "configs": {
             "layout": "fit",
             "border": "false",
             "itemId": "panelMsgbd",
             "region": "center"
            },
            "expanded": true,
            "children": [{
             "configs": {
              "itemId": "txtMsgbd",
              "width": "100",
              "fieldStyle": "color:red;"
             },
             "expanded": false,
             "children": [],
             "type": "textarea"
            }],
            "type": "panel"
           }
          ],
          "type": "panel"
         },
         {
          "configs": {
           "layout": "border",
           "border": "false",
           "itemId": "panelXiang",
           "region": "center"
          },
          "expanded": true,
          "children": [{
           "configs": {
            "itemId": "gridXiang",
            "pagingBar": "false",
            "region": "center"
           },
           "expanded": true,
           "children": [
            {
             "configs": {
              "itemId": "store",
              "url": "m?xwl=BuzManage/bandanedit/statistics"
             },
             "expanded": false,
             "children": [],
             "type": "store"
            },
            {
             "configs": {"itemId": "columns"},
             "expanded": true,
             "children": [
              {
               "configs": {
                "itemId": "colID",
                "hidden": "true",
                "dataIndex": "ID",
                "text": "ID"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "colTENANCY_ID",
                "hidden": "true",
                "dataIndex": "TENANCY_ID",
                "text": "租户"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "column1",
                "xtype": "rownumberer"
               },
               "expanded": true,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "colSHIPPER",
                "dataIndex": "SHIPPER",
                "text": "货主"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "colBILL_NO",
                "dataIndex": "BILL_NO",
                "text": "提单号"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "colBILL_TYPE",
                "dataIndex": "BILL_TYPE",
                "keyName": "BILL_TYPE",
                "width": "70",
                "text": "运输包装"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "colCNTR20",
                "dataIndex": "CNTR20",
                "width": "55",
                "text": "20尺箱"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "colCNTR40",
                "dataIndex": "CNTR40",
                "width": "55",
                "text": "40尺箱"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "colCNTR45",
                "dataIndex": "CNTR45",
                "width": "55",
                "text": "45尺箱"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "colCNTRNUM",
                "dataIndex": "CNTRNUM",
                "width": "50",
                "text": "箱量"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "colWEIGHT",
                "dataIndex": "WEIGHT",
                "width": "70",
                "text": "重量"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "colPIECES",
                "dataIndex": "PIECES",
                "width": "70",
                "text": "计划入库"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "colINQUTY",
                "dataIndex": "INQUTY",
                "width": "70",
                "text": "实际入库"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "colGOODS_NOTES",
                "dataIndex": "GOODS_NOTES",
                "text": "货物"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "colQD_BY",
                "dataIndex": "QD_BY",
                "keyName": "WB_USER",
                "text": "签到人"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "colQD_ON",
                "dataIndex": "QD_ON",
                "width": "120",
                "text": "签到时间"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "colBD_BY",
                "dataIndex": "BD_BY",
                "keyName": "WB_USER",
                "text": "办单人"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "colBD_ON",
                "dataIndex": "BD_ON",
                "width": "120",
                "text": "办单时间"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "colI_E_ID",
                "dataIndex": "I_E_ID",
                "keyName": "I_E_ID",
                "width": "60",
                "text": "进出口"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "colCNTR_OPERATOR_COD",
                "dataIndex": "CNTR_OPERATOR_COD",
                "keyName": "AG_SHORT",
                "width": "70",
                "text": "船公司"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              }
             ],
             "type": "array"
            }
           ],
           "type": "grid"
          }],
          "type": "panel"
         }
        ],
        "type": "panel"
       }
      ],
      "type": "panel"
     },
     {
      "configs": {
       "layout": "border",
       "border": "false",
       "itemId": "panel1",
       "rbar": "app.tbarGrid",
       "region": "center"
      },
      "expanded": true,
      "children": [{
       "configs": {
        "border": "false",
        "itemId": "panelAcc",
        "tbar": "app.hjbar",
        "region": "center",
        "height": "350"
       },
       "expanded": true,
       "children": [],
       "type": "panel"
      }],
      "type": "panel"
     },
     {
      "configs": {
       "border": "false",
       "itemId": "panelPrint",
       "region": "south",
       "height": "0"
      },
      "expanded": true,
      "children": [],
      "type": "panel"
     }
    ],
    "type": "viewport",
    "events": {"afterrender": "var mt1 = bldStr(\"BCV1.TreeList\", opt, \"\", \"100%\");\
app.panelAcc.update(mt1);\
var mt2 = bldStr(\"LuxForm\", opt2, \"\", \"100%\");\
app.panelPrint.update(mt2);"}
   }
  ],
  "type": "module",
  "events": {
   "finalize": "var tenancyid = \"{#sys.TENANCY_ID#}\";\
app.YJT_TIME.setValue(new Date());\
window[\"init\" + opt] = function(id) {\
  var m = document.getElementById(opt);\
  if (id == opt) {\
    m.func(\"setCookie\", \"JSESSIONID={#JSESSIONID#}\");\
    m.func(\"Build\", '/supcan/report/buz/qd_accounts.xml?tt=' + Math.round(Math.random() * 100));\
    m.func(\"DisableMenu\", \"showRuler,exportAll,printAll,delete,insert,import ,curselMode,hue ,language , enter    \\r\\
 true\");\
  }\
};\
window[\"init\" + opt2] = function(id) {\
  var m = document.getElementById(opt2);\
  if (id == opt2) {\
    m.func(\"setCookie\", \"JSESSIONID={#JSESSIONID#}\");\
    m.func(\"Build\", '/supcan/report/fee/month_acc.xml?' + Math.round(Math.random() * 100));\
    m.func(\"DisableMenu\", \"showRuler,exportAll,printAll,delete,insert,import ,curselMode,hue ,language , enter    \\r\\
 true\");\
  }\
};\
window[\"event\" + opt] = function(id, Event, p1, p2, p3, p4) {\
  var AF1 = document.getElementById(opt);\
  if (Event == \"MenuBeforePopup\" && id == opt) {\
    var menu = \"\";\
    var aid = Wb.getSupcanMelu(AF1, \"ID\", false);\
    if (!Wb.isEmpty(aid)) {\
      menu += \"id=4674; text='删除费用';\";\
      menu += \"enabled= true \\r\\
\";\
      menu += \"id=4675; text='打印托收单';\";\
      menu += \"enabled= true \\r\\
\";\
    }\
    AF1.func(\"AddMenu\", menu + \" \\r\\
 LocateAt=top\");\
  } else if (Event == \"MenuClicked\" && id == opt) {\
    if (p1 == '4674') { //删除费用\
      var selids = Wb.getSupcanMelu(AF1, \"ID\", true);\
      if (Wb.isEmpty(selids)) {\
        Wb.warn(\"请选择要移除的费用\");\
        return;\
      }\
      var ids = \"\";\
      Wb.each(selids, function(id) {\
        ids += id + \",\";\
      });\
      Wb.confirm(\"要删除选中费用\", function() {\
        Wb.request({\
          url: \"m?xwl=BuzManage/bandanedit/deleteAccountJava\",\
          params: {\
            ids: ids\
          },\
          success: function(resp) {\
            AF1.func(\"Load\", Wb.loadSupcanData(\"m?xwl=BuzManage/bandanedit/selectAccDetials\", {\
              billno: app.txtBILL_NO_RB.getValue()\
            }));\
          }\
        });\
      });\
    }\
    if (p1 == '4675') { //打印托收单\
      var selfids = Wb.getSupcanMelu(AF1, \"FEE_LIST_ID\", true);\
      if (Wb.isEmpty(selfids)) {\
        Wb.warn(\"请选择要打印的费用\");\
        return;\
      }\
      var fids = \"\";\
      Wb.each(selfids, function(id) {\
        fids += \"'\" + id + \"',\";\
      });\
      fids = fids.substring(0, fids.length - 1);\
      var selaids = Wb.getSupcanMelu(AF1, \"ID\", true);\
      var aids = \"\";\
      Wb.each(selaids, function(id) {\
        aids += id + \",\";\
      });\
      Wb.confirm(\"确认打印后,费用将自动转换为月结费用\", function() {\
        Wb.request({\
          url: \"m?xwl=feeManage/detail/java/payToMonth\",\
          params: {\
            detailIds: aids\
          },\
          success: function(resp) {\
            var res = Wb.decode(resp.responseText);\
            if (res.success) {\
              var AF2 = document.getElementById(opt2);\
              var whereSql = encodeURI(\" and ad.tenancy_id='\" + tenancyid + \"' and ad.bill_no='\" + app.txtBILL_NO_RB.getValue() + \"'\");\
              var whereSql1 = encodeURI(\" and ad.tenancy_id='\" + tenancyid + \"' and ad.bill_no='\" + app.txtBILL_NO_RB.getValue() + \"' and fee_list_id in(\" + fids + \")\");\
              AF2.func(\"SetParas\", \"ds1 \\r\\
 para=1;whereSql=\" + whereSql + \";drr=\" + new Date().getTime() + \";tenancyId=\" + tenancyid);\
              AF2.func(\"SetParas\", \"ds2 \\r\\
 para=1;whereSql=\" + whereSql1 + \";drr=\" + new Date().getTime() + \";tenancyId=\" + tenancyid);\
              AF2.func(\"Calc\", \"\");\
              AF2.func(\"callfunc\", \"18\");\
              AF1.func(\"Load\", Wb.loadSupcanData(\"m?xwl=BuzManage/bandanedit/selectAccDetials\", {\
                billno: app.txtBILL_NO_RB.getValue()\
              }));\
            } else {\
              Wb.warn(res.msg);\
            }\
          }\
        });\
      });\
    }\
  }\
};",
   "initialize": "var opt = Wb.getId();\
var opt2 = Wb.getId();"
  }
 }],
 "roles": {
  "ZSGHUQD": 1,
  "xlcwb": 1,
  "JCB": 1,
  "SWB": 1
 },
 "title": "外贸签到收费",
 "iconCls": "",
 "inframe": false,
 "pageLink": ""
}