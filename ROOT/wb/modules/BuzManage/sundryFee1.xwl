{
 "hidden": true,
 "children": [{
  "configs": {"itemId": "module"},
  "expanded": true,
  "children": [
   {
    "configs": {
     "layout": "border",
     "itemId": "hiswin",
     "dialog": "true",
     "closeAction": "destroy",
     "width": "840",
     "modal": "true",
     "height": "620"
    },
    "expanded": false,
    "children": [
     {
      "configs": {
       "layout": "@{type:'table',columns:3}",
       "border": "false",
       "itemId": "panel1",
       "defaults": "{\
  labelWidth: 60,\
  width: 210,\
  margin: '8 0 0 8'\
}",
       "region": "north",
       "height": "65"
      },
      "expanded": true,
      "children": [
       {
        "configs": {
         "itemId": "BILL_NO",
         "labelAlign": "right",
         "fieldLabel": "提单号"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "FEE_LIST_ID",
         "queryMode": "local",
         "hidden": "true",
         "labelAlign": "right",
         "fieldLabel": "费目",
         "displayField": "CNAME",
         "valueField": "ID"
        },
        "expanded": true,
        "children": [{
         "configs": {
          "itemId": "store",
          "autoLoad": "true",
          "params": "{fldId:'C_BASE_CHARGING_ITEM'}",
          "url": "m?xwl=system/common/codeSelect"
         },
         "expanded": false,
         "children": [],
         "type": "store"
        }],
        "type": "combo"
       },
       {
        "configs": {
         "hideTrigger": "true",
         "itemId": "ACCOUNT_CUSTOMER_CODE",
         "labelAlign": "right",
         "fieldLabel": "付费人",
         "selectOnTab": "true",
         "isUpperCase": "true",
         "displayField": "CNAME",
         "valueField": "CNAME",
         "queryDelay": "500"
        },
        "expanded": false,
        "children": [{
         "configs": {
          "itemId": "store",
          "autoLoad": "true",
          "url": "m?xwl=system/common/client/clientSelect"
         },
         "expanded": false,
         "children": [],
         "type": "store"
        }],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "PAYMENT_TYPE",
         "labelAlign": "right",
         "pickList": "[\
  [1, '现金'],\
  [2, '月结']\
]",
         "fieldLabel": "支付类型",
         "labelWidth": "70",
         "forceSelection": "true"
        },
        "expanded": false,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "createBegin",
         "labelAlign": "right",
         "fieldLabel": "开始时间",
         "labelWidth": "70"
        },
        "expanded": false,
        "children": [],
        "type": "date"
       },
       {
        "configs": {
         "itemId": "createEnd",
         "labelAlign": "right",
         "fieldLabel": "结束时间",
         "labelWidth": "70"
        },
        "expanded": false,
        "children": [],
        "type": "date"
       },
       {
        "configs": {
         "itemId": "queryBtn",
         "width": "60",
         "text": "查询",
         "iconCls": "search_icon"
        },
        "expanded": false,
        "children": [],
        "type": "button",
        "events": {"click": "app.titlegrid.store.load({\
\tout:app.panel1\
});\
// app.infogrid.store.load({\
// });\
// app.feegrid.store.load({\
// });"}
       }
      ],
      "type": "panel"
     },
     {
      "configs": {
       "itemId": "titlegrid",
       "x": "-8",
       "width": "320",
       "y": "192",
       "region": "center",
       "height": "240"
      },
      "expanded": true,
      "children": [
       {
        "configs": {
         "itemId": "store",
         "url": "m?xwl=BuzManage/sundryFeeSql/selecttitle"
        },
        "expanded": false,
        "children": [],
        "type": "store"
       },
       {
        "configs": {"itemId": "columns"},
        "expanded": true,
        "children": [
         {
          "configs": {
           "itemId": "colID",
           "hidden": "true",
           "dataIndex": "ID",
           "text": "主键ID"
          },
          "expanded": true,
          "children": [],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "colORDER_NO",
           "dataIndex": "ORDER_NO",
           "width": "115",
           "text": "单号"
          },
          "expanded": true,
          "children": [],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "colBILL_NO",
           "dataIndex": "BILL_NO",
           "text": "提单号"
          },
          "expanded": true,
          "children": [{
           "configs": {"itemId": "editor"},
           "expanded": false,
           "children": [],
           "type": "text"
          }],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "colTRUCKFEE_PAYER",
           "dataIndex": "TRUCKFEE_PAYER",
           "width": "210",
           "text": "托运单位"
          },
          "expanded": true,
          "children": [{
           "configs": {
            "hideTrigger": "true",
            "itemId": "editor",
            "allowBlank": "false",
            "selectOnTab": "true",
            "isUpperCase": "true",
            "displayField": "CNAME",
            "valueField": "CNAME",
            "queryDelay": "500"
           },
           "expanded": true,
           "children": [{
            "configs": {
             "itemId": "store",
             "autoLoad": "true",
             "url": "m?xwl=system/common/client/clientSelect"
            },
            "expanded": false,
            "children": [],
            "type": "store"
           }],
           "type": "combo",
           "events": {"select": "var rec=app.titlegrid.getSelection()[0];\
rec.set('TRUCKFEE_PAYER_COD',records[0].data.ID);"}
          }],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "paymentCustomerCode",
           "hidden": "true",
           "dataIndex": "TRUCKFEE_PAYER_COD",
           "text": "付费人"
          },
          "expanded": false,
          "children": [],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "colCNTR_OPERATOR",
           "dataIndex": "CNTR_OPERATOR",
           "width": "210",
           "keyName": "AG_SHORT",
           "text": "船公司"
          },
          "expanded": true,
          "children": [{
           "configs": {
            "hideTrigger": "true",
            "itemId": "editor",
            "selectOnTab": "true",
            "isUpperCase": "true",
            "displayField": "CNAME",
            "valueField": "CNAME",
            "queryDelay": "500",
            "forceSelection": "false"
           },
           "expanded": true,
           "children": [{
            "configs": {
             "itemId": "store",
             "autoLoad": "true",
             "url": "m?xwl=system/common/client/clientSelect"
            },
            "expanded": false,
            "children": [],
            "type": "store"
           }],
           "type": "combo",
           "events": {"select": "var rec=app.titlegrid.getSelection()[0];\
rec.set('CNTR_OPERATOR_COD',records[0].data.ID);\
"}
          }],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "colCNTR_OPERATOR_COD",
           "hidden": "true",
           "dataIndex": "CNTR_OPERATOR_COD",
           "text": "船公司"
          },
          "expanded": false,
          "children": [],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "colVESSEL_NAME",
           "dataIndex": "VESSEL_NAME",
           "width": "70",
           "text": "船名"
          },
          "expanded": true,
          "children": [{
           "configs": {
            "tagConfigs": "matchFieldWidth:false",
            "itemId": "editor",
            "tpl": "<table cellspacing='0' width=''>\
      <td width='100px'>\
         船名\
      <\/td>\
      <td width='170px'>\
         进口航次\
      <\/td>\
      <td>\
         出口航次\
      <\/td>\
  <tpl for='.'>\
    <tr class='x-boundlist-item' >\
      <td width='100px'>\
         {VESSEL_NAME}\
      <\/td>\
      <td width='170px'>\
         {IB_VYG}\
      <\/td>\
      <td>\
         {OB_VYG}\
      <\/td>\
    <\/tr>\
  <\/tpl>\
<\/table>",
            "displayField": "VESSEL_NAME",
            "pageSize": "-1",
            "valueField": "VESSEL_NAME",
            "anyMatch": "true"
           },
           "expanded": true,
           "children": [{
            "configs": {
             "itemId": "store",
             "autoLoad": "true",
             "url": "m?xwl=controlManage/APPLY/outBillChangeApplyEdit/selectVesselName"
            },
            "expanded": false,
            "children": [],
            "type": "store"
           }],
           "type": "combo",
           "events": {
            "select": "// if (this.store.find('ID', this.value) !== -1) {\
//   var detial = this.store.getAt(this.store.find('ID', this.value)).data;\
//   console.log(detial);\
//   app.vid.setValue(detial.ID);\
// }\
// var rec=app.titlegrid.getSelection()[0];\
// rec.set('VID',records[0].data.ID);",
            "change": "// app.VOYAGE.store.load({\
//   callback: function(records, options, success) {\
//     if (app.isedit === true)\
//       app.VOYAGE.setValue(app.selRec.data.V_VOYAGE);\
//   }\
// });"
           }
          }],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "colVID",
           "hidden": "true",
           "dataIndex": "VID",
           "text": "船ID"
          },
          "expanded": true,
          "children": [],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "colCONSIGNEE",
           "dataIndex": "CONSIGNEE",
           "width": "210",
           "text": "货主"
          },
          "expanded": true,
          "children": [{
           "configs": {
            "hideTrigger": "true",
            "itemId": "editor",
            "allowBlank": "true",
            "selectOnTab": "true",
            "isUpperCase": "true",
            "displayField": "CNAME",
            "valueField": "CNAME",
            "queryDelay": "500"
           },
           "expanded": true,
           "children": [{
            "configs": {
             "itemId": "store",
             "autoLoad": "true",
             "url": "m?xwl=system/common/client/clientSelect"
            },
            "expanded": false,
            "children": [],
            "type": "store"
           }],
           "type": "combo",
           "events": {"select": "var rec=app.titlegrid.getSelection()[0];\
rec.set('CONSIGNEE_COD',records[0].data.ID);"}
          }],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "colCONSIGNEE_COD",
           "hidden": "true",
           "dataIndex": "CONSIGNEE_COD",
           "text": "委托人代码"
          },
          "expanded": false,
          "children": [],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "colPAYER",
           "renderer": "if(value=='1'){\
return '现金';\
}\
if(value=='2'){\
return '月结';\
}",
           "dataIndex": "PAYER",
           "width": "65",
           "text": "收费类型"
          },
          "expanded": true,
          "children": [{
           "configs": {
            "itemId": "editor",
            "allowBlank": "true",
            "pickList": "[\
  ['1', '现金'],\
  ['2', '月结']\
]",
            "value": "1"
           },
           "expanded": false,
           "children": [],
           "type": "combo"
          }],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "colI_E_ID",
           "renderer": "if (value == \"I\")\
  return \"进口\";\
if (value == \"E\")\
  return \"出口\";\
if (value == \"IE\")\
  return \"进出口\";",
           "dataIndex": "I_E_ID",
           "width": "55",
           "text": "进出口"
          },
          "expanded": true,
          "children": [{
           "configs": {
            "itemId": "editor",
            "allowBlank": "false ",
            "pickList": "[\
  [\"I\", \"进口\"],\
  [\"E\", \"出口\"],\
  [\"IE\", \"进出口\"]\
]",
            "width": "120",
            "anyMatch": "true"
           },
           "expanded": true,
           "children": [],
           "type": "combo"
          }],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "colTRADE_ID",
           "renderer": "if (value == \"1\")\
  return \"外贸\";\
if (value == \"2\")\
  return \"内贸\";\
",
           "dataIndex": "TRADE_ID",
           "width": "55",
           "text": "内外贸"
          },
          "expanded": true,
          "children": [{
           "configs": {
            "itemId": "editor",
            "allowBlank": "false",
            "pickList": "[\
  [\"1\", \"外贸\"],\
  [\"2\", \"内贸\"]\
]",
            "width": "120",
            "anyMatch": "true"
           },
           "expanded": true,
           "children": [],
           "type": "combo"
          }],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "colNOTES",
           "dataIndex": "NOTES",
           "width": "200",
           "text": "备注"
          },
          "expanded": true,
          "children": [{
           "configs": {
            "itemId": "editor",
            "allowBlank": "false",
            "height": "100"
           },
           "expanded": false,
           "children": [],
           "type": "textarea"
          }],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "CREATED_BY",
           "dataIndex": "CREATED_BY",
           "text": "创建人"
          },
          "expanded": true,
          "children": [],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "CREATED_ON",
           "dataIndex": "CREATED_ON",
           "text": "创建时间"
          },
          "expanded": false,
          "children": [],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "UPDATED_BY",
           "dataIndex": "UPDATED_BY",
           "text": "修改人"
          },
          "expanded": false,
          "children": [],
          "type": "column"
         },
         {
          "configs": {
           "itemId": "UPDATED_ON",
           "dataIndex": "UPDATED_ON",
           "text": "修改时间"
          },
          "expanded": false,
          "children": [],
          "type": "column"
         }
        ],
        "type": "array"
       }
      ],
      "type": "grid",
      "events": {"itemdblclick": "console.log(record.data.ID);\
Wb.request({\
  url: 'm?xwl=BuzManage/sundryFeeSql/selecttitleid',\
  params: {\
    ID: record.data.ID\
  },\
  success: function(resp) {\
    var data = Wb.decode(resp.responseText).rows[0];\
//     console.log(data.TRUCKFEE_PAYER);\
    app.orderno.setValue(data.ORDER_NO);\
    app.id.setValue(data.ID);\
    app.billno.setValue(data.BILL_NO);\
    app.notes.setValue(data.NOTES);\
    app.iEId.setValue(data.I_E_ID);\
    app.tradeId.setValue(data.TRADE_ID);\
    app.vesselname.setValue(data.VID);\
    app.vesselnamename.setValue(data.VESSEL_NAME);\
    Wb.loadComboAdd(app.truckfeepayer, [{\
        \"ID\": data.TRUCKFEE_PAYER_COD,\
        \"CNAME\": data.TRUCKFEE_PAYER\
      }],\
      function() {\
        app.truckfeepayer.setValue(data.TRUCKFEE_PAYER_COD);\
        app.truckfeepayername.setValue(data.TRUCKFEE_PAYER);\
      });\
    Wb.loadComboAdd(app.cntroperator, [{\
        \"ID\": data.CNTR_OPERATOR_COD,\
        \"CNAME\": data.CNTR_OPERATOR\
      }],\
      function() {\
        app.cntroperator.setValue(data.CNTR_OPERATOR_COD);\
        app.cntroperatorname.setValue(data.CNTR_OPERATOR);\
      });\
    Wb.loadComboAdd(app.consignee, [{\
        \"ID\": data.CONSIGNEE_COD,\
        \"CNAME\": data.CONSIGNEE\
      }],\
      function() {\
        app.consignee.setValue(data.CONSIGNEE_COD);\
        app.consigneename.setValue(data.CONSIGNEE);\
      });\
    app.payer.setValue(data.PAYER);\
    app.infogrid.store.load({\
      params: {\
        TID: data.ID\
      }\
    });\
    app.feegrid.store.load({\
      params: {\
        BUSSINESS_CODE: data.ID\
      }\
    });\
    app.hiswin.close();\
  }\
});"}
     }
    ],
    "type": "window"
   },
   {
    "configs": {
     "layout": "border",
     "itemId": "viewport1"
    },
    "expanded": true,
    "children": [
     {
      "configs": {
       "itemId": "toolbar1",
       "region": "north"
      },
      "expanded": true,
      "children": [
       {
        "configs": {
         "itemId": "seekBtn",
         "text": "查询",
         "iconCls": "search_icon"
        },
        "expanded": false,
        "children": [],
        "type": "item",
        "events": {"click": "// app.titlegrid.store.load({\
// \tout:app.panel1\
// });\
// app.infogrid.store.load({\
// });\
// app.feegrid.store.load({\
// });\
\
var hiswin = new Ext.window.Window(app._hiswin);\
hiswin.show();\
app.createBegin.setValue(new Date());\
app.createEnd.setValue(new Date());\
app.queryBtn.fireEvent('click');"}
       },
       {
        "configs": {
         "itemId": "addBtn",
         "text": "新增",
         "iconCls": "record_add_icon"
        },
        "expanded": false,
        "children": [],
        "type": "item",
        "events": {"click": "switch (choosePanel) {\
  case 'titlepanel':\
    //     var title = [Wb.getModified(app.titlegrid)];\
    var info = [Wb.getModified(app.infogrid)];\
    var fee = [Wb.getModified(app.feegrid)];\
    if (app.id.getValue() != null && app.id.getValue() != '' && (info[0].create.length > 0 || info[0].update.length > 0 || fee[0].create.length > 0 || fee[0].update.length > 0)) {\
      Wb.warn('请先保存刚刚操作的记录');\
      return;\
    }\
    Wb.reset(app.titlepanel);\
    app.tradeId.setValue('2');\
    app.iEId.setValue('I');\
    app.infogrid.store.load({});\
    app.feegrid.store.load({});\
    break;\
  case 'infopanel':\
    //     var titleinfo = app.titlegrid.getSelection()[0];\
    //     if (!titleinfo) {\
    //       Wb.warn('请选择 1 条需要添加货的提单记录');\
    //       return;\
    //     }\
    Wb.add(app.infogrid, null, \"last\", 4, false);\
    var row = app.infogrid.getSelection()[0];\
    //     row.set(\"TID\", titleinfo.data.ID);\
    row.set(\"BILL_NO\", app.billno.getValue());\
    row.set(\"FEE_WGT\", '1');\
    row.set(\"UPDATED_ON\", new Date());\
    row.set(\"CREATED_ON\", new Date());\
    row.set(\"UPDATED_BY\", '{#sys.username#}');\
    row.set(\"CREATED_BY\", '{#sys.username#}');\
    break;\
  case 'feepanel':\
    //     var titleinfo = app.titlegrid.getSelection()[0];\
    //     if (!titleinfo) {\
    //       Wb.warn('请选择 1 条需要添加货的记录');\
    //       return;\
    //     }\
    Wb.add(app.feegrid, null, \"last\", 1, false);\
    var row = app.feegrid.getSelection()[0];\
    //     row.set(\"TID\", titleinfo.data.ID);\
    row.set(\"CONTRACT_ADD_RATE\", '100');\
    row.set(\"ACTUAL_JOB_COUNT\", '1');\
    row.set(\"DWELL_DAYS\", '1');\
    row.set(\"UPDATED_ON\", new Date());\
    row.set(\"CREATED_ON\", new Date());\
    row.set(\"UPDATED_BY\", '{#sys.username#}');\
    row.set(\"CREATED_BY\", '{#sys.username#}');\
    break;\
  default:\
    Wb.warn('请选中提单,货,或者费用信息');\
}"}
       },
       {
        "configs": {
         "itemId": "editBtn",
         "text": "保存",
         "iconCls": "record_edit_icon"
        },
        "expanded": false,
        "children": [],
        "type": "item",
        "events": {"click": " var goodsNotes = '';\
 var cntrType = '';\
 var billType = '';\
 var notes = '无';\
 var cntrOperatorCod = '';\
 var customerId = '';\
 var paymentType = '';\
 if (!Wb.verify(app.titlepanel) || !Wb.verify(app.infogrid)) {\
   Wb.warn(\"有必填项为空\");\
   return;\
 }\
 if (app.id.getValue() != null && app.id.getValue() != '') {\
   var myDate = new Date();\
   //    var jobFinishDate = myDate.getFullYear() + '-' + (myDate.getMonth() + 1 < 10 ? '0' + (myDate.getMonth() + 1) : date.getMonth() + 1) + '-' + myDate.getDate();\
   var jobFinishDate = Wb.format(myDate, 'Y-m-d');\
   var res = app.feegrid.store.getCount();\
   var feeBody = '[';\
   var feeBody1 = '[';\
   for (var i = 0; i < app.infogrid.store.getCount(); i++) {\
     var row = app.infogrid.getStore().getAt(i);\
     if (row.data.FEE_WGT == '1') {\
       if (row.data.CARGO_NAME != null) {\
         goodsNotes = row.data.CARGO_NAME;\
       }\
       if (row.data.PKG_KIND_COD != null) {\
         cntrType = row.data.PKG_KIND_COD;\
       }\
       if (row.data.PKG_KIND_NAME != null) {\
         billType = row.data.PKG_KIND_NAME;\
       }\
     }\
   }\
   if (app.cntroperator.getValue() != null) {\
     cntrOperatorCod = app.cntroperator.getValue();\
   }\
   if (app.consignee.getValue() != null) {\
     customerId = app.consignee.getValue();\
   }\
   if (app.payer.getValue() != null) {\
     paymentType = app.payer.getValue();\
   }\
   if (app.notes.getValue() != null) {\
     notes = app.notes.getValue();\
   }\
   var create = 0;\
   var update = 0;\
   for (var i = 0; i < app.feegrid.store.getCount(); i++) {\
     var row = app.feegrid.getStore().getAt(i);\
     if (row.data.ID != null && row.data.ID != '') {\
       feeBody += '{\"billNo\":\"' + app.billno.getValue() + '\",\"bussinessCode\":\"' + app.id.getValue() + '\",\"paymentCustomerCode\":\"' + app.truckfeepayer.getValue() + '\",\"cntrOperatorCod\":\"' + cntrOperatorCod +\
         '\",\"customerId\":\"' + customerId + '\",\"iEId\":\"' + app.iEId.getValue() + '\",\"tradeId\":\"' + app.tradeId.getValue() + '\",\"goodsNotes\":\"' + goodsNotes + '\",\"cntrType\":\"' + cntrType +\
         '\",\"billType\":\"' + billType + '\",\"jobFinishDate\":\"' + jobFinishDate + '\",\"paymentType\":\"' + paymentType + '\",\"notes\":\"' + notes +\
         '\",\"id\":\"' + row.data.ID + '\",\"feeListId\":\"' + row.data.FEE_LIST_ID + '\",\"CNTR\":\"\",\"CNTRSIZE\":\"\",\"contractRate\":\"' + row.data.CONTRACT_RATE + '\",\"actualJobCount\":\"' + row.data.ACTUAL_JOB_COUNT +\
         '\",\"contractAddRate\":\"' + row.data.CONTRACT_ADD_RATE + '\",\"dwellDays\":\"' + row.data.DWELL_DAYS + '\",\"amount\":\"' + row.data.AMOUNT + '\"},';\
       update = 1;\
     }\
     if (row.data.ID == null || row.data.ID == '') {\
       feeBody1 += '{\"billNo\":\"' + app.billno.getValue() + '\",\"bussinessCode\":\"' + app.id.getValue() + '\",\"paymentCustomerCode\":\"' + app.truckfeepayer.getValue() + '\",\"cntrOperatorCod\":\"' + cntrOperatorCod +\
         '\",\"customerId\":\"' + customerId + '\",\"iEId\":\"' + app.iEId.getValue() + '\",\"tradeId\":\"' + app.tradeId.getValue() + '\",\"goodsNotes\":\"' + goodsNotes + '\",\"cntrType\":\"' + cntrType +\
         '\",\"billType\":\"' + billType + '\",\"jobFinishDate\":\"' + jobFinishDate + '\",\"paymentType\":\"' + paymentType + '\",\"notes\":\"' + notes +\
         '\",\"feeListId\":\"' + row.data.FEE_LIST_ID + '\",\"CNTR\":\"\",\"CNTRSIZE\":\"\",\"contractRate\":\"' + row.data.CONTRACT_RATE + '\",\"actualJobCount\":\"' + row.data.ACTUAL_JOB_COUNT +\
         '\",\"contractAddRate\":\"' + row.data.CONTRACT_ADD_RATE + '\",\"dwellDays\":\"' + row.data.DWELL_DAYS + '\",\"amount\":\"' + row.data.AMOUNT + '\"},';\
       create = 1;\
     }\
   }\
   feeBody = feeBody.substring(0, feeBody.length - 1) + ']';\
   feeBody1 = feeBody1.substring(0, feeBody1.length - 1) + ']';\
   if (create == 1) {\
     /*var feeHead = '{\"billNo\":\"' + app.billno.getValue() + '\",\"bussinessCode\":\"' + app.id.getValue() + '\",\"paymentCustomerCode\":\"' + app.truckfeepayer.getValue() + '\",\"cntrOperatorCod\":\"' + cntrOperatorCod +\
       '\",\"customerId\":\"' + customerId + '\",\"iEId\":\"' + app.iEId.getValue() + '\",\"tradeId\":\"' + app.tradeId.getValue() + '\",\"goodsNotes\":\"' + goodsNotes + '\",\"cntrType\":\"' + cntrType +\
       '\",\"billType\":\"' + billType + '\",\"jobFinishDate\":\"' + jobFinishDate + '\",\"paymentType\":\"' + paymentType + '\",\"notes\":\"' + notes + '\",\"feeBody\":' + feeBody1 + '}';\
     //      console.log(feeHead);*/\
     Wb.request({\
       url: \"m?xwl=BuzManage/testAddFee\",\
       async: false,\
       params: {\
         feeHead: feeBody1\
       },\
       success: function(resp) {\
         app.feegrid.store.load({\
           params: {\
             BUSSINESS_CODE: app.id.getValue()\
           }\
         });\
       }\
     });\
   }\
   if (update == 1) {\
     /*var feeHead = '{\"billNo\":\"' + app.billno.getValue() + '\",\"bussinessCode\":\"' + app.id.getValue() + '\",\"paymentCustomerCode\":\"' + app.truckfeepayer.getValue() + '\",\"cntrOperatorCod\":\"' + cntrOperatorCod +\
       '\",\"customerId\":\"' + customerId + '\",\"iEId\":\"' + app.iEId.getValue() + '\",\"tradeId\":\"' + app.tradeId.getValue() + '\",\"goodsNotes\":\"' + goodsNotes + '\",\"cntrType\":\"' + cntrType +\
       '\",\"billType\":\"' + billType + '\",\"jobFinishDate\":\"' + jobFinishDate + '\",\"paymentType\":\"' + paymentType + '\",\"notes\":\"' + notes + '\",\"feeBody\":' + feeBody + '}';\
     //      console.log(feeHead);*/\
     Wb.request({\
       url: \"m?xwl=BuzManage/testEditFee\",\
       params: {\
         feeHead: feeBody\
       },\
       success: function(resp) {\
         app.feegrid.store.load({\
           params: {\
             BUSSINESS_CODE: app.id.getValue()\
           }\
         });\
       }\
     });\
   }\
   var values = Wb.getValue(app.titlepanel);\
   Wb.request({\
     url: 'm?xwl=BuzManage/sundryFeeSql/updatetitle',\
     async: false,\
     params: Wb.applyIf(values, Wb.getData(app.titlepanel, true)),\
     success: function(resp) {\
       //        app.feegrid.store.load({\
       //          params: {\
       //            BUSSINESS_CODE: app.id.getValue()\
       //          }\
       //        });\
     }\
   });\
 }\
 if (app.id.getValue() == null || app.id.getValue() == '') {\
   app.id.setValue(Wb.getId());\
   var myDate = new Date();\
   //    var jobFinishDate = myDate.getFullYear() + '-' + (myDate.getMonth() + 1 < 10 ? '0' + (myDate.getMonth() + 1) : date.getMonth() + 1) + '-' + myDate.getDate();\
   var jobFinishDate = Wb.format(myDate, 'Y-m-d');\
   var res = app.feegrid.store.getCount();\
   var feeBody = '[';\
   for (var i = 0; i < app.infogrid.store.getCount(); i++) {\
     var row = app.infogrid.getStore().getAt(i);\
     if (row.data.FEE_WGT == '1') {\
       if (row.data.CARGO_NAME != null) {\
         goodsNotes = row.data.CARGO_NAME;\
       }\
       if (row.data.PKG_KIND_COD != null) {\
         cntrType = row.data.PKG_KIND_COD;\
       }\
       if (row.data.PKG_KIND_NAME != null) {\
         billType = row.data.PKG_KIND_NAME;\
       }\
     }\
   }\
   if (app.cntroperator.getValue() != null) {\
     cntrOperatorCod = app.cntroperator.getValue();\
   }\
   if (app.consignee.getValue() != null) {\
     customerId = app.consignee.getValue();\
   }\
   if (app.payer.getValue() != null) {\
     paymentType = app.payer.getValue();\
   }\
   if (app.notes.getValue() != null) {\
     notes = app.notes.getValue();\
   }\
   var fee = [Wb.getModified(app.feegrid)];\
   if (fee[0].create.length > 0) {\
     Wb.each(fee[0].create,\
       function(row) {\
         feeBody += '{\"billNo\":\"' + app.billno.getValue() + '\",\"bussinessCode\":\"' + app.id.getValue() + '\",\"paymentCustomerCode\":\"' + app.truckfeepayer.getValue() + '\",\"cntrOperatorCod\":\"' + cntrOperatorCod +\
           '\",\"customerId\":\"' + customerId + '\",\"iEId\":\"' + app.iEId.getValue() + '\",\"tradeId\":\"' + app.tradeId.getValue() + '\",\"goodsNotes\":\"' + goodsNotes + '\",\"cntrType\":\"' + cntrType +\
           '\",\"billType\":\"' + billType + '\",\"jobFinishDate\":\"' + jobFinishDate + '\",\"paymentType\":\"' + paymentType + '\",\"notes\":\"' + notes +\
           '\",\"feeListId\":\"' + row.FEE_LIST_ID + '\",\"CNTR\":\"\",\"CNTRSIZE\":\"\",\"contractRate\":\"' + row.CONTRACT_RATE + '\",\"actualJobCount\":\"' + row.ACTUAL_JOB_COUNT +\
           '\",\"contractAddRate\":\"' + row.CONTRACT_ADD_RATE + '\",\"dwellDays\":\"' + row.DWELL_DAYS + '\",\"amount\":\"' + row.AMOUNT + '\"},';\
       });\
     feeBody = feeBody.substring(0, feeBody.length - 1) + ']';\
     /*var feeHead = '{\"billNo\":\"' + app.billno.getValue() + '\",\"bussinessCode\":\"' + app.id.getValue() + '\",\"paymentCustomerCode\":\"' + app.truckfeepayer.getValue() + '\",\"cntrOperatorCod\":\"' + cntrOperatorCod +\
       '\",\"customerId\":\"' + customerId + '\",\"iEId\":\"' + app.iEId.getValue() + '\",\"tradeId\":\"' + app.tradeId.getValue() + '\",\"goodsNotes\":\"' + goodsNotes + '\",\"cntrType\":\"' + cntrType +\
       '\",\"billType\":\"' + billType + '\",\"jobFinishDate\":\"' + jobFinishDate + '\",\"paymentType\":\"' + paymentType + '\",\"notes\":\"' + notes + '\",\"feeBody\":' + feeBody + '}';\
     //    console.log(feeHead);*/\
     Wb.request({\
       url: \"m?xwl=BuzManage/testAddFee\",\
       async: false,\
       params: {\
         feeHead: feeBody\
       },\
       success: function(resp) {}\
     });\
   }\
   var values = Wb.getValue(app.titlepanel);\
   Wb.request({\
     url: 'm?xwl=BuzManage/sundryFeeSql/inserttitle',\
     async: false,\
     params: Wb.applyIf(values, Wb.getData(app.titlepanel, true)),\
     success: function(resp) {\
       app.feegrid.store.load({\
         params: {\
           BUSSINESS_CODE: app.id.getValue()\
         }\
       });\
     }\
   });\
 }\
 var info = [Wb.getModified(app.infogrid)];\
 console.log(\"info====================\");\
 console.log(info);\
 if (info[0].create.length > 0) {\
   var res = info[0].create;\
   Wb.each(res,\
     function(row) {\
       row.TID = app.id.getValue();\
       Wb.request({\
         url: 'm?xwl=BuzManage/sundryFeeSql/insertinfo',\
         async: false,\
         params: row,\
         success: function(resp) {\
           app.infogrid.store.load({\
             params: {\
               TID: app.id.getValue()\
             }\
           });\
         }\
       });\
     });\
 }\
 if (info[0].update.length > 0) {\
   var res = info[0].update;\
   console.log(\"info====================update\");\
   console.log(res);\
   Wb.each(res,\
     function(rows) {\
       Wb.request({\
         url: 'm?xwl=BuzManage/sundryFeeSql/updateinfo',\
         async: false,\
         params: rows,\
         success: function(resp) {\
           app.infogrid.store.load({\
             params: {\
               TID: app.id.getValue()\
             }\
           });\
         }\
       });\
     });\
 }"}
       },
       {
        "configs": {
         "itemId": "deleteBtn1",
         "text": "删除",
         "iconCls": "record_delete_icon"
        },
        "expanded": false,
        "children": [],
        "type": "item",
        "events": {"click": "switch (choosePanel) {\
  case 'titlepanel':\
    console.log(app.id.getValue());\
    if (app.id.getValue() == null || app.id.getValue() == '') {\
      Wb.confirm(\"确定要删除这个提单吗?\",\
        function() {\
          Wb.reset(app.titlepanel);\
          app.tradeId.setValue('2');\
          app.iEId.setValue('I');\
          app.infogrid.store.load({});\
          app.feegrid.store.load({});\
        });\
    }\
    if (app.id.getValue() != null && app.id.getValue() != '') {\
      Wb.confirm(\"确定要删除这个提单的所有记录吗?\",\
        function() {\
          var ids = '';\
          for (var i = 0; i < app.feegrid.store.getCount(); i++) {\
            var row = app.feegrid.getStore().getAt(i);\
            ids += row.data.ID + ',';\
            if (row.data.PAY_FLAG == '1') {\
              Wb.warn('计费信息已收费不允许删除');\
              return;\
            }\
          }\
          if (ids != null && ids != '') {\
            Wb.request({\
              url: \"m?xwl=BuzManage/testDelFee\",\
              params: {\
                ids: ids\
              },\
              success: function(resp) {}\
            });\
          }\
          for (var i = 0; i < app.infogrid.store.getCount(); i++) {\
            var row = app.infogrid.getStore().getAt(i);\
            Wb.request({\
              url: 'm?xwl=BuzManage/sundryFeeSql/delinfo',\
              params: {\
                ID: row.data.ID\
              },\
              success: function(resp) {}\
            });\
          }\
\
          Wb.request({\
            url: 'm?xwl=BuzManage/sundryFeeSql/deltitle',\
            params: {\
              ID: app.id.getValue()\
            },\
            success: function(resp) {\
              Wb.reset(app.titlepanel);\
              app.tradeId.setValue('2');\
              app.iEId.setValue('I');\
              app.infogrid.store.load({});\
              app.feegrid.store.load({});\
            }\
          });\
        });\
    }\
    break;\
  case 'infopanel':\
    var info = app.infogrid.getSelection()[0];\
    if (!info) {\
      Wb.warn('请选择 1 条要删除的货记录');\
      return;\
    }\
    if (info.data.ID == null || info.data.ID == '') {\
      Wb.confirm(\"确定要删除这个货吗?\",\
        function() {\
          Wb.remove(app.infogrid);\
        });\
    }\
    if (info.data.ID != null && info.data.ID != '' && info.data.FEE_WGT != '1') {\
      Wb.confirm(\"确定要删除这个货吗?\",\
        function() {\
          Wb.request({\
            url: \"m?xwl=BuzManage/sundryFeeSql/delinfo\",\
            params: {\
              ID: info.data.ID\
            },\
            success: function(resp) {\
              app.infogrid.store.load({\
                params: {\
                  TID: app.id.getValue()\
                }\
              });\
            }\
          });\
        });\
    }\
    if (info.data.ID != null && info.data.ID != '' && info.data.FEE_WGT == '1') {\
      Wb.confirm(\"确定要删除这个货吗?\",\
        function() {\
          if (app.feegrid.store.getCount() == 0) {\
            Wb.request({\
              url: \"m?xwl=BuzManage/sundryFeeSql/delinfo\",\
              params: {\
                ID: info.data.ID\
              },\
              success: function(resp) {\
                app.infogrid.store.load({\
                  params: {\
                    TID: app.id.getValue()\
                  }\
                });\
              }\
            });\
          }\
\
        });\
    }\
    break;\
  case 'feepanel':\
    var fee = app.feegrid.getSelection()[0];\
    if (!fee) {\
      Wb.warn('请选择 1 条要删除的费用记录');\
      return;\
    }\
    if (fee.data.ID == null || fee.data.ID == '') {\
      Wb.confirm(\"确定要删除这个费用吗?\",\
        function() {\
          Wb.remove(app.feegrid);\
        });\
    }\
    if (fee.data.ID != null && fee.data.ID != '') {\
      Wb.confirm(\"确定要删除这个费用吗?\",\
        function() {\
          var ids = fee.data.ID + ',';\
          if (fee.data.PAY_FLAG == '1') {\
            Wb.warn('计费信息已收费不允许删除');\
            return;\
          }\
          Wb.request({\
            url: \"m?xwl=BuzManage/testDelFee\",\
            params: {\
              ids: ids\
            },\
            success: function(resp) {\
              app.feegrid.store.load({\
                params: {\
                  BUSSINESS_CODE: app.id.getValue()\
                }\
              });\
            }\
          });\
        });\
    }\
    break;\
  default:\
    Wb.warn('请选中要删除的提单,货,或者费用信息');\
}"}
       },
       {
        "configs": {
         "itemId": "copyBtn",
         "hidden": "false",
         "text": "复制",
         "iconCls": "copy_icon"
        },
        "expanded": false,
        "children": [],
        "type": "item",
        "events": {"click": "switch (choosePanel) {\
  case 'infopanel':\
    var infogrid = app.infogrid.getSelection()[0];\
    if (!infogrid) {\
      Wb.warn('请选择 1 条需要添加的货记录');\
      return;\
    }\
    Wb.add(app.infogrid, null, \"last\", 1, false);\
    var row = app.infogrid.getSelection()[0];\
    //     row.set(\"ID\", infogrid.data.ID);\
    row.set(\"BILL_NO\", infogrid.data.BILL_NO);\
    row.set(\"FEE_WGT\", infogrid.data.FEE_WGT);\
    row.set(\"CARGO_NAME\", infogrid.data.CARGO_NAME);\
    row.set(\"PKG_KIND_COD\", infogrid.data.PKG_KIND_COD);\
    row.set(\"PKG_KIND_NAME\", infogrid.data.PKG_KIND_NAME);\
    row.set(\"CARGO_GROSS_WGT\", infogrid.data.CARGO_GROSS_WGT);\
    row.set(\"PIECES\", infogrid.data.PIECES);\
    row.set(\"CARGO_NET_WGT\", infogrid.data.CARGO_NET_WGT);\
    row.set(\"UPDATED_ON\", new Date());\
    row.set(\"CREATED_ON\", new Date());\
    row.set(\"UPDATED_BY\", '{#sys.username#}');\
    row.set(\"CREATED_BY\", '{#sys.username#}');\
    break;\
  case 'feepanel':\
    var feegrid = app.feegrid.getSelection()[0];\
    if (!feegrid) {\
      Wb.warn('请选择 1 条需要添加的费用记录');\
      return;\
    }\
    Wb.add(app.feegrid, null, \"last\", 1, false);\
    var row = app.feegrid.getSelection()[0];\
    //     row.set(\"ID\", feegrid.data.ID);\
    row.set(\"FEE_LIST_ID\", feegrid.data.FEE_LIST_ID);\
    row.set(\"CONTRACT_RATE\", feegrid.data.CONTRACT_RATE);\
    row.set(\"ACTUAL_JOB_COUNT\", feegrid.data.ACTUAL_JOB_COUNT);\
    row.set(\"DWELL_DAYS\", feegrid.data.DWELL_DAYS);\
    row.set(\"CONTRACT_ADD_RATE\", feegrid.data.CONTRACT_ADD_RATE);\
    row.set(\"AMOUNT\", feegrid.data.AMOUNT);\
    row.set(\"UPDATED_ON\", new Date());\
    row.set(\"CREATED_ON\", new Date());\
    row.set(\"UPDATED_BY\", '{#sys.username#}');\
    row.set(\"CREATED_BY\", '{#sys.username#}');\
    break;\
  default:\
    Wb.warn('请选中货,或者费用信息');\
}"}
       },
       {
        "configs": {
         "itemId": "printBtn",
         "text": "打印",
         "iconCls": "printer_icon"
        },
        "expanded": false,
        "children": [],
        "type": "item",
        "events": {"click": "if (app.id.getValue() == null || app.id.getValue() == '') {\
  Wb.warn(\"请先选择需要打印的杂项费记录\");\
  return;\
}\
var myDate = new Date();\
var year = myDate.getFullYear();\
var month = myDate.getMonth(); //获取当前月份(0-11,0代表1月)\
var day = myDate.getDate(); //获取当前日(1-31)\
var tenancyid = \"{#sys.TENANCY_ID#}\";\
var AF1 = document.getElementById(opt);\
console.log(app.id.getValue());\
// AF1.func(\"BeginBatchPrint\", \"isShareBlankPart=true\"); //开始批打印\
// for (var i = 0; i < sels.length; i++) { //通常是循环\
// var whereSql = encodeURI(\" and tenancy_id='\" + tenancyid + \"' and id='\" + sels[0].data.ID + \"'\");\
var whereSql1=\" and id='\"+app.id.getValue()+\"'\";\
var whereSql2=\" and  bill_id='\"+app.id.getValue()+\"'\";\
var whereSql3=\" and BUSSINESS_CODE='\"+app.id.getValue()+\"'\";\
// AF1.func(\"SetPrintProp\", \"paperNumber=12;Oriantation=Portrait\");\
AF1.func(\"SetParas\", \"ds1 \\r\\
 para=1;whereSql=\" + whereSql1 + \";drr=\" + new Date().getTime() + \";tenancyId=\" + tenancyid);\
AF1.func(\"SetParas\", \"ds2 \\r\\
 para=1;whereSql=\" + whereSql2 + \";drr=\" + new Date().getTime() + \";tenancyId=\" + tenancyid);\
AF1.func(\"SetParas\", \"ds3 \\r\\
 para=1;whereSql=\" + whereSql3 + \";drr=\" + new Date().getTime() + \";tenancyId=\" + tenancyid);\
// AF1.func(\"SetCellData\", \"<data I3='\" + year + \"年\" + month + \"月\" + day + \"日'/>\");\
// AF1.func(\"SetCellData\", \"<data C8='\" + year + \"年\" + month + \"月\" + day + \"日'/>\");\
AF1.func(\"Calc\", \"\");\
AF1.func(\"callfunc\", \"18\");\
//   AF1.func(\"Print\", \"\");\
// }\
// AF1.func(\"EndBatchPrint\", \"\"); //终止批打印：把打印任务送往打印机，此时才真正打印"}
       },
       {
        "configs": {
         "itemId": "payBtn",
         "hidden": "true",
         "text": "确认收费",
         "iconCls": "textarea_icon"
        },
        "expanded": false,
        "children": [],
        "type": "item"
       },
       {
        "configs": {
         "itemId": "kpBtn",
         "hidden": "true",
         "x": "8",
         "width": "88",
         "y": "8",
         "text": "现金开票",
         "iconCls": "write_icon",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "item"
       }
      ],
      "type": "toolbar"
     },
     {
      "configs": {
       "layout": "border",
       "itemId": "panelinfo",
       "region": "center"
      },
      "expanded": true,
      "children": [
       {
        "configs": {
         "layout": "absolute",
         "itemId": "titlepanel",
         "width": "1201",
         "region": "north",
         "height": "150"
        },
        "expanded": true,
        "children": [
         {
          "configs": {
           "itemId": "orderno",
           "labelAlign": "right",
           "fieldLabel": "单号",
           "width": "210",
           "x": "16",
           "y": "16",
           "readOnly": "true",
           "labelWidth": "60",
           "height": "22"
          },
          "expanded": false,
          "children": [],
          "type": "text"
         },
         {
          "configs": {
           "itemId": "id",
           "hidden": "true",
           "labelAlign": "right",
           "fieldLabel": "主键ID",
           "width": "210",
           "x": "0",
           "y": "40",
           "labelWidth": "60",
           "height": "22"
          },
          "expanded": false,
          "children": [],
          "type": "text"
         },
         {
          "configs": {
           "itemId": "truckfeepayername",
           "hidden": "true",
           "labelAlign": "right",
           "width": "210",
           "x": "0",
           "y": "40",
           "labelWidth": "60",
           "height": "22"
          },
          "expanded": false,
          "children": [],
          "type": "text"
         },
         {
          "configs": {
           "itemId": "cntroperatorname",
           "hidden": "true",
           "labelAlign": "right",
           "fieldLabel": "主键ID",
           "width": "210",
           "x": "0",
           "y": "40",
           "labelWidth": "60",
           "height": "22"
          },
          "expanded": false,
          "children": [],
          "type": "text"
         },
         {
          "configs": {
           "itemId": "consigneename",
           "hidden": "true",
           "labelAlign": "right",
           "fieldLabel": "主键ID",
           "width": "210",
           "x": "0",
           "y": "40",
           "labelWidth": "60",
           "height": "22"
          },
          "expanded": false,
          "children": [],
          "type": "text"
         },
         {
          "configs": {
           "itemId": "vesselnamename",
           "hidden": "true",
           "labelAlign": "right",
           "fieldLabel": "主键ID",
           "width": "210",
           "x": "0",
           "y": "40",
           "labelWidth": "60",
           "height": "22"
          },
          "expanded": false,
          "children": [],
          "type": "text"
         },
         {
          "configs": {
           "itemId": "billno",
           "allowBlank": "false",
           "labelAlign": "right",
           "fieldLabel": "提单号",
           "width": "210",
           "x": "16",
           "y": "48",
           "labelWidth": "60",
           "height": "22"
          },
          "expanded": false,
          "children": [],
          "type": "text"
         },
         {
          "configs": {
           "allowBlank": "false",
           "selectOnTab": "true",
           "isUpperCase": "true",
           "labelWidth": "60",
           "valueField": "ID",
           "queryDelay": "500",
           "hideTrigger": "true",
           "itemId": "truckfeepayer",
           "labelAlign": "right",
           "fieldLabel": "付费方",
           "x": "232",
           "width": "270",
           "displayField": "CNAME",
           "y": "16",
           "forceSelection": "true",
           "height": "22"
          },
          "expanded": true,
          "children": [{
           "configs": {
            "itemId": "store",
            "autoLoad": "true",
            "url": "m?xwl=system/common/client/clientSelect"
           },
           "expanded": false,
           "children": [],
           "type": "store"
          }],
          "type": "combo",
          "events": {"select": "app.truckfeepayername.setValue(combo.getRawValue());\
"}
         },
         {
          "configs": {
           "selectOnTab": "true",
           "isUpperCase": "true",
           "labelWidth": "60",
           "valueField": "ID",
           "queryDelay": "500",
           "hideTrigger": "true",
           "itemId": "cntroperator",
           "labelAlign": "right",
           "fieldLabel": "船公司",
           "x": "520",
           "width": "270",
           "displayField": "CNAME",
           "y": "48",
           "forceSelection": "true",
           "height": "22"
          },
          "expanded": true,
          "children": [{
           "configs": {
            "itemId": "store",
            "autoLoad": "true",
            "url": "m?xwl=system/common/client/clientSelect"
           },
           "expanded": false,
           "children": [],
           "type": "store"
          }],
          "type": "combo",
          "events": {"select": "app.cntroperatorname.setValue(combo.getRawValue());"}
         },
         {
          "configs": {
           "tagConfigs": "matchFieldWidth:false",
           "pageSize": "-1",
           "labelWidth": "60",
           "valueField": "ID",
           "itemId": "vesselname",
           "tpl": "<table cellspacing='0' width=''>\
      <td width='80px'>\
         船名\
      <\/td>\
      <td width='115px'>\
         进口航次\
      <\/td>\
      <td>\
         出口航次\
      <\/td>\
  <tpl for='.'>\
    <tr class='x-boundlist-item' >\
      <td width='80px'>\
         {VESSEL_NAME}\
      <\/td>\
      <td width='115px'>\
         {IB_VYG}\
      <\/td>\
      <td>\
         {OB_VYG}\
      <\/td>\
    <\/tr>\
  <\/tpl>\
<\/table>",
           "labelAlign": "right",
           "fieldLabel": "船名",
           "x": "792",
           "width": "180",
           "displayField": "VESSEL_NAME",
           "y": "48",
           "anyMatch": "true",
           "height": "22"
          },
          "expanded": true,
          "children": [{
           "configs": {
            "itemId": "store",
            "autoLoad": "true",
            "url": "m?xwl=controlManage/APPLY/outBillChangeApplyEdit/selectVesselName"
           },
           "expanded": false,
           "children": [],
           "type": "store"
          }],
          "type": "combo",
          "events": {
           "select": "app.vesselnamename.setValue(combo.getRawValue());",
           "change": "// app.VOYAGE.store.load({\
//   callback: function(records, options, success) {\
//     if (app.isedit === true)\
//       app.VOYAGE.setValue(app.selRec.data.V_VOYAGE);\
//   }\
// });"
          }
         },
         {
          "configs": {
           "selectOnTab": "true",
           "isUpperCase": "true",
           "labelWidth": "60",
           "valueField": "ID",
           "queryDelay": "500",
           "hideTrigger": "true",
           "itemId": "consignee",
           "labelAlign": "right",
           "fieldLabel": "联系人",
           "x": "520",
           "width": "270",
           "displayField": "CNAME",
           "y": "16",
           "forceSelection": "true",
           "height": "22"
          },
          "expanded": true,
          "children": [{
           "configs": {
            "itemId": "store",
            "autoLoad": "true",
            "url": "m?xwl=system/common/client/clientSelect"
           },
           "expanded": false,
           "children": [],
           "type": "store"
          }],
          "type": "combo",
          "events": {"select": "app.consigneename.setValue(combo.getRawValue());"}
         },
         {
          "configs": {
           "itemId": "iEId",
           "labelAlign": "right",
           "pickList": "[\
  ['I', '进口'],\
  ['E', '出口']\
]",
           "fieldLabel": "进出口",
           "x": "792",
           "width": "180",
           "y": "16",
           "labelWidth": "60",
           "height": "22"
          },
          "expanded": false,
          "children": [],
          "type": "combo"
         },
         {
          "configs": {
           "itemId": "tradeId",
           "labelAlign": "right",
           "pickList": "[\
  ['1', '外贸'],\
  ['2', '内贸']\
]",
           "fieldLabel": "内外贸",
           "x": "984",
           "width": "180",
           "y": "16",
           "labelWidth": "60",
           "height": "22"
          },
          "expanded": false,
          "children": [],
          "type": "combo"
         },
         {
          "configs": {
           "itemId": "payer",
           "labelAlign": "right",
           "pickList": "[\
  ['1', '现金'],\
  ['2', '月结']\
]",
           "fieldLabel": "收费类型",
           "x": "222",
           "width": "281",
           "y": "48",
           "labelWidth": "70",
           "height": "22"
          },
          "expanded": false,
          "children": [],
          "type": "combo"
         },
         {
          "configs": {
           "itemId": "notes",
           "labelAlign": "right",
           "fieldLabel": "备注",
           "x": "16",
           "width": "1150",
           "y": "80",
           "labelWidth": "60",
           "height": "60"
          },
          "expanded": false,
          "children": [],
          "type": "textarea"
         }
        ],
        "type": "panel",
        "events": {"afterrender": "panel.body.on('click', function() {\
  choosePanel = 'titlepanel';\
  panel.el.dom.style.border = 'solid 1px blue';\
  app.infopanel.el.dom.style.border = '';\
  app.feepanel.el.dom.style.border = '';\
});"}
       },
       {
        "configs": {
         "layout": "fit",
         "itemId": "infopanel",
         "width": "700",
         "region": "west",
         "frame": "true"
        },
        "expanded": true,
        "children": [{
         "configs": {
          "itemId": "infogrid",
          "editable": "true"
         },
         "expanded": true,
         "children": [
          {
           "configs": {
            "itemId": "store",
            "url": "m?xwl=BuzManage/sundryFeeSql/selectinfo"
           },
           "expanded": false,
           "children": [],
           "type": "store"
          },
          {
           "configs": {"itemId": "columns"},
           "expanded": true,
           "children": [
            {
             "configs": {
              "itemId": "colID",
              "hidden": "true",
              "dataIndex": "ID",
              "text": "主键ID"
             },
             "expanded": true,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colTID",
              "hidden": "true",
              "dataIndex": "TID",
              "text": "主表ID"
             },
             "expanded": true,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colBILL_NO",
              "dataIndex": "BILL_NO",
              "width": "120",
              "text": "提单号"
             },
             "expanded": true,
             "children": [{
              "configs": {"itemId": "editor"},
              "expanded": false,
              "children": [],
              "type": "text"
             }],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colFEE_WGT",
              "renderer": "if (value == '0') {\
  return '不计';\
}\
if (value == '1') {\
  return '计费';\
}",
              "dataIndex": "FEE_WGT",
              "width": "70",
              "text": "<span style='color:red'>*计费状态<\/span>"
             },
             "expanded": true,
             "children": [{
              "configs": {
               "itemId": "editor",
               "allowBlank": "false",
               "pickList": "[['0','不计'],['1','计费']]"
              },
              "expanded": false,
              "children": [],
              "type": "combo"
             }],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colCARGO_NAME",
              "dataIndex": "CARGO_NAME",
              "text": "货名/箱号"
             },
             "expanded": false,
             "children": [{
              "configs": {"itemId": "editor"},
              "expanded": false,
              "children": [],
              "type": "text"
             }],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colPKG_KIND_COD",
              "dataIndex": "PKG_KIND_COD",
              "keyName": "CARGO_TYPE",
              "text": "货物属性"
             },
             "expanded": true,
             "children": [{
              "configs": {
               "itemId": "editor",
               "allowBlank": "false",
               "keyName": "CARGO_TYPE",
               "displayField": "V",
               "valueField": "K"
              },
              "expanded": false,
              "children": [],
              "type": "combo",
              "events": {"select": "// var rec=app.infogrid.getSelection()[0];\
// rec.set('PKG_KIND_COD',records[0].data.K);"}
             }],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colPKG_KIND_NAME",
              "renderer": "if(value=='C'){\
return '重箱';\
}\
if(value=='E'){\
return '空箱';\
}\
if(value=='P'){\
return '拼箱';\
}\
if(value=='S'){\
return '散货';\
}",
              "dataIndex": "PKG_KIND_NAME",
              "text": "<span style='color:red'>*包装类型<\/span>"
             },
             "expanded": true,
             "children": [{
              "configs": {
               "itemId": "editor",
               "pickList": "[\
  ['C','重箱'],\
  ['E','空箱'],\
  ['P','拼箱'],\
  ['S','散货']\
]"
              },
              "expanded": false,
              "children": [],
              "type": "combo"
             }],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colPIECES",
              "dataIndex": "PIECES",
              "width": "50",
              "text": "件数",
              "align": "right",
              "titleAlign": "center"
             },
             "expanded": true,
             "children": [{
              "configs": {"itemId": "editor"},
              "expanded": false,
              "children": [],
              "type": "number"
             }],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colCARGO_GROSS_WGT",
              "dataIndex": "CARGO_GROSS_WGT",
              "width": "70",
              "text": "毛重(吨)",
              "align": "right",
              "titleAlign": "center"
             },
             "expanded": true,
             "children": [{
              "configs": {
               "itemId": "editor",
               "decimalPrecision": "3"
              },
              "expanded": false,
              "children": [],
              "type": "number"
             }],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colCARGO_NET_WGT",
              "dataIndex": "CARGO_NET_WGT",
              "width": "90",
              "text": "计费重量(吨)",
              "align": "right",
              "titleAlign": "center"
             },
             "expanded": true,
             "children": [{
              "configs": {
               "itemId": "editor",
               "decimalPrecision": "3"
              },
              "expanded": false,
              "children": [],
              "type": "number"
             }],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "CREATED_BY",
              "hidden": "true",
              "dataIndex": "CREATED_BY",
              "text": "创建人"
             },
             "expanded": true,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "UPDATED_ON",
              "hidden": "true",
              "dataIndex": "UPDATED_ON",
              "text": "修改时间"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "CREATED_ON",
              "hidden": "true",
              "dataIndex": "CREATED_ON",
              "text": "创建时间"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "UPDATED_BY",
              "hidden": "true",
              "dataIndex": "UPDATED_BY",
              "text": "修改人"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            }
           ],
           "type": "array"
          }
         ],
         "type": "grid"
        }],
        "type": "panel",
        "events": {"afterrender": "panel.body.on('click', function() {\
  choosePanel = 'infopanel';\
  panel.el.dom.style.border = 'solid 1px blue';\
  app.titlepanel.el.dom.style.border = '';\
  app.feepanel.el.dom.style.border = '';\
});"}
       },
       {
        "configs": {
         "layout": "fit",
         "itemId": "feepanel",
         "region": "center"
        },
        "expanded": true,
        "children": [{
         "configs": {
          "itemId": "feegrid",
          "editable": "true"
         },
         "expanded": true,
         "children": [
          {
           "configs": {
            "itemId": "store",
            "url": "m?xwl=BuzManage/sundryFeeSql/selectfee"
           },
           "expanded": false,
           "children": [],
           "type": "store"
          },
          {
           "configs": {"itemId": "features"},
           "expanded": true,
           "children": [{
            "configs": {
             "itemId": "features",
             "ftype": "summary"
            },
            "expanded": false,
            "children": [],
            "type": "feature"
           }],
           "type": "array"
          },
          {
           "configs": {"itemId": "columns"},
           "expanded": true,
           "children": [
            {
             "configs": {
              "itemId": "colID",
              "hidden": "true",
              "dataIndex": "ID",
              "text": "主键ID"
             },
             "expanded": true,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colTID",
              "hidden": "true",
              "dataIndex": "TID",
              "text": "主表ID"
             },
             "expanded": true,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colBILL_NO",
              "hidden": "true",
              "dataIndex": "BILL_NO",
              "text": "提单号"
             },
             "expanded": true,
             "children": [{
              "configs": {"itemId": "editor"},
              "expanded": false,
              "children": [],
              "type": "text"
             }],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colFEE_LIST_ID",
              "summaryRenderer": "return '合计：';",
              "dataIndex": "FEE_LIST_ID",
              "width": "130",
              "keyName": "C_BASE_CHARGING_ITEM",
              "text": "费目"
             },
             "expanded": true,
             "children": [{
              "configs": {
               "itemId": "editor",
               "queryMode": "local",
               "displayField": "CNAME",
               "valueField": "ID",
               "anyMatch": "true"
              },
              "expanded": true,
              "children": [{
               "configs": {
                "itemId": "store",
                "autoLoad": "true",
                "params": "{fldId:'C_BASE_CHARGING_ITEM'}",
                "url": "m?xwl=system/common/codeSelect"
               },
               "expanded": false,
               "children": [],
               "type": "store"
              }],
              "type": "combo"
             }],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colcontractRate",
              "dataIndex": "CONTRACT_RATE",
              "width": "50",
              "text": "单价",
              "align": "right",
              "titleAlign": "center"
             },
             "expanded": true,
             "children": [{
              "configs": {
               "itemId": "editor",
               "decimalPrecision": "3"
              },
              "expanded": false,
              "children": [],
              "type": "number",
              "events": {"change": "var fee=app.feegrid.getSelection()[0];\
var contractRate=this.getValue();\
var actualJobCount=fee.data.ACTUAL_JOB_COUNT;\
var contractAddRate=fee.data.CONTRACT_ADD_RATE;\
var dwellDays=fee.data.DWELL_DAYS;\
var amount=contractRate*actualJobCount*contractAddRate*dwellDays/100;\
fee.set(\"AMOUNT\",amount);\
"}
             }],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colactualJobCount",
              "dataIndex": "ACTUAL_JOB_COUNT",
              "width": "65",
              "text": "数量",
              "align": "right",
              "titleAlign": "center"
             },
             "expanded": true,
             "children": [{
              "configs": {
               "itemId": "editor",
               "decimalPrecision": "3"
              },
              "expanded": false,
              "children": [],
              "type": "number",
              "events": {"change": "var fee=app.feegrid.getSelection()[0];\
var actualJobCount=this.getValue();\
if(fee.data.CONTRACT_RATE!=null&&fee.data.CONTRACT_RATE!=''){\
var contractRate=fee.data.CONTRACT_RATE;\
var contractAddRate=fee.data.CONTRACT_ADD_RATE;\
var dwellDays=fee.data.DWELL_DAYS;\
var amount=contractRate*actualJobCount*contractAddRate*dwellDays/100;\
fee.set(\"AMOUNT\",amount);\
}"}
             }],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "coldwellDays",
              "dataIndex": "DWELL_DAYS",
              "width": "50",
              "text": "天数",
              "align": "right",
              "titleAlign": "center"
             },
             "expanded": true,
             "children": [{
              "configs": {"itemId": "editor"},
              "expanded": false,
              "children": [],
              "type": "number",
              "events": {"change": "var fee=app.feegrid.getSelection()[0];\
var dwellDays=this.getValue();\
if(fee.data.CONTRACT_RATE!=null&&fee.data.CONTRACT_RATE!=''){\
var contractRate=fee.data.CONTRACT_RATE;\
var contractAddRate=fee.data.CONTRACT_ADD_RATE;\
var actualJobCount=fee.data.ACTUAL_JOB_COUNT;\
var amount=contractRate*actualJobCount*contractAddRate*dwellDays/100;\
fee.set(\"AMOUNT\",amount);\
}"}
             }],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colcontractAddRate",
              "dataIndex": "CONTRACT_ADD_RATE",
              "width": "50",
              "text": "折扣",
              "align": "right",
              "titleAlign": "center"
             },
             "expanded": true,
             "children": [{
              "configs": {"itemId": "editor"},
              "expanded": false,
              "children": [],
              "type": "number",
              "events": {"change": "var fee=app.feegrid.getSelection()[0];\
var contractAddRate=this.getValue();\
if(fee.data.CONTRACT_RATE!=null&&fee.data.CONTRACT_RATE!=''){\
var contractRate=fee.data.CONTRACT_RATE;\
var dwellDays=fee.data.DWELL_DAYS;\
var actualJobCount=fee.data.ACTUAL_JOB_COUNT;\
var amount=contractRate*actualJobCount*contractAddRate*dwellDays/100;\
fee.set(\"AMOUNT\",amount);\
}"}
             }],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colamount",
              "summaryRenderer": "value=value.toFixed(3);\
return Wb.format('共 {0} ', value);",
              "dataIndex": "AMOUNT",
              "summaryType": "sum",
              "width": "90",
              "format": ".000",
              "text": "总价",
              "align": "right",
              "titleAlign": "center"
             },
             "expanded": true,
             "children": [{
              "configs": {
               "itemId": "editor",
               "decimalPrecision": "3"
              },
              "expanded": false,
              "children": [],
              "type": "number"
             }],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colPAY_FLAG",
              "renderer": "if (value == '0') {\
  return '未收费';\
}\
if (value == '1') {\
  return '已收费';\
}",
              "dataIndex": "PAY_FLAG",
              "width": "65",
              "text": "收费状态",
              "align": "right",
              "titleAlign": "center"
             },
             "expanded": true,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "CREATED_BY",
              "hidden": "true",
              "dataIndex": "CREATED_BY",
              "text": "创建人"
             },
             "expanded": true,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "UPDATED_ON",
              "hidden": "true",
              "dataIndex": "UPDATED_ON",
              "text": "修改时间"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "CREATED_ON",
              "hidden": "true",
              "dataIndex": "CREATED_ON",
              "text": "创建时间"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "UPDATED_BY",
              "hidden": "true",
              "dataIndex": "UPDATED_BY",
              "text": "修改人"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            }
           ],
           "type": "array"
          }
         ],
         "type": "grid"
        }],
        "type": "panel",
        "events": {"afterrender": "panel.body.on('click', function() {\
  choosePanel = 'feepanel';\
  panel.el.dom.style.border = 'solid 1px blue';\
  app.infopanel.el.dom.style.border = '';\
  app.titlepanel.el.dom.style.border = '';\
});"}
       }
      ],
      "type": "panel"
     },
     {
      "configs": {
       "border": "false",
       "layout": "border",
       "itemId": "panelPrint",
       "region": "south",
       "height": "0"
      },
      "expanded": false,
      "children": [{
       "configs": {
        "border": "false",
        "itemId": "panelPrintF",
        "width": "60",
        "region": "east",
        "height": "0"
       },
       "expanded": false,
       "children": [],
       "type": "panel"
      }],
      "type": "panel"
     }
    ],
    "type": "viewport",
    "events": {
     "afterrender": "var mt1 = bldStr(\"LuxForm\", opt, \"\", \"100%\");\
app.panelPrintF.update(mt1);\
",
     "destroy": "\
delete window[\"init\" + opt];"
    }
   }
  ],
  "type": "module",
  "events": {
   "finalize": "window[\"init\" + opt] = function(id) {\
  var m = document.getElementById(opt);\
  if (id == opt) {\
    m.func(\"setCookie\", \"JSESSIONID={#JSESSIONID#}\");\
    m.func(\"Build\", 'supcan/report/print/vbillheadoth_print.xml?' + Math.round(Math.random() * 100));\
    m.func(\"DisableMenu\", \"showRuler,exportAll,printAll,delete,insert,import ,curselMode,hue ,language , enter    \\r\\
 true\");\
    m.func(\"SetSource\", \"m?xwl=system/common/report/reportTemplate/dataSource\");\
    m.func(\"SetPrintProp\", \"paperNumber=79;Oriantation=Portrait\");\
  }\
};\
var choosePanel;\
app.tradeId.setValue('2');\
app.iEId.setValue('I');\
app.createBegin.setValue(new Date());\
app.createEnd.setValue(new Date());\
// app.queryBtn.fireEvent('click');\
",
   "initialize": "var opt = Wb.getId();"
  }
 }],
 "roles": {"SWB": 1},
 "title": "杂项费用录入",
 "iconCls": "",
 "inframe": false,
 "pageLink": ""
}