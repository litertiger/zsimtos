{
 "hidden": false,
 "children": [{
  "configs": {
   "itemId": "module",
   "serverScript": "var path = StringUtil.replaceAll(Base.path, \"\\\\\",\"\\\\\\\\\");\
request.setAttribute('path', path);\
\
 app.set({\
   verifyConcatMenu: app.perm('m?xwl=feeManage/contract/java/verify')\
 });"
  },
  "expanded": true,
  "children": [
   {
    "configs": {
     "layout": "absolute",
     "itemId": "concatWin",
     "dialog": "true",
     "closeAction": "hide",
     "width": "824",
     "title": "合同维护",
     "height": "512"
    },
    "expanded": true,
    "children": [
     {
      "configs": {
       "layout": "absolute",
       "itemId": "form1",
       "x": "8",
       "width": "800",
       "y": "8",
       "height": "304"
      },
      "expanded": true,
      "children": [
       {
        "configs": {
         "itemId": "COPY_ID",
         "hidden": "true",
         "width": "240",
         "x": "24",
         "y": "8",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "ID",
         "hidden": "true",
         "width": "240",
         "x": "24",
         "y": "8",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "DESCRIPTION",
         "labelAlign": "right",
         "fieldLabel": "<font color='red'>*<\/font>合同名称",
         "width": "260",
         "x": "-16",
         "y": "16",
         "labelWidth": "110",
         "height": "24"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "LIFE_STATUS",
         "labelAlign": "right",
         "pickList": "[[1,'启用'],[2,'不启用']]",
         "fieldLabel": "<font color='red'>*<\/font>启用状态",
         "width": "260",
         "x": "520",
         "y": "80",
         "labelWidth": "110",
         "height": "22"
        },
        "expanded": true,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "ORIGINAL_CONTRACT_ID",
         "labelAlign": "right",
         "fieldLabel": "原始合同编号",
         "width": "260",
         "x": "520",
         "y": "16",
         "labelWidth": "110",
         "height": "24"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "CONTRACT_NO",
         "labelAlign": "right",
         "fieldLabel": "合同编号",
         "width": "260",
         "x": "248",
         "y": "16",
         "labelWidth": "110",
         "height": "24"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "VERSION_MEMO",
         "labelAlign": "right",
         "fieldLabel": "版本备注",
         "width": "260",
         "x": "248",
         "y": "176",
         "labelWidth": "110",
         "height": "24"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "CONFIRM_USER",
         "labelAlign": "right",
         "fieldLabel": "合同确认人",
         "width": "260",
         "x": "-16",
         "y": "112",
         "labelWidth": "110",
         "disabled": "true",
         "height": "24"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "VERSION",
         "labelAlign": "right",
         "fieldLabel": "版本号",
         "width": "260",
         "x": "-16",
         "y": "176",
         "labelWidth": "110",
         "height": "24"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "PAYMENT_AGENT",
         "labelAlign": "right",
         "fieldLabel": "付费代理",
         "width": "260",
         "x": "248",
         "y": "112",
         "labelWidth": "110",
         "height": "24"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "APPROVE_MEMO",
         "labelAlign": "right",
         "fieldLabel": "审核备注",
         "width": "796",
         "x": "-16",
         "y": "208",
         "labelWidth": "110",
         "height": "24"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "IS_DEFAULT",
         "labelAlign": "right",
         "pickList": "[[0,'否'],[1,'是']]",
         "fieldLabel": "是否标准合同",
         "width": "260",
         "x": "520",
         "y": "176",
         "labelWidth": "110",
         "height": "22"
        },
        "expanded": true,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "NOTES",
         "labelAlign": "right",
         "fieldLabel": "备注",
         "width": "796",
         "x": "-16",
         "y": "240",
         "labelWidth": "110",
         "height": "24"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "EFFECTIVE_DATE",
         "labelAlign": "right",
         "fieldLabel": "<font color='red'>*<\/font>生效日期",
         "x": "-16",
         "width": "260",
         "y": "48",
         "labelWidth": "110",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "date"
       },
       {
        "configs": {
         "itemId": "EXPIRED_DATE",
         "labelAlign": "right",
         "fieldLabel": "<font color='red'>*<\/font>失效日期",
         "x": "248",
         "width": "260",
         "y": "48",
         "labelWidth": "110",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "date"
       },
       {
        "configs": {
         "itemId": "CONFIRM_STATUS",
         "labelAlign": "right",
         "pickList": "[[0,'未提交'],[1,'已提交未审核'],[2,'已经审核'],[3,'未通过']]",
         "fieldLabel": "合同审核",
         "width": "260",
         "x": "-16",
         "y": "80",
         "labelWidth": "110",
         "disabled": "true",
         "height": "22"
        },
        "expanded": true,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "CONFIRM_DATE",
         "labelAlign": "right",
         "fieldLabel": "合同确认时间",
         "x": "248",
         "width": "260",
         "y": "80",
         "labelWidth": "110",
         "disabled": "true",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "date"
       },
       {
        "configs": {
         "itemId": "CONTRACT_TYPE",
         "labelAlign": "right",
         "pickList": "[[0,'船方'],[1,'货方']]",
         "fieldLabel": "合同类型",
         "width": "260",
         "x": "-16",
         "y": "144",
         "labelWidth": "110",
         "height": "22"
        },
        "expanded": true,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "EXPAND_TO",
         "labelAlign": "right",
         "fieldLabel": "过期时间延长值",
         "x": "520",
         "width": "260",
         "y": "48",
         "labelWidth": "110",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "date"
       },
       {
        "configs": {
         "itemId": "TRADE_TYPE",
         "labelAlign": "right",
         "pickList": "[['E','外贸'],['I','内贸']]",
         "fieldLabel": "贸易类型",
         "width": "260",
         "x": "248",
         "y": "144",
         "labelWidth": "110",
         "height": "22"
        },
        "expanded": true,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "CATEGORY",
         "labelAlign": "right",
         "pickList": "[[0,'草稿'],[1,'模版'],[2,'正常合同']]",
         "fieldLabel": "<font color='red'>*<\/font>合同属性",
         "width": "260",
         "x": "520",
         "y": "112",
         "labelWidth": "110",
         "height": "22"
        },
        "expanded": true,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "CURRENCY_ID",
         "labelAlign": "right",
         "pickList": "[[1,'现金'],[2,'月结'],[3,'托收单']]",
         "fieldLabel": "结算类型",
         "width": "260",
         "x": "520",
         "y": "144",
         "labelWidth": "110",
         "height": "22"
        },
        "expanded": true,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "FILE_PATH",
         "labelAlign": "right",
         "fieldLabel": "附件",
         "width": "787",
         "x": "-8",
         "multiple": "true",
         "y": "272",
         "height": "22"
        },
        "expanded": true,
        "children": [],
        "type": "file"
       },
       {
        "configs": {
         "itemId": "verifStatus",
         "hidden": "true",
         "labelAlign": "right",
         "width": "796",
         "x": "-16",
         "y": "240",
         "labelWidth": "110",
         "height": "24"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       }
      ],
      "type": "form"
     },
     {
      "configs": {
       "layout": "fit",
       "itemId": "panelCbzs1",
       "x": "8",
       "width": "800",
       "y": "312",
       "frame": "true",
       "height": "143"
      },
      "expanded": true,
      "children": [{
       "configs": {
        "itemId": "gridCBZS",
        "tbar": "app.tbarCbzs",
        "disabled": "false",
        "region": "center",
        "multiSelect": "true"
       },
       "expanded": false,
       "children": [
        {
         "configs": {
          "itemId": "store",
          "autoLoad": "true",
          "url": "m?xwl=feeManage/contract/sql/queryFile"
         },
         "expanded": false,
         "children": [],
         "type": "store"
        },
        {
         "configs": {"itemId": "columns"},
         "expanded": true,
         "children": [
          {
           "configs": {
            "itemId": "colID",
            "hidden": "true",
            "dataIndex": "ID",
            "text": "文件id"
           },
           "expanded": false,
           "children": [],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "M_ID",
            "hidden": "true",
            "dataIndex": "M_ID",
            "text": "表单id"
           },
           "expanded": false,
           "children": [],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "PATH",
            "hidden": "true",
            "dataIndex": "PATH",
            "text": "路径"
           },
           "expanded": false,
           "children": [],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "column1",
            "xtype": "rownumberer",
            "width": "30"
           },
           "expanded": false,
           "children": [],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "M_NAME",
            "dataIndex": "M_NAME",
            "width": "260",
            "text": "文件名"
           },
           "expanded": false,
           "children": [],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "CREATE_NAM",
            "dataIndex": "CREATE_NAM",
            "width": "80",
            "text": "创建人"
           },
           "expanded": false,
           "children": [],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "CREATE_TIM",
            "dataIndex": "CREATE_TIM",
            "width": "80",
            "text": "创建时间"
           },
           "expanded": false,
           "children": [],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "actionColumns",
            "xtype": "actioncolumn",
            "width": "60",
            "text": "下载",
            "align": "center"
           },
           "expanded": false,
           "children": [{
            "configs": {"itemId": "items"},
            "expanded": true,
            "children": [{
             "configs": {
              "itemId": "fileDown",
              "handler": "/*app.imgWin.setTitle('图片 - ' + record.data.NAME);\
app.imgWin.setIconCls('zoom_icon');\
app.imgWin.down('[iconCls=ok_icon]').hide(true); //隐藏窗体确定按钮\
//重置图片\
app.image1.setSrc('');\
//设置图片地址\
app.image1.setSrc(record.data.PHOTO);\
//显示图片\
app.imgWin.show();*/\
var path ='{#path#}' + record.data.PATH;\
//path = path.substring(1, path.length);\
\
Wb.download('m?xwl=dev/ide/download', {\
  files: [path],\
  foo: 'bar'\
});",
              "tooltip": "下载附件",
              "iconCls": "level_down_icon"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            }],
            "type": "array"
           }],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "actionColumns1",
            "xtype": "actioncolumn",
            "width": "60",
            "text": "删除",
            "align": "center"
           },
           "expanded": false,
           "children": [{
            "configs": {"itemId": "items"},
            "expanded": true,
            "children": [{
             "configs": {
              "itemId": "delFile",
              "handler": "var model = app.gridCBZS.getSelectionModel();\
model.select(rowIndex);\
var param ={\
  url : 'm?xwl=feeManage/contract/sql/delFile',\
  params:{ID: record.data.ID},\
//   failure :function(){\
//     alert('数据已被使用，不能删除！');\
//   },\
  titleField:'M_NAME'\
};\
\
Wb.del(app.gridCBZS, param);\
",
              "tooltip": "删除附件",
              "iconCls": "file_delete_icon"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            }],
            "type": "array"
           }],
           "type": "column"
          }
         ],
         "type": "array"
        }
       ],
       "type": "grid"
      }],
      "type": "panel"
     }
    ],
    "type": "window",
    "events": {"ok": "\
var verify = app.verifStatus.getValue();\
if(app.CONFIRM_STATUS.getValue() == 2){\
  if(verify == \"verify\"){\
    Wb.warn(\"不能重复审核！\");\
  }else{\
    Wb.warn(\"该合同已审核不能修改！\");\
  }\
  return;\
}\
var values = Wb.getValue(app.form1);\
var cid = Wb.getVal(app.form1, 'ID');\
var copyId = Wb.getVal(app.form1, 'COPY_ID');\
var url = \"\";\
if(verify == \"copy\"){\
  url = \"m?xwl=feeManage/contract/java/copy\";\
}else if(verify == \"insert\"){\
  url = \"m?xwl=feeManage/contract/java/insert\";\
}else if(verify == \"update\"){\
  url = \"m?xwl=feeManage/contract/java/update\";\
}\
if(verify == \"verify\"){\
  url = \"m?xwl=feeManage/contract/java/verify\";\
  Wb.request({\
    url: url,\
    params: values,\
    success: function(resp) {\
      app.concatGrid.store.load();\
      app.concatWin.hide();\
      app.tree1.store.load();\
  }\
  });\
  return ;\
}\
Wb.upload({\
  form: app.form1,\
  showProgress: true,\
  url: url,\
  params: values,\
  success: function(resp) {\
    app.concatGrid.store.load();\
    app.concatWin.hide();\
    app.tree1.store.load();\
  }\
});"}
   },
   {
    "configs": {
     "layout": "absolute",
     "itemId": "verifyWin",
     "dialog": "false",
     "closeAction": "hide",
     "width": "824",
     "title": "合同审核",
     "height": "512"
    },
    "expanded": false,
    "children": [
     {
      "configs": {
       "layout": "absolute",
       "itemId": "form2",
       "x": "8",
       "width": "800",
       "y": "8",
       "height": "304"
      },
      "expanded": true,
      "children": [
       {
        "configs": {
         "itemId": "vID",
         "hidden": "true",
         "width": "240",
         "x": "24",
         "y": "8",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "vDESCRIPTION",
         "labelAlign": "right",
         "fieldLabel": "合同名称",
         "width": "260",
         "x": "-16",
         "y": "16",
         "labelWidth": "110",
         "height": "24"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "vLIFE_STATUS",
         "labelAlign": "right",
         "pickList": "[[1,'启用'],[2,'不启用']]",
         "fieldLabel": "启用状态",
         "width": "260",
         "x": "520",
         "y": "80",
         "labelWidth": "110",
         "height": "22"
        },
        "expanded": true,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "vORIGINAL_CONTRACT_ID",
         "labelAlign": "right",
         "fieldLabel": "原始合同编号",
         "width": "260",
         "x": "520",
         "y": "16",
         "labelWidth": "110",
         "height": "24"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "vCONTRACT_NO",
         "labelAlign": "right",
         "fieldLabel": "合同编号",
         "width": "260",
         "x": "248",
         "y": "16",
         "labelWidth": "110",
         "height": "24"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "vVERSION_MEMO",
         "labelAlign": "right",
         "fieldLabel": "版本备注",
         "width": "260",
         "x": "520",
         "y": "176",
         "labelWidth": "110",
         "height": "24"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "vCONFIRM_USER",
         "labelAlign": "right",
         "fieldLabel": "合同确认人",
         "width": "260",
         "x": "-16",
         "y": "112",
         "labelWidth": "110",
         "height": "24"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "vVERSION",
         "labelAlign": "right",
         "fieldLabel": "版本号",
         "width": "260",
         "x": "248",
         "y": "176",
         "labelWidth": "110",
         "height": "24"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "vPAYMENT_AGENT",
         "labelAlign": "right",
         "fieldLabel": "付费代理",
         "width": "260",
         "x": "520",
         "y": "112",
         "labelWidth": "110",
         "height": "24"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "vAPPROVE_MEMO",
         "labelAlign": "right",
         "fieldLabel": "审核备注",
         "width": "404",
         "x": "376",
         "y": "208",
         "labelWidth": "110",
         "height": "24"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "vBIZ_SCOPE",
         "labelAlign": "right",
         "fieldLabel": "业务范围",
         "width": "380",
         "x": "-16",
         "y": "208",
         "labelWidth": "110",
         "height": "24"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "vNOTES",
         "labelAlign": "right",
         "fieldLabel": "备注",
         "width": "796",
         "x": "-16",
         "y": "240",
         "labelWidth": "110",
         "height": "24"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "vEFFECTIVE_DATE",
         "labelAlign": "right",
         "fieldLabel": "生效日期",
         "x": "-16",
         "width": "260",
         "y": "48",
         "labelWidth": "110",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "date"
       },
       {
        "configs": {
         "itemId": "vEXPIRED_DATE",
         "labelAlign": "right",
         "fieldLabel": "失效日期",
         "x": "248",
         "width": "260",
         "y": "48",
         "labelWidth": "110",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "date"
       },
       {
        "configs": {
         "itemId": "vCONFIRM_STATUS",
         "labelAlign": "right",
         "pickList": "[[0,'未提交'],[1,'已提交未审核'],[2,'已经审核'],[3,'未通过']]",
         "fieldLabel": "合同审核",
         "width": "260",
         "x": "-16",
         "y": "80",
         "labelWidth": "110",
         "disabled": "true",
         "height": "22"
        },
        "expanded": true,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "vCONFIRM_DATE",
         "labelAlign": "right",
         "fieldLabel": "合同确认时间",
         "x": "248",
         "width": "260",
         "y": "80",
         "labelWidth": "110",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "date"
       },
       {
        "configs": {
         "itemId": "vPAYMENT_TYPE",
         "labelAlign": "right",
         "pickList": "[[0,'现金'],[1,'挂账']]",
         "fieldLabel": "付费类型",
         "width": "260",
         "x": "248",
         "y": "112",
         "labelWidth": "110",
         "height": "22"
        },
        "expanded": true,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "vCONTRACT_TYPE",
         "labelAlign": "right",
         "pickList": "[[0,'船方'],[1,'货方']]",
         "fieldLabel": "合同类型",
         "width": "260",
         "x": "-16",
         "y": "144",
         "labelWidth": "110",
         "height": "22"
        },
        "expanded": true,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "vEXPAND_TO",
         "labelAlign": "right",
         "fieldLabel": "过期时间延长值",
         "x": "520",
         "width": "260",
         "y": "48",
         "labelWidth": "110",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "date"
       },
       {
        "configs": {
         "itemId": "vTRADE_TYPE",
         "labelAlign": "right",
         "pickList": "[['E','外贸'],['I','内贸']]",
         "fieldLabel": "贸易类型",
         "width": "260",
         "x": "248",
         "y": "144",
         "labelWidth": "110",
         "height": "22"
        },
        "expanded": true,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "vCATEGORY",
         "labelAlign": "right",
         "pickList": "[[0,'草稿'],[1,'模版'],[2,'正常合同']]",
         "fieldLabel": "合同属性",
         "width": "260",
         "x": "520",
         "y": "144",
         "labelWidth": "110",
         "height": "22"
        },
        "expanded": true,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "vCURRENCY_ID",
         "labelAlign": "right",
         "pickList": "[[1,'现金'],[2,'月结'],[3,'托收单']]",
         "fieldLabel": "结算类型",
         "width": "260",
         "x": "-16",
         "y": "176",
         "labelWidth": "110",
         "height": "22"
        },
        "expanded": true,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "vFILE_PATH",
         "labelAlign": "right",
         "fieldLabel": "附件",
         "width": "787",
         "x": "-8",
         "multiple": "true",
         "y": "272",
         "height": "22"
        },
        "expanded": true,
        "children": [],
        "type": "file"
       }
      ],
      "type": "form"
     },
     {
      "configs": {
       "layout": "fit",
       "itemId": "vpanelCbzs",
       "x": "8",
       "width": "800",
       "y": "312",
       "frame": "true",
       "height": "143"
      },
      "expanded": true,
      "children": [{
       "configs": {
        "itemId": "vgrid",
        "tbar": "app.tbarCbzs",
        "disabled": "false",
        "region": "center",
        "multiSelect": "true"
       },
       "expanded": true,
       "children": [
        {
         "configs": {
          "itemId": "store",
          "autoLoad": "true",
          "url": "m?xwl=feeManage/contract/sql/queryFile"
         },
         "expanded": false,
         "children": [],
         "type": "store"
        },
        {
         "configs": {"itemId": "columns"},
         "expanded": true,
         "children": [
          {
           "configs": {
            "itemId": "vcolID",
            "hidden": "true",
            "dataIndex": "ID",
            "text": "文件id"
           },
           "expanded": false,
           "children": [],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "vM_ID",
            "hidden": "true",
            "dataIndex": "M_ID",
            "text": "表单id"
           },
           "expanded": false,
           "children": [],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "vPATH",
            "hidden": "true",
            "dataIndex": "PATH",
            "text": "路径"
           },
           "expanded": false,
           "children": [],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "column1",
            "xtype": "rownumberer",
            "width": "30"
           },
           "expanded": false,
           "children": [],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "vM_NAME",
            "dataIndex": "M_NAME",
            "width": "260",
            "text": "文件名"
           },
           "expanded": false,
           "children": [],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "vCREATE_NAM",
            "dataIndex": "CREATE_NAM",
            "width": "80",
            "text": "创建人"
           },
           "expanded": false,
           "children": [],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "vCREATE_TIM",
            "dataIndex": "CREATE_TIM",
            "width": "80",
            "text": "创建时间"
           },
           "expanded": false,
           "children": [],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "vactionColumns",
            "xtype": "actioncolumn",
            "width": "60",
            "text": "下载",
            "align": "center"
           },
           "expanded": true,
           "children": [{
            "configs": {"itemId": "items"},
            "expanded": true,
            "children": [{
             "configs": {
              "itemId": "vfileDown",
              "handler": "/*app.imgWin.setTitle('图片 - ' + record.data.NAME);\
app.imgWin.setIconCls('zoom_icon');\
app.imgWin.down('[iconCls=ok_icon]').hide(true); //隐藏窗体确定按钮\
//重置图片\
app.image1.setSrc('');\
//设置图片地址\
app.image1.setSrc(record.data.PHOTO);\
//显示图片\
app.imgWin.show();*/\
var path ='{#path#}' + record.data.PATH;\
//path = path.substring(1, path.length);\
\
Wb.download('m?xwl=dev/ide/download', {\
  files: [path],\
  foo: 'bar'\
});",
              "tooltip": "下载附件",
              "iconCls": "level_down_icon"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            }],
            "type": "array"
           }],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "vactionColumns1",
            "xtype": "actioncolumn",
            "width": "60",
            "text": "删除",
            "align": "center"
           },
           "expanded": true,
           "children": [{
            "configs": {"itemId": "items"},
            "expanded": true,
            "children": [{
             "configs": {
              "itemId": "vdelFile",
              "handler": "var model = app.vgridCBZS.getSelectionModel();\
model.select(rowIndex);\
var param ={\
  url : 'm?xwl=feeManage/contract/sql/delFile',\
  params:{ID: record.data.ID},\
//   failure :function(){\
//     alert('数据已被使用，不能删除！');\
//   },\
  titleField:'M_NAME'\
};\
\
Wb.del(app.vgridCBZS, param);\
",
              "tooltip": "删除附件",
              "iconCls": "file_delete_icon"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            }],
            "type": "array"
           }],
           "type": "column"
          }
         ],
         "type": "array"
        }
       ],
       "type": "grid"
      }],
      "type": "panel"
     }
    ],
    "type": "window",
    "events": {"ok": "if(app.vCONFIRM_STATUS == 2){\
  Wb.warn(\"该合同已审核！\");\
  return;\
}\
var values = Wb.getValue(app.form2);\
\
var url =  \"m?xwl=feeManage/contract/java/verify\";\
\
\
Wb.request({\
  url: url,\
  params: values,\
  success: function(resp) {\
    app.vgrid.store.load();\
    app.verifyWin.hide();\
  }\
});"}
   },
   {
    "configs": {
     "layout": "absolute",
     "itemId": "feeClassWin",
     "dialog": "true",
     "closeAction": "hide",
     "width": "344",
     "title": "选择合同费类",
     "height": "416"
    },
    "expanded": true,
    "children": [{
     "configs": {
      "itemId": "feeClassWinGrid",
      "submitSelect": "true",
      "selType": "checkboxmodel",
      "sortableColumns": "false",
      "simpleSelect": "true",
      "pagingBar": "false",
      "x": "8",
      "width": "320",
      "y": "8",
      "region": "center",
      "multiSelect": "true",
      "height": "344"
     },
     "expanded": true,
     "children": [
      {
       "configs": {
        "itemId": "store",
        "remoteSort": "true",
        "autoLoad": "true",
        "pageSize": "-1",
        "params": "{fldId:'C_BASE_CATEGORY'}",
        "url": "m?xwl=system/common/codeSelect"
       },
       "expanded": false,
       "children": [],
       "type": "store"
      },
      {
       "configs": {"itemId": "columns"},
       "expanded": true,
       "children": [
        {
         "configs": {
          "itemId": "id",
          "hidden": "true",
          "dataIndex": "COD",
          "text": "编号"
         },
         "expanded": true,
         "children": [],
         "type": "column"
        },
        {
         "configs": {
          "itemId": "name",
          "dataIndex": "CNAME",
          "width": "200",
          "text": "费类"
         },
         "expanded": false,
         "children": [],
         "type": "column"
        }
       ],
       "type": "array"
      }
     ],
     "type": "grid",
     "events": {"beforeselect": "// app.pickComp.store.load({params:{itemId:app.hidTreeID.getValue()}});"}
    }],
    "type": "window",
    "events": {"ok": "/*\
var values = Wb.getValue(app.feeClassWin);\
var cid = Wb.getVal(app.feeClassWin, 'ID');\
var url = \"\";\
if(cid === \"\"){\
  url = \"m?xwl=feeManage/contract/category/java/insert\";\
}else{\
  url = \"m?xwl=feeManage/contract/category/java/update\";\
}\
Wb.request({\
  url: url,\
  params: values,\
  success: function(resp) {\
    app.feeClassGrid.store.load({params:{CONTRACT_ID:app.hidTreeID.getValue()}});\
    app.feeClassWin.hide();\
    app.tree1.store.reload();\
  }\
});\
*/\
\
\
\
var ids=new Array();\
     var sels2 = app.feeClassWinGrid.getSelection();\
    Wb.each(sels2,function (sel){\
\t  ids.push(sel.data.ID);\
\t});\
    Wb.request({\
      url: 'm?xwl=feeManage/contract/category/java/insert',\
      params: {ids:ids,ID:app.hidContract.getValue()}, //合并窗口和记录数据作为参数，后者为默认值\
      success: function() {\
        alert(\"保存成功\");\
        app.feeClassWin.hide();\
        app.feeClassGrid.store.load({params:{CONTRACT_ID:app.hidContract.getValue()}});\
        app.tree1.store.load();\
      }\
    });"}
   },
   {
    "configs": {
     "layout": "absolute",
     "itemId": "feeItemWin",
     "dialog": "true",
     "closeAction": "hide",
     "width": "344",
     "title": "选择合同费目",
     "height": "336"
    },
    "expanded": true,
    "children": [{
     "configs": {
      "itemId": "feeItemWinGrid",
      "submitSelect": "true",
      "selType": "checkboxmodel",
      "sortableColumns": "false",
      "simpleSelect": "true",
      "pagingBar": "false",
      "x": "8",
      "width": "320",
      "y": "8",
      "region": "center",
      "multiSelect": "true",
      "height": "264"
     },
     "expanded": true,
     "children": [
      {
       "configs": {
        "itemId": "store",
        "remoteSort": "true",
        "autoLoad": "false",
        "pageSize": "-1",
        "url": "m?xwl=feeManage/category/sql/queryCantact"
       },
       "expanded": false,
       "children": [],
       "type": "store"
      },
      {
       "configs": {"itemId": "columns"},
       "expanded": true,
       "children": [
        {
         "configs": {
          "itemId": "id",
          "hidden": "true",
          "dataIndex": "CHARGING_ID",
          "text": "编号"
         },
         "expanded": true,
         "children": [],
         "type": "column"
        },
        {
         "configs": {
          "itemId": "name",
          "dataIndex": "DESCRIPTION",
          "width": "200",
          "text": "费类"
         },
         "expanded": false,
         "children": [],
         "type": "column"
        }
       ],
       "type": "array"
      }
     ],
     "type": "grid"
    }],
    "type": "window",
    "events": {"ok": "var ids=new Array();\
     var sels2 = app.feeItemWinGrid.getSelection();\
    Wb.each(sels2,function (sel){\
\t  ids.push(sel.data.CHARGING_ID);\
\t});\
    Wb.request({\
      url: 'm?xwl=feeManage/contract/item/java/insert',\
      params: {ids:ids,\
               CONTRACT_ID:app.hidContract.getValue(),\
               CATEGORY_ID:app.hidTreeID.getValue()}, //合并窗口和记录数据作为参数，后者为默认值\
      success: function() {\
        alert(\"保存成功\");\
        app.feeItemWin.hide();\
        app.feeItemGrid.store.load({params:{CONTRACT_ID:app.hidContract.getValue(),CATEGORY_ID:app.hidTreeID.getValue()}});\
        app.tree1.store.load();\
      }\
    });"}
   },
   {
    "configs": {
     "layout": "border",
     "dialog": "true",
     "itemId": "customWin",
     "closeAction": "hide",
     "width": "824",
     "title": "费率维护",
     "height": "540"
    },
    "expanded": false,
    "children": [
     {
      "configs": {
       "layout": "absolute",
       "itemId": "tariff_panel",
       "width": "768",
       "region": "center",
       "height": "332"
      },
      "expanded": false,
      "children": [
       {
        "configs": {
         "itemId": "ID",
         "hidden": "true",
         "x": "528",
         "width": "240",
         "y": "320",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "DESCRIPTION",
         "allowBlank": "true",
         "labelAlign": "right",
         "fieldLabel": "<font color='red'>*<\/font>描述",
         "width": "240",
         "x": "0",
         "y": "16",
         "labelWidth": "90",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "text",
        "events": {"change": "//text.setValue(newValue.toUpperCase());"}
       },
       {
        "configs": {
         "itemId": "FILTER_ID",
         "hidden": "true",
         "labelAlign": "right",
         "x": "80",
         "width": "240",
         "y": "320",
         "labelWidth": "90",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "FILTER_NAME",
         "labelAlign": "right",
         "editable": "true",
         "fieldLabel": "<font color='red'>*<\/font>费率条件",
         "width": "392",
         "x": "248",
         "y": "16",
         "labelWidth": "90",
         "height": "22"
        },
        "expanded": true,
        "children": [{
         "configs": {
          "itemId": "pickComp",
          "width": "900",
          "height": "250"
         },
         "expanded": true,
         "children": [
          {
           "configs": {
            "itemId": "store",
            "normalName": "pickComStore",
            "autoLoad": "false",
            "url": "m?xwl=feeManage/rule/java/queryRuleByItem"
           },
           "expanded": false,
           "children": [],
           "type": "store",
           "events": {"beforeload": "operation.params={query:operation.params.query,itemId:app.hidTreeID.getValue()};"}
          },
          {
           "configs": {"itemId": "columns"},
           "expanded": true,
           "children": [
            {
             "configs": {
              "itemId": "id",
              "hidden": "true",
              "dataIndex": "ID"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "description",
              "dataIndex": "DESCRIPTION",
              "width": "180",
              "text": "条件名称"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "notes",
              "dataIndex": "NOTES",
              "flex": "1",
              "text": "备注"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            }
           ],
           "type": "array"
          }
         ],
         "type": "grid",
         "events": {
          "itemclick": "var picker = this.ownerCmp;\
picker.setValue(record.data.DESCRIPTION);\
app.FILTER_ID.setValue(record.data.ID); //把记录EMPLOYEE_ID存放在隐藏域中，可方便被提交到后台\
picker.collapse();",
          "selectionchange": "if(selected.length === 0){\
  return;\
}\
var description = selected[\"0\"].raw.DESCRIPTION;\
Wb.setVal(app.customWin, 'DESCRIPTION', description);"
         }
        }],
        "type": "picker",
        "events": {
         "expand": "app.pickComStore.load({params:{query:'',itemId:app.hidTreeID.getValue()}});",
         "change": "// picker.expand();\
// picker.focus();\
// alert(1);\
app.pickComStore.load({params:{query:newValue,itemId:app.hidTreeID.getValue()}});",
         "focus": "// app.pickComp.store.load({params:{itemId:app.hidTreeID.getValue()}});\
\
"
        }
       },
       {
        "configs": {
         "itemId": "RATE_TYPE",
         "labelAlign": "right",
         "pickList": "[[0,'普通'], [1,'分段']]",
         "fieldLabel": "计费类型",
         "x": "496",
         "width": "240",
         "y": "48",
         "labelWidth": "90",
         "height": "24"
        },
        "expanded": false,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "GL_CODE",
         "labelAlign": "right",
         "fieldLabel": "会计科目",
         "width": "240",
         "x": "496",
         "y": "184",
         "labelWidth": "90",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "RATE",
         "labelAlign": "right",
         "fieldLabel": "<font color='red'>*<\/font>费率金额",
         "x": "0",
         "width": "240",
         "y": "48",
         "labelWidth": "90",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "number"
       },
       {
        "configs": {
         "itemId": "DISCOUNT",
         "labelAlign": "right",
         "fieldLabel": "折扣",
         "x": "248",
         "width": "240",
         "y": "48",
         "labelWidth": "90",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "number"
       },
       {
        "configs": {
         "itemId": "VOL_PRICE",
         "labelAlign": "right",
         "fieldLabel": "体积吨金额",
         "x": "0",
         "width": "240",
         "y": "80",
         "labelWidth": "90",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "number"
       },
       {
        "configs": {
         "itemId": "FLAT_RATE",
         "labelAlign": "right",
         "pickList": "[[0,'否'], [1,'是']]",
         "fieldLabel": "是否统一费率",
         "x": "0",
         "width": "240",
         "y": "112",
         "labelWidth": "90",
         "height": "24"
        },
        "expanded": false,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "MIN_AMOUNT",
         "labelAlign": "right",
         "fieldLabel": "吨/车",
         "x": "248",
         "width": "240",
         "y": "80",
         "labelWidth": "90",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "number"
       },
       {
        "configs": {
         "itemId": "MAX_AMOUNT",
         "labelAlign": "right",
         "fieldLabel": "元/车",
         "x": "496",
         "width": "240",
         "y": "80",
         "labelWidth": "90",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "number"
       },
       {
        "configs": {
         "itemId": "IS_VACATION",
         "labelAlign": "right",
         "pickList": "[[0,'否'], [1,'是']]",
         "fieldLabel": "是否假期计费",
         "x": "248",
         "width": "240",
         "y": "112",
         "labelWidth": "90",
         "valueField": "0",
         "height": "24"
        },
        "expanded": false,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "IS_NIGHTSHIFT",
         "labelAlign": "right",
         "pickList": "[[0,'否'], [1,'是']]",
         "fieldLabel": "是否夜班计费",
         "x": "496",
         "width": "240",
         "y": "112",
         "labelWidth": "90",
         "height": "24"
        },
        "expanded": false,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "IS_WEEKDAY",
         "labelAlign": "right",
         "pickList": "[[0,'否'], [1,'是']]",
         "fieldLabel": "是否周末计费",
         "x": "496",
         "width": "240",
         "y": "144",
         "labelWidth": "90",
         "height": "24"
        },
        "expanded": false,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "IS_TIMES",
         "labelAlign": "right",
         "pickList": "[[0,'否'], [1,'是']]",
         "fieldLabel": "是否按时间段计费",
         "x": "0",
         "width": "240",
         "y": "144",
         "labelWidth": "90",
         "height": "32"
        },
        "expanded": false,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "START_FIELD",
         "labelAlign": "right",
         "fieldLabel": "优惠起始",
         "width": "240",
         "x": "0",
         "y": "184",
         "labelWidth": "90",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "END_FIELD",
         "labelAlign": "right",
         "fieldLabel": "优惠截止",
         "width": "240",
         "x": "248",
         "y": "184",
         "labelWidth": "90",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "TIME_UNIT",
         "labelAlign": "right",
         "pickList": "[[1,'分钟'], [2,'小时'], [3,'天']]",
         "fieldLabel": "时间段计费单位",
         "x": "248",
         "width": "240",
         "y": "144",
         "labelWidth": "90",
         "height": "32"
        },
        "expanded": false,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "NOTES",
         "labelAlign": "right",
         "fieldLabel": "备注",
         "x": "248",
         "width": "488",
         "y": "248",
         "labelWidth": "90",
         "height": "30"
        },
        "expanded": false,
        "children": [],
        "type": "textarea"
       },
       {
        "configs": {
         "itemId": "CONTRACT_ID",
         "hidden": "true",
         "labelAlign": "right",
         "x": "8",
         "width": "240",
         "y": "-16",
         "labelWidth": "90",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "selectOnTab": "true",
         "isUpperCase": "true",
         "labelWidth": "90",
         "valueField": "ID",
         "queryDelay": "500",
         "hideTrigger": "true",
         "itemId": "CUSTOMERS",
         "labelAlign": "right",
         "fieldLabel": "选择货主",
         "width": "418",
         "x": "0",
         "displayField": "CNAME",
         "y": "216"
        },
        "expanded": true,
        "children": [{
         "configs": {
          "itemId": "store",
          "autoLoad": "true",
          "url": "m?xwl=system/common/client/clientSelect"
         },
         "expanded": false,
         "children": [],
         "type": "store"
        }],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "ruleBtn",
         "x": "648",
         "width": "88",
         "y": "16",
         "text": "新建费率条件",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "button",
        "events": {"click": "Wb.reset(app.ruleWin);\
app.ruleWin.setTitle('添加 - 费率条件');\
app.ruleWin.setIconCls('record_add_icon');\
app.ruleWin.show();\
app.ITEM_ID.setValue(app.hidTreeID.getValue());\
app.IS_SHOW.setValue(1);\
app.feeRitemGrid.store.removeAll();\
app.isEdit = false; //标识是否为添加或修改状态，在editWin的ok事件中用到此属性\
/*\
var filterId = Wb.getVal(app.customWin, 'FILTER_ID');\
if(filterId === \"\"){\
  return;\
}\
\
var filterName = Wb.getVal(app.customWin, 'FILTER_NAME');\
Wb.setVal(app.ruleWin, 'DESCRIPTION', filterName);\
*/\
"}
       },
       {
        "configs": {
         "itemId": "CURRENCY",
         "labelAlign": "right",
         "fieldLabel": "币种",
         "x": "0",
         "width": "240",
         "y": "248",
         "displayField": "CNAME",
         "labelWidth": "90",
         "valueField": "ID",
         "queryDelay": "500",
         "height": "22"
        },
        "expanded": true,
        "children": [{
         "configs": {
          "itemId": "store",
          "autoLoad": "true",
          "params": "{fldId:'C_CURRENCY'}",
          "url": "m?xwl=system/common/codeSelect"
         },
         "expanded": false,
         "children": [],
         "type": "store"
        }],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "SORT",
         "labelAlign": "right",
         "fieldLabel": "费率优先级",
         "x": "496",
         "width": "240",
         "y": "216",
         "labelWidth": "90",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "number"
       }
      ],
      "type": "panel"
     },
     {
      "configs": {
       "layout": "fit",
       "itemId": "panel11",
       "weight": "824",
       "region": "south",
       "title": "阶梯费率",
       "height": "200"
      },
      "expanded": false,
      "children": [{
       "configs": {
        "itemId": "multistepGrid",
        "editable": "true",
        "pagingBar": "false"
       },
       "expanded": true,
       "children": [
        {
         "configs": {
          "itemId": "store",
          "remoteSort": "true",
          "autoLoad": "true",
          "url": "m?xwl=feeManage/tariff/java/findMultistep"
         },
         "expanded": false,
         "children": [],
         "type": "store"
        },
        {
         "configs": {"itemId": "columns"},
         "expanded": true,
         "children": [
          {
           "configs": {
            "itemId": "multi_ID",
            "hidden": "true",
            "dataIndex": "ID",
            "width": "100"
           },
           "expanded": true,
           "children": [],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "numCol",
            "xtype": "rownumberer"
           },
           "expanded": false,
           "children": [],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "START_VAL",
            "dataIndex": "START_VAL",
            "width": "100",
            "text": "起始值"
           },
           "expanded": true,
           "children": [{
            "configs": {"itemId": "editor"},
            "expanded": false,
            "children": [],
            "type": "number"
           }],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "END_VAL",
            "dataIndex": "END_VAL",
            "width": "80",
            "text": "截止值"
           },
           "expanded": true,
           "children": [{
            "configs": {"itemId": "editor"},
            "expanded": false,
            "children": [],
            "type": "number"
           }],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "STEP_RATE",
            "dataIndex": "STEP_RATE",
            "width": "100",
            "text": "阶梯费率（元）"
           },
           "expanded": true,
           "children": [{
            "configs": {"itemId": "editor"},
            "expanded": false,
            "children": [],
            "type": "number"
           }],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "DISCOUNT",
            "dataIndex": "DISCOUNT",
            "width": "100",
            "text": "折扣（%）"
           },
           "expanded": true,
           "children": [{
            "configs": {"itemId": "editor"},
            "expanded": false,
            "children": [],
            "type": "number"
           }],
           "type": "column"
          }
         ],
         "type": "array"
        },
        {
         "configs": {
          "itemId": "tbar",
          "x": "8",
          "width": "400",
          "y": "8",
          "height": "28"
         },
         "expanded": true,
         "children": [
          {
           "configs": {
            "itemId": "addRecord",
            "text": "新增",
            "iconCls": "record_add_icon",
            "height": "22"
           },
           "expanded": false,
           "children": [],
           "type": "button",
           "events": {"click": "Wb.add(app.multistepGrid,{},'last',1,false);\
"}
          },
          {
           "configs": {
            "itemId": "delRecord",
            "text": "删除",
            "iconCls": "record_delete_icon",
            "height": "22"
           },
           "expanded": false,
           "children": [],
           "type": "button",
           "events": {"click": "// var rec = app.feeRitemGrid.getSelection()[0];\
// if (!rec) {\
//   Wb.warn('请选择 1 条需要删除的记录');\
//   return;\
// }\
\
Wb.remove(app.multistepGrid);\
\
\
\
"}
          }
         ],
         "type": "toolbar"
        }
       ],
       "type": "grid"
      }],
      "type": "panel"
     }
    ],
    "type": "window",
    "events": {"ok": "\
if(Wb.isEmpty(app.FILTER_ID.getValue())){\
  alert(\"费率条件不允许为空！\");\
  return;\
}\
app.CONTRACT_ID.setValue(app.hidContract.getValue());\
var values = Wb.getValue([app.customWin, app.hidTreeID]);\
values = Wb.applyIf(values, Wb.getModified(app.multistepGrid));//追加从表数据\
\
var cid = Wb.getVal(app.customWin, \"ID\");\
var url = \"\";\
if(cid === \"\"){\
  url = \"m?xwl=feeManage/tariff/java/insert\";\
}else{\
  url = \"m?xwl=feeManage/tariff/java/update\";\
}\
\
Wb.request({\
  url: url,\
  params: values,\
  success: function(resp) {\
    app.grid1.store.load({\
      params:{\
             CONTRACT_ID : app.hidContract.getValue(),\
             DESCRIPTION : app.txtName.getValue(),\
             CHARGING_ID : app.hidTreeID.getValue(),\
             CUSTOMERS   : app.comb_customer.getValue()\
      }     \
\t});\
    app.customWin.hide();\
  }\
});"}
   },
   {
    "configs": {
     "layout": "absolute",
     "itemId": "editClassWin",
     "dialog": "true",
     "closeAction": "hide",
     "width": "384",
     "title": "编辑合同费类",
     "height": "368"
    },
    "expanded": false,
    "children": [
     {
      "configs": {
       "itemId": "ID",
       "hidden": "true",
       "x": "8",
       "width": "240",
       "y": "8",
       "height": "22"
      },
      "expanded": false,
      "children": [],
      "type": "text"
     },
     {
      "configs": {
       "itemId": "CATEGORY_ID",
       "fieldLabel": "费类名称",
       "x": "24",
       "width": "240",
       "keyName": "C_BASE_CATEGORY",
       "y": "8",
       "displayField": "CNAME",
       "labelWidth": "60",
       "disabled": "true",
       "valueField": "ID",
       "queryDelay": "500",
       "height": "22"
      },
      "expanded": false,
      "children": [{
       "configs": {
        "itemId": "store",
        "autoLoad": "true",
        "params": "{fldId:'C_BASE_CATEGORY'}",
        "url": "m?xwl=system/common/codeSelect"
       },
       "expanded": false,
       "children": [],
       "type": "store"
      }],
      "type": "combo"
     },
     {
      "configs": {
       "itemId": "IS_ALL",
       "pickList": "[[0,'不包干'],[1,'包干']]",
       "fieldLabel": "是否包干",
       "x": "24",
       "width": "240",
       "y": "40",
       "labelWidth": "60",
       "height": "22"
      },
      "expanded": false,
      "children": [],
      "type": "combo"
     },
     {
      "configs": {
       "itemId": "NOTES",
       "fieldLabel": "描述",
       "x": "24",
       "width": "312",
       "y": "216",
       "labelWidth": "60",
       "height": "88"
      },
      "expanded": false,
      "children": [],
      "type": "textarea"
     },
     {
      "configs": {
       "itemId": "EFFECTIVED",
       "pickList": "[[0,'草稿'],[1,'已生效'],[2,'已迁出'],[3,'已禁用'],[4,'历史版本']]",
       "fieldLabel": "规则状态",
       "x": "24",
       "width": "240",
       "y": "72",
       "labelWidth": "60",
       "height": "22"
      },
      "expanded": false,
      "children": [],
      "type": "combo"
     },
     {
      "configs": {
       "itemId": "BIZ_SCOPE",
       "fieldLabel": "业务范围",
       "x": "24",
       "width": "312",
       "y": "136",
       "labelWidth": "60",
       "height": "74"
      },
      "expanded": false,
      "children": [],
      "type": "textarea"
     },
     {
      "configs": {
       "itemId": "BYAGENT",
       "pickList": "[[0,'货主'],[1,'船公司']]",
       "fieldLabel": "付费方",
       "x": "24",
       "width": "240",
       "y": "104",
       "labelWidth": "60",
       "height": "22"
      },
      "expanded": false,
      "children": [],
      "type": "combo"
     }
    ],
    "type": "window",
    "events": {"ok": "var values = Wb.getValue([app.editClassWin]);\
var url = \"m?xwl=feeManage/contract/category/java/updateContCate\";\
Wb.request({\
  url: url,\
  params: values,\
  success: function(resp) {\
    app.feeClassGrid.store.load({\
\t\tparams : {\
            CONTRACT_ID : app.hidContract.getValue()\
           }\
\t});\
    app.editClassWin.hide();\
  }\
});"}
   },
   {
    "configs": {
     "layout": "absolute",
     "itemId": "editItemWin",
     "dialog": "true",
     "closeAction": "hide",
     "width": "560",
     "title": "编辑合同费目",
     "height": "512"
    },
    "expanded": false,
    "children": [
     {
      "configs": {
       "itemId": "ID",
       "hidden": "true",
       "x": "8",
       "width": "240",
       "y": "-8",
       "height": "22"
      },
      "expanded": false,
      "children": [],
      "type": "text"
     },
     {
      "configs": {
       "keyName": "C_BASE_CATEGORY",
       "labelWidth": "100",
       "valueField": "ID",
       "queryDelay": "500",
       "itemId": "ITEM_ID",
       "labelAlign": "right",
       "fieldLabel": "<font color='red'>*<\/font>费目名称",
       "x": "16",
       "width": "240",
       "y": "24",
       "displayField": "CNAME",
       "disabled": "true",
       "height": "22"
      },
      "expanded": false,
      "children": [{
       "configs": {
        "itemId": "store",
        "autoLoad": "true",
        "params": "{fldId:'C_BASE_CHARGING_ITEM'}",
        "url": "m?xwl=system/common/codeSelect"
       },
       "expanded": false,
       "children": [],
       "type": "store"
      }],
      "type": "combo"
     },
     {
      "configs": {
       "itemId": "NOTES",
       "labelAlign": "right",
       "fieldLabel": "备注",
       "x": "56",
       "width": "448",
       "y": "408",
       "labelWidth": "60",
       "height": "50"
      },
      "expanded": false,
      "children": [],
      "type": "textarea"
     },
     {
      "configs": {
       "itemId": "INVOICE_TYPE",
       "labelAlign": "right",
       "fieldLabel": "<font color='red'>*<\/font>发票类型",
       "x": "282",
       "width": "224",
       "y": "24",
       "displayField": "CNAME",
       "labelWidth": "80",
       "valueField": "ID",
       "queryDelay": "500",
       "height": "24"
      },
      "expanded": false,
      "children": [{
       "configs": {
        "itemId": "store",
        "autoLoad": "true",
        "params": "{fldId:'C_BASE_INVOICE'}",
        "url": "m?xwl=system/common/codeSelect"
       },
       "expanded": false,
       "children": [],
       "type": "store"
      }],
      "type": "combo"
     },
     {
      "configs": {
       "itemId": "RATE_TYPE",
       "labelAlign": "right",
       "pickList": "[\
  [\
    0, '普通'\
  ],\
  [\
    1, '分段'\
  ]\
]",
       "fieldLabel": "费率类型",
       "x": "264",
       "width": "240",
       "y": "216",
       "height": "22"
      },
      "expanded": false,
      "children": [],
      "type": "combo"
     },
     {
      "configs": {
       "itemId": "MIN_AMOUNT",
       "labelAlign": "right",
       "fieldLabel": "最小金额",
       "x": "16",
       "width": "240",
       "y": "152",
       "height": "22"
      },
      "expanded": false,
      "children": [],
      "type": "number"
     },
     {
      "configs": {
       "itemId": "MAX_AMOUNT",
       "labelAlign": "right",
       "fieldLabel": "最大金额",
       "x": "264",
       "width": "241",
       "y": "152",
       "height": "22"
      },
      "expanded": false,
      "children": [],
      "type": "number"
     },
     {
      "configs": {
       "itemId": "IS_FORMAT",
       "labelAlign": "right",
       "pickList": "[\
  [\
    0, '进整'\
  ],\
  [\
    1, '四舍五入'\
  ],\
  [\
    2, '去小数'\
  ]\
]",
       "fieldLabel": "计费吨取整",
       "x": "16",
       "width": "240",
       "y": "216",
       "height": "22"
      },
      "expanded": false,
      "children": [],
      "type": "combo"
     },
     {
      "configs": {
       "itemId": "LIFE_STATUS",
       "labelAlign": "right",
       "pickList": "[\
  [\
    0, '不启用'\
  ],\
  [\
    1, '启用'\
  ]\
]",
       "fieldLabel": "启用状态",
       "x": "264",
       "width": "241",
       "y": "88",
       "height": "22"
      },
      "expanded": false,
      "children": [],
      "type": "combo"
     },
     {
      "configs": {
       "itemId": "UNIT",
       "labelAlign": "right",
       "fieldLabel": "<font color='red'>*<\/font>计价单位",
       "x": "264",
       "width": "240",
       "keyName": "FEE_UNIT",
       "y": "56",
       "height": "22"
      },
      "expanded": false,
      "children": [],
      "type": "combo"
     },
     {
      "configs": {
       "itemId": "IS_AUTOCALC",
       "labelAlign": "right",
       "pickList": "[\
  [\
    0, '自动'\
  ],\
  [\
    1, '手动'\
  ]\
]",
       "fieldLabel": "自动计算",
       "x": "16",
       "width": "241",
       "y": "120",
       "height": "22"
      },
      "expanded": false,
      "children": [],
      "type": "combo"
     },
     {
      "configs": {
       "itemId": "FORMAT_UNIT",
       "labelAlign": "right",
       "pickList": "[\
  [\
    0, '分'\
  ],\
  [\
    1, '角'\
  ],\
  [\
    1, '元'\
  ],\
  [\
    1, '十元'\
  ]\
]",
       "fieldLabel": "取整单位",
       "x": "264",
       "width": "241",
       "y": "184",
       "height": "22"
      },
      "expanded": false,
      "children": [],
      "type": "combo"
     },
     {
      "configs": {
       "itemId": "CURRENCY",
       "labelAlign": "right",
       "fieldLabel": "币种",
       "x": "264",
       "width": "240",
       "y": "312",
       "displayField": "CNAME",
       "valueField": "ID",
       "queryDelay": "500",
       "height": "22"
      },
      "expanded": false,
      "children": [{
       "configs": {
        "itemId": "store",
        "autoLoad": "true",
        "params": "{fldId:'C_CURRENCY'}",
        "url": "m?xwl=system/common/codeSelect"
       },
       "expanded": false,
       "children": [],
       "type": "store"
      }],
      "type": "combo"
     },
     {
      "configs": {
       "itemId": "FLAT_RATE",
       "labelAlign": "right",
       "pickList": "[\
  [\
    0, '否'\
  ],\
  [\
    1, '是'\
  ]\
]",
       "fieldLabel": "固定费率",
       "x": "264",
       "width": "240",
       "y": "120",
       "height": "22"
      },
      "expanded": false,
      "children": [],
      "type": "combo"
     },
     {
      "configs": {
       "itemId": "ENABLED",
       "labelAlign": "right",
       "pickList": "[\
  [\
    0, '否'\
  ],\
  [\
    1, '是'\
  ]\
]",
       "fieldLabel": "是否参考价",
       "x": "264",
       "width": "241",
       "y": "344",
       "height": "22"
      },
      "expanded": false,
      "children": [],
      "type": "combo"
     },
     {
      "configs": {
       "itemId": "ACCOUNT_TYPE",
       "labelAlign": "right",
       "pickList": "[\
  [\
    1, '现金'\
  ],\
  [\
    2, '月结'\
  ],\
  [\
    3, '托收单'\
  ]\
]",
       "fieldLabel": "结算方式",
       "x": "16",
       "width": "240",
       "y": "344",
       "height": "22"
      },
      "expanded": false,
      "children": [],
      "type": "combo"
     },
     {
      "configs": {
       "itemId": "AMOUNT_FORMAT",
       "labelAlign": "right",
       "pickList": "[\
  [\
    0, '进整'\
  ],\
  [\
    1, '四舍五入'\
  ],\
  [\
    2, '去小数'\
  ]\
]",
       "fieldLabel": "金额取整",
       "x": "16",
       "width": "241",
       "y": "184",
       "height": "22"
      },
      "expanded": false,
      "children": [],
      "type": "combo"
     },
     {
      "configs": {
       "itemId": "BYAGENT",
       "labelAlign": "right",
       "pickList": "[[0,'货主'],[1,'船公司']]",
       "fieldLabel": "<font color='red'>*<\/font>付费方",
       "x": "56",
       "width": "200",
       "y": "88",
       "labelWidth": "60",
       "height": "22"
      },
      "expanded": false,
      "children": [],
      "type": "combo"
     },
     {
      "configs": {
       "itemId": "BYDAY",
       "labelAlign": "right",
       "pickList": "[\
  [\
    0, '否'\
  ],\
  [\
    1, '是'\
  ]\
]",
       "fieldLabel": "按天数计算",
       "x": "264",
       "width": "241",
       "y": "280",
       "height": "22"
      },
      "expanded": false,
      "children": [],
      "type": "combo"
     },
     {
      "configs": {
       "itemId": "BYTON",
       "labelAlign": "right",
       "pickList": "[\
  [0, '计费吨'],\
  [1, '重量吨'],\
  [2, '体积吨']\
]",
       "fieldLabel": "择大计收",
       "x": "16",
       "width": "240",
       "y": "248",
       "height": "22"
      },
      "expanded": false,
      "children": [],
      "type": "combo"
     },
     {
      "configs": {
       "itemId": "TONS_STERE",
       "labelAlign": "right",
       "fieldLabel": "体积吨换算率",
       "x": "264",
       "width": "241",
       "y": "248",
       "height": "22"
      },
      "expanded": false,
      "children": [],
      "type": "number"
     },
     {
      "configs": {
       "itemId": "DERATE_TYPE",
       "labelAlign": "right",
       "pickList": "  [   [     0, '前免'   ],   [     1, '后免'   ] ]",
       "fieldLabel": "堆存减免类型",
       "x": "16",
       "width": "240",
       "y": "280",
       "height": "22"
      },
      "expanded": false,
      "children": [],
      "type": "combo"
     },
     {
      "configs": {
       "itemId": "DERATE_DAY",
       "labelAlign": "right",
       "fieldLabel": "堆存减免天",
       "x": "16",
       "width": "241",
       "y": "312",
       "height": "22"
      },
      "expanded": false,
      "children": [],
      "type": "number"
     },
     {
      "configs": {
       "itemId": "CATEGORY_ID",
       "labelAlign": "right",
       "fieldLabel": "<font color='red'>*<\/font>所属费类",
       "x": "16",
       "width": "241",
       "y": "56",
       "displayField": "CNAME",
       "valueField": "ID",
       "queryDelay": "500",
       "height": "22"
      },
      "expanded": false,
      "children": [{
       "configs": {
        "itemId": "store",
        "autoLoad": "true",
        "params": "{fldId:'C_BASE_CATEGORY'}",
        "url": "m?xwl=system/common/codeSelect"
       },
       "expanded": false,
       "children": [],
       "type": "store"
      }],
      "type": "combo"
     },
     {
      "configs": {
       "itemId": "MIN_TON",
       "labelAlign": "right",
       "fieldLabel": "最小计费吨",
       "x": "16",
       "width": "241",
       "y": "376",
       "height": "22"
      },
      "expanded": false,
      "children": [],
      "type": "number"
     }
    ],
    "type": "window",
    "events": {"ok": "\
var values = Wb.getValue([app.editItemWin]);\
var url = \"m?xwl=feeManage/contract/item/java/updateContItem\";\
Wb.request({\
  url: url,\
  params: values,\
  success: function(resp) {\
    app.feeItemGrid.store.load({\
\t\tparams : {\
            CONTRACT_ID : app.hidContract.getValue(),\
            CATEGORY_ID : app.hidTreeID.getValue()\
           }\
\t});\
    app.editItemWin.hide();\
  }\
});"}
   },
   {
    "configs": {
     "layout": "absolute",
     "itemId": "ruleWin",
     "dialog": "true",
     "closeAction": "hide",
     "width": "464",
     "title": "新增费率规则",
     "height": "496"
    },
    "expanded": false,
    "children": [
     {
      "configs": {
       "layout": "absolute",
       "itemId": "win_panel",
       "width": "376",
       "x": "8",
       "weight": "344",
       "y": "8",
       "height": "300",
       "frame": "true"
      },
      "expanded": true,
      "children": [
       {
        "configs": {
         "itemId": "DESCRIPTION",
         "fieldLabel": "条件名称",
         "x": "24",
         "width": "280",
         "y": "8",
         "labelWidth": "60",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       },
       {
        "configs": {
         "itemId": "NOTES",
         "fieldLabel": "备注",
         "x": "24",
         "width": "312",
         "y": "104",
         "labelWidth": "60",
         "height": "83"
        },
        "expanded": false,
        "children": [],
        "type": "textarea"
       },
       {
        "configs": {
         "itemId": "ITEM_ID",
         "fieldLabel": "选择费目",
         "x": "24",
         "width": "240",
         "y": "40",
         "displayField": "CNAME",
         "labelWidth": "60",
         "valueField": "ID",
         "queryDelay": "500",
         "height": "22"
        },
        "expanded": true,
        "children": [{
         "configs": {
          "itemId": "store",
          "autoLoad": "true",
          "params": "{fldId:'C_BASE_CHARGING_ITEM'}",
          "url": "m?xwl=system/common/codeSelect"
         },
         "expanded": false,
         "children": [],
         "type": "store"
        }],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "IS_SHOW",
         "pickList": "[[0, '不显示'],[1, '显示']]",
         "fieldLabel": "是否显示",
         "x": "24",
         "width": "240",
         "y": "72",
         "labelWidth": "60",
         "height": "22"
        },
        "expanded": false,
        "children": [],
        "type": "combo"
       }
      ],
      "type": "panel"
     },
     {
      "configs": {
       "layout": "fit",
       "itemId": "panel2",
       "width": "480",
       "x": "8",
       "y": "208",
       "height": "224"
      },
      "expanded": true,
      "children": [{
       "configs": {
        "itemId": "feeRitemGrid",
        "editable": "true",
        "pagingBar": "false",
        "multiSelect": "true"
       },
       "expanded": true,
       "children": [
        {
         "configs": {
          "itemId": "store",
          "remoteSort": "true",
          "autoLoad": "true",
          "url": "m?xwl=feeManage/rule/java/queryItemByRule"
         },
         "expanded": false,
         "children": [],
         "type": "store",
         "events": {"load": "//Wb.bindChange(app.grid1, app.setModified);"}
        },
        {
         "configs": {"itemId": "columns"},
         "expanded": false,
         "children": [
          {
           "configs": {
            "itemId": "numCol",
            "xtype": "rownumberer"
           },
           "expanded": false,
           "children": [],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "KEY_NAME",
            "dataIndex": "KEY_NAME",
            "width": "100",
            "keyName": "C_BASE_DICT",
            "text": "约束条件"
           },
           "expanded": true,
           "children": [{
            "configs": {
             "itemId": "editor",
             "editable": "false",
             "displayField": "CNAME",
             "valueField": "ID",
             "queryDelay": "500"
            },
            "expanded": true,
            "children": [{
             "configs": {
              "itemId": "store",
              "autoLoad": "true",
              "params": "{fldId:'C_BASE_DICT'}",
              "url": "m?xwl=system/common/codeSelect"
             },
             "expanded": false,
             "children": [],
             "type": "store"
            }],
            "type": "combo",
            "events": {"select": "\
var rec = app.feeRitemGrid.getSelection()[0];\
rec.set('COMNAME1',records[0].data.COMNAME1);"}
           }],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "OPER_CHAR",
            "dataIndex": "OPER_CHAR",
            "width": "80",
            "keyName": "compareCode",
            "text": "运算符"
           },
           "expanded": true,
           "children": [{
            "configs": {
             "itemId": "editor",
             "displayField": "CNAME",
             "valueField": "ID",
             "queryDelay": "500"
            },
            "expanded": true,
            "children": [{
             "configs": {
              "itemId": "store",
              "autoLoad": "true",
              "params": "{fldId:'compareCode'}",
              "url": "m?xwl=system/common/codeSelect"
             },
             "expanded": false,
             "children": [],
             "type": "store"
            }],
            "type": "combo"
           }],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "COMPARE_VAL",
            "dataIndex": "COMPARE_VAL",
            "width": "100",
            "text": "比较键"
           },
           "expanded": true,
           "children": [{
            "configs": {
             "itemId": "editor",
             "editable": "true",
             "displayField": "V",
             "valueField": "K",
             "multiSelect": "true"
            },
            "expanded": true,
            "children": [{
             "configs": {
              "itemId": "store",
              "autoLoad": "true",
              "url": "m?xwl=feeManage/calc/selectCod"
             },
             "expanded": false,
             "children": [],
             "type": "store",
             "events": {"beforeload": "operation.params = {\
  fldId: app.getColName(),\
  query: operation.params.query\
};\
"}
            }],
            "type": "combo",
            "events": {"select": "\
/*var rec = app.feeRitemGrid.getSelection()[0];\
rec.set('COMPARE_NAME',combo.getRawValue());\
\
var sc = app.feeRitemGrid.store;\
var remark = \"\";\
for(var  i=0; i<sc.getCount(); i++){\
  var val = sc.getAt(i).get(\"COMPARE_NAME\");\
  if(!Wb.isEmpty(val)){\
    remark += \"[\" + val + \"]\";\
  }\
}\
Wb.setVal(app.ruleWin, 'DESCRIPTION', remark);*/\
var rec = app.feeRitemGrid.getSelection()[0];\
rec.set('COMPARE_NAME',combo.getRawValue());\
\
var sc = app.feeRitemGrid.store;\
var arr = new Array();\
var remark = \"\";\
for(var  i=0; i<sc.getCount(); i++){\
  arr.push(parseInt(sc.getAt(i).get(\"COMNAME1\")));\
}\
arr.sort(function(a,b){return a-b;});\
for(var j = 0; j< arr.length; j++){\
  for(var  i=0; i<sc.getCount(); i++){\
    if(arr[j] == parseInt(sc.getAt(i).get(\"COMNAME1\"))){\
      var val = sc.getAt(i).get(\"COMPARE_NAME\");\
      var oper = sc.getAt(i).get(\"OPER_CHAR\");\
      if(oper == \"!=\"){\
        val = \"非\"+val;\
      }\
      if(!Wb.isEmpty(val)){\
        remark += \"[\" + val + \"]\";\
      }\
      break;\
    }\
  }\
}\
app.DESCRIPTION.setValue(remark);"}
           }],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "COMPARE_NAME",
            "dataIndex": "COMPARE_NAME",
            "width": "100",
            "text": "比较值"
           },
           "expanded": true,
           "children": [],
           "type": "column"
          },
          {
           "configs": {
            "itemId": "COMNAME1",
            "hidden": "true",
            "dataIndex": "COMNAME1",
            "width": "100",
            "text": "排序"
           },
           "expanded": true,
           "children": [],
           "type": "column"
          }
         ],
         "type": "array"
        },
        {
         "configs": {
          "itemId": "tbar",
          "x": "8",
          "width": "400",
          "y": "8",
          "height": "28"
         },
         "expanded": true,
         "children": [
          {
           "configs": {
            "itemId": "addRecord",
            "text": "新增",
            "iconCls": "record_add_icon",
            "height": "22"
           },
           "expanded": false,
           "children": [],
           "type": "button",
           "events": {"click": "var sc = app.feeRitemGrid.store;\
var arr = new Array();\
\
var remark = \"\";\
for(var  i=0; i<sc.getCount(); i++){\
  arr.push(parseInt(sc.getAt(i).get(\"COMNAME1\")));\
}\
arr.sort();\
for(var j = 0; j< arr.length; j++){\
  for(var  i=0; i<sc.getCount(); i++){\
    if(arr[j] == parseInt(sc.getAt(i).get(\"COMNAME1\"))){\
      var val = sc.getAt(i).get(\"COMPARE_NAME\");\
      if(!Wb.isEmpty(val)){\
        remark += \"[\" + val + \"]\";\
      }\
      break;\
    }\
  }\
}\
app.DESCRIPTION.setValue(remark);\
Wb.add(app.feeRitemGrid,{OPER_CHAR:\"=\"},'last',1,false);\
"}
          },
          {
           "configs": {
            "itemId": "delRecord",
            "text": "删除",
            "iconCls": "record_delete_icon",
            "height": "22"
           },
           "expanded": false,
           "children": [],
           "type": "button",
           "events": {"click": "// var rec = app.feeRitemGrid.getSelection()[0];\
// if (!rec) {\
//   Wb.warn('请选择 1 条需要删除的记录');\
//   return;\
// }\
\
Wb.remove(app.feeRitemGrid);\
\
var sc = app.feeRitemGrid.store;\
var arr = new Array();\
\
var remark = \"\";\
for(var  i=0; i<sc.getCount(); i++){\
  arr.push(parseInt(sc.getAt(i).get(\"COMNAME1\")));\
}\
arr.sort();\
for(var j = 0; j< arr.length; j++){\
  for(var  i=0; i<sc.getCount(); i++){\
    if(arr[j] == parseInt(sc.getAt(i).get(\"COMNAME1\"))){\
      var val = sc.getAt(i).get(\"COMPARE_NAME\");\
      if(!Wb.isEmpty(val)){\
        remark += \"[\" + val + \"]\";\
      }\
      break;\
    }\
  }\
}\
app.DESCRIPTION.setValue(remark);\
\
\
"}
          }
         ],
         "type": "toolbar"
        }
       ],
       "type": "grid"
      }],
      "type": "panel"
     }
    ],
    "type": "window",
    "events": {"ok": "\
var values = Wb.getValue(app.win_panel);//主表数据\
//console.info(app.feeRitemGrid);\
values = Wb.applyIf(values,{data:Wb.getModified(app.feeRitemGrid)});//追加从表数据\
var url = \"m?xwl=feeManage/rule/java/insert\";\
Wb.request({\
  url: url,\
  params: values,\
  success: function(resp) {\
    Wb.info(\"保存成功\");\
    app.FILTER_NAME.pickComp.store.load();\
    app.ruleWin.hide();\
  }\
});"}
   },
   {
    "configs": {
     "layout": "fit",
     "itemId": "filterWin",
     "width": "700",
     "bodyPadding": "2 10 10 10",
     "title": "多条件",
     "height": "400"
    },
    "expanded": false,
    "children": [{
     "configs": {
      "layout": "absolute",
      "itemId": "panel1",
      "width": "650",
      "autoScroll": "true",
      "height": "324",
      "frame": "true"
     },
     "expanded": true,
     "children": [
      {
       "configs": {
        "layout": "fit",
        "itemId": "center-center-west",
        "split": "true",
        "width": "300",
        "x": "5",
        "y": "8",
        "region": "west",
        "height": "300"
       },
       "expanded": true,
       "children": [{
        "configs": {
         "itemId": "gridAll",
         "selType": "checkboxmodel",
         "editable": "true",
         "pagingBar": "false",
         "tbar": "app.tbarAll",
         "region": "center"
        },
        "expanded": true,
        "children": [
         {
          "configs": {
           "itemId": "store",
           "autoLoad": "true",
           "pageSize": "30",
           "url": "m?xwl=feeManage/calc/selectLeftCod"
          },
          "expanded": false,
          "children": [],
          "type": "store"
         },
         {
          "configs": {"itemId": "columns"},
          "expanded": true,
          "children": [
           {
            "configs": {
             "itemId": "id",
             "hidden": "true",
             "dataIndex": "ID"
            },
            "expanded": false,
            "children": [],
            "type": "column"
           },
           {
            "configs": {
             "itemId": "colCYZH",
             "dataIndex": "V",
             "width": "220",
             "text": "名称"
            },
            "expanded": false,
            "children": [],
            "type": "column"
           }
          ],
          "type": "array"
         },
         {
          "configs": {"itemId": "tbar"},
          "expanded": true,
          "children": [
           {
            "configs": {
             "itemId": "queryName",
             "emptyText": "过滤条件",
             "width": "100"
            },
            "expanded": false,
            "children": [],
            "type": "text"
           },
           {
            "configs": {
             "itemId": "queryBtn",
             "text": "查询"
            },
            "expanded": false,
            "children": [],
            "type": "button",
            "events": {"click": "app.gridAll.store.load({params:{fldId:app.filterWin.fldId,query:app.queryName.getValue()}});"}
           }
          ],
          "type": "toolbar"
         }
        ],
        "type": "grid",
        "events": {"itemdblclick": "var sid = app.combo1.getValue();\
if (Wb.isEmpty(sid)) {\
  Wb.warn('请选择一艘船舶！');\
  return;\
}\
\
Wb.request({\
  url: 'm?xwl=shipManage/gaship/crewAboard/insertAboardCrew',\
  params: {\
    C_V_ID: sid,\
    C_C_ID: record.data.ID,\
    DUTY: record.data.DUTY\
  },\
  success: function(resp) {\
    app.gridAboard.store.load({\
      params: {\
        sId: sid,\
        name: ''\
      }\
    });\
    app.gridAll.store.load({\
      params: {\
        sId: sid,\
        name: ''\
      }\
    });\
  }\
});"}
       }],
       "type": "panel"
      },
      {
       "configs": {
        "layout": "fit",
        "itemId": "center-center-east",
        "split": "true",
        "width": "300",
        "x": "337",
        "y": "8",
        "region": "east",
        "height": "300"
       },
       "expanded": true,
       "children": [{
        "configs": {
         "tagConfigs": "{   columnWidth: 1 / 2 }",
         "itemId": "gridAboard",
         "selType": "checkboxmodel",
         "editable": "true",
         "pagingBar": "false",
         "tbar": "app.tbarAboard",
         "region": "center"
        },
        "expanded": true,
        "children": [
         {
          "configs": {
           "itemId": "store",
           "autoLoad": "true",
           "pageSize": "30",
           "url": "m?xwl=feeManage/calc/selectRightCod"
          },
          "expanded": false,
          "children": [],
          "type": "store"
         },
         {
          "configs": {"itemId": "columns"},
          "expanded": true,
          "children": [
           {
            "configs": {
             "itemId": "id",
             "hidden": "true",
             "dataIndex": "ID",
             "text": "船舶职员记录id"
            },
            "expanded": false,
            "children": [],
            "type": "column"
           },
           {
            "configs": {
             "itemId": "name",
             "dataIndex": "V",
             "width": "220",
             "text": "名称"
            },
            "expanded": false,
            "children": [],
            "type": "column"
           }
          ],
          "type": "array"
         }
        ],
        "type": "grid",
        "events": {"itemdblclick": "var sid = app.combo1.getValue();\
Wb.request({\
  url: 'm?xwl=shipManage/gaship/crewAboard/updateAboardCrewOut',\
  params: {\
    ID: record.data.ID\
  },\
  success: function(resp) {\
    app.gridAboard.store.load({\
      params: {\
        sId: sid,\
        name: ''\
      }\
    });\
    app.gridAll.store.load({\
      params: {\
        sId: sid,\
        name: ''\
      }\
    });\
  }\
});"}
       }],
       "type": "panel"
      },
      {
       "configs": {
        "layout": "absolute",
        "itemId": "center-center-center",
        "width": "50",
        "x": "293",
        "y": "8",
        "region": "center",
        "height": "300"
       },
       "expanded": true,
       "children": [
        {
         "configs": {
          "colspan": "2",
          "itemId": "in",
          "textAlign": "center",
          "width": "40",
          "x": "4",
          "y": "88",
          "text": ">>>",
          "height": "10"
         },
         "expanded": false,
         "children": [],
         "type": "button",
         "events": {"click": "var rec = app.gridAll.getSelection()[0];\
if (!rec) {\
  Wb.warn('请选择至少 1 条记录！');\
  return;\
}\
\
var records = app.gridAll.getSelection();\
\
Wb.each(records, function(rec) {\
  Wb.request({\
    url: 'm?xwl=feeManage/calc/updateItemRule',\
    params: {\
      ID: app.filterWin.ID,\
      type:'1',\
      cod:rec.get(\"K\"),\
      name:rec.get(\"V\")\
     \
    },\
    success: function(resp) {\
      app.gridAboard.store.load({\
        params: {\
          fldId: app.filterWin.fldId,\
         ID: app.filterWin.ID\
        }\
      });\
      app.gridAll.store.load({\
        params: {\
          fldId: app.filterWin.fldId,\
         ID: app.filterWin.ID\
        }\
      });\
    }\
  });\
});"}
        },
        {
         "configs": {
          "colspan": "2",
          "itemId": "out",
          "textAlign": "center",
          "width": "40",
          "x": "4",
          "y": "160",
          "text": "<<<",
          "height": "10"
         },
         "expanded": false,
         "children": [],
         "type": "button",
         "events": {"click": "var rec = app.gridAboard.getSelection()[0];\
if (!rec) {\
  Wb.warn('请选择至少 1 条记录！');\
  return;\
}\
\
var records = app.gridAboard.getSelection();\
\
Wb.each(records, function(rec) {\
  Wb.request({\
    url: 'm?xwl=feeManage/calc/updateItemRule',\
    params: {\
      ID: app.filterWin.ID,\
      type:'-1',\
      cod:rec.get(\"K\"),\
      name:rec.get(\"V\")\
     \
    },\
    success: function(resp) {\
      app.gridAboard.store.load({\
        params: {\
          fldId: app.filterWin.fldId,\
          ID: app.filterWin.ID\
        }\
      });\
      app.gridAll.store.load({\
        params: {\
          fldId: app.filterWin.fldId,\
         ID: app.filterWin.ID\
        }\
      });\
    }\
  });\
});"}
        }
       ],
       "type": "panel"
      }
     ],
     "type": "panel"
    }],
    "type": "window"
   },
   {
    "configs": {
     "layout": "border",
     "itemId": "viewport1"
    },
    "expanded": true,
    "children": [{
     "configs": {
      "layout": "border",
      "itemId": "panel1",
      "split": "true",
      "region": "center"
     },
     "expanded": true,
     "children": [
      {
       "configs": {
        "layout": "fit",
        "itemId": "tree_panel",
        "split": "true",
        "normalName": "合同树",
        "width": "200",
        "region": "west"
       },
       "expanded": true,
       "children": [{
        "configs": {
         "itemId": "tree1",
         "root": "{ID:'-1', text:'合同列表', LEVELS:1}"
        },
        "expanded": true,
        "children": [{
         "configs": {
          "itemId": "store",
          "url": "m?xwl=feeManage/tariff/java/tariffTree"
         },
         "expanded": false,
         "children": [],
         "type": "store",
         "events": {"beforeload": "\
var node = operation.node;\
\
//alert(node.isRoot());\
operation.params.parentId = node.isRoot() ? '-1' : node.data.ID;\
operation.params.level = node.isRoot() ? 1 : node.data.LEVELS;\
operation.params.contractId = node.data.CONTRACT_ID;\
operation.params.hidContractDESC = app.hidContractDESC.getValue();\
//console.info(Wb.getVal(app.hidContractDESC));\
// if(operation.params.level == 3){\
//   return false;\
// }"}
        }],
        "type": "tree",
        "events": {"itemclick": "\
var nodeId = record.data.ID === undefined?\"-1\": record.data.ID;\
var hidLevel = record.data.LEVELS === undefined?1:record.data.LEVELS;\
var hidContract = record.data.CONTRACT_ID;\
//app.grid1.store.load({params:{parentId:record.data.ID}});\
//alert(nodeId);\
// if(hidLevel != 3){\
//   app.hidTreeID.setValue(\"\");\
//   app.hidLevel.setValue(\"\");\
//   return;\
// }\
app.hidTreeID.setValue(nodeId);\
app.hidLevel.setValue(hidLevel);\
app.hidContract.setValue(hidContract);\
// //Wb.remove(app.ritem_grid);\
// app.ritem_grid.getStore().removeAll();\
// app.grid1.store.load({\
//   out: app.panel1\
// });\
//查询所有合同\
if(hidLevel == 1){\
  app.concatGrid.show();\
  app.feeClassGrid.hide();\
  app.item_panel.hide();\
  app.tariff_panel.hide();\
  app.concatGrid.store.load();\
}\
//查询合同下费类\
if(hidLevel == 2){\
  app.concatGrid.hide();\
  app.feeClassGrid.show();\
  app.item_panel.hide();\
  app.tariff_panel.hide();\
  app.feeClassGrid.store.load({params:{CONTRACT_ID:hidContract}});\
}\
//查询合同费类下费目\
if(hidLevel == 3){\
  app.itemDerateGrid.store.removeAll();\
  app.concatGrid.hide();\
  app.feeClassGrid.hide();\
  app.item_panel.show();\
  app.tariff_panel.hide();\
  app.feeItemGrid.store.load({params:{CONTRACT_ID:hidContract, CATEGORY_ID:nodeId}});\
}\
//查询合同费目下费率\
if(hidLevel == 4){\
  app.ritem_grid.store.removeAll();\
  app.multistepGrid2.store.removeAll();\
  app.concatGrid.hide();\
  app.feeClassGrid.hide();\
  app.item_panel.hide();\
  app.tariff_panel.show();\
  //app.pickComp.store.load({params:{itemId:nodeId}});\
  app.grid1.store.load({params:{CONTRACT_ID:hidContract,\
                                CHARGING_ID:nodeId, \
                                DESCRIPTION : app.txtName.getValue(),\
                                CUSTOMERS   : app.comb_customer.getValue()\
                               }});\
}\
"}
       }],
       "type": "panel"
      },
      {
       "configs": {
        "layout": "fit",
        "itemId": "right_panel",
        "split": "true",
        "region": "center",
        "height": "300"
       },
       "expanded": true,
       "children": [
        {
         "configs": {
          "itemId": "hidTreeID",
          "hidden": "true"
         },
         "expanded": false,
         "children": [],
         "type": "text"
        },
        {
         "configs": {
          "itemId": "hidLevel",
          "hidden": "true"
         },
         "expanded": false,
         "children": [],
         "type": "text"
        },
        {
         "configs": {
          "itemId": "hidContract",
          "hidden": "true"
         },
         "expanded": false,
         "children": [],
         "type": "text"
        },
        {
         "configs": {
          "itemId": "hidContractDESC",
          "hidden": "true"
         },
         "expanded": false,
         "children": [],
         "type": "text"
        },
        {
         "configs": {
          "itemId": "concatGrid",
          "viewConfig": " {enableTextSelection:true}"
         },
         "expanded": true,
         "children": [
          {
           "configs": {"itemId": "tbar"},
           "expanded": true,
           "children": [
            {
             "configs": {
              "itemId": "contract_description",
              "emptyText": "合同名称",
              "width": "140",
              "x": "24",
              "y": "8",
              "height": "22"
             },
             "expanded": false,
             "children": [],
             "type": "text"
            },
            {
             "configs": {
              "itemId": "queryConcatMenu",
              "text": "查询",
              "iconCls": "zoom_icon"
             },
             "expanded": false,
             "children": [],
             "type": "item",
             "events": {"click": "var ds = app.contract_description.getValue();\
//console.info(ds);\
app.hidContractDESC.setValue(ds);\
app.concatGrid.store.reload({params:{description : ds}});\
app.tree1.store.load();"}
            },
            {
             "configs": {
              "itemId": "addConcatMenu",
              "text": "新增",
              "iconCls": "record_add_icon"
             },
             "expanded": false,
             "children": [],
             "type": "item",
             "events": {"click": "Wb.reset(app.concatWin);\
app.verifStatus.setValue(\"insert\");\
app.gridCBZS.store.removeAll();\
app.concatWin.setTitle('添加 - 合同');\
app.concatWin.setIconCls('record_add_icon');\
app.CONFIRM_STATUS.setValue(0);\
app.concatWin.show();\
app.isEdit = false; //标识是否为添加或修改状态，在editWin的ok事件中用到此属性"}
            },
            {
             "configs": {
              "itemId": "editConcatMenu",
              "text": "编辑",
              "iconCls": "record_edit_icon"
             },
             "expanded": false,
             "children": [],
             "type": "item",
             "events": {"click": "\
var rec = app.concatGrid.getSelection()[0];\
if (!rec) {\
  Wb.warn('请选择 1 条需要修改的记录');\
  return;\
}\
app.verifStatus.setValue(\"update\");\
app.concatWin.setIconCls('record_edit_icon');\
app.concatWin.setTitle('修改-合同');\
app.concatWin.show();\
Wb.setValue(app.concatWin,rec.data); \
app.gridCBZS.store.load({params:{M_ID:rec.data.ID}});\
\
//把记录数据应用到窗口\
app.isEdit = true;"}
            },
            {
             "configs": {
              "itemId": "delConcatMenu",
              "text": "删除",
              "iconCls": "record_delete_icon"
             },
             "expanded": false,
             "children": [],
             "type": "item",
             "events": {"click": "var rec = app.concatGrid.getSelection()[0];\
if (!rec) {\
  Wb.warn('请选择 1 条需要删除的记录');\
  return;\
}\
var param ={\
  url : 'm?xwl=feeManage/contract/java/delete',\
  params:{id: rec.data.ID},\
  titleField:'DESCRIPTION'\
};\
\
Wb.del(app.concatGrid, param);\
app.tree1.store.load();"}
            },
            {
             "configs": {
              "itemId": "copyConcatMenu",
              "text": "复制合同",
              "iconCls": "db_form_add_icon"
             },
             "expanded": true,
             "children": [],
             "type": "item",
             "events": {"click": "Wb.reset(app.concatWin);\
var rec = app.concatGrid.getSelection()[0];\
if (!rec) {\
  Wb.warn('请选择 1 条需要复制的合同');\
  return;\
}\
app.verifStatus.setValue(\"copy\");\
app.concatWin.setIconCls('record_edit_icon');\
app.concatWin.setTitle('复制合同');\
app.concatWin.show();\
Wb.setVal(app.concatWin,'COPY_ID',rec.data.ID); \
Wb.setVal(app.concatWin,'DESCRIPTION',rec.data.DESCRIPTION+'_cpy');\
Wb.setVal(app.concatWin,'LIFE_STATUS',1);\
\
//把记录数据应用到窗口\
app.isEdit = false;"}
            },
            {
             "configs": {
              "itemId": "verifyConcatMenu",
              "hidden": "!{#verifyConcatMenu#}",
              "text": "合同审核",
              "iconCls": "db_form_add_icon"
             },
             "expanded": false,
             "children": [],
             "type": "item",
             "events": {"click": "\
var rec = app.concatGrid.getSelection()[0];\
if (!rec) {\
  Wb.warn('请选择 1 条需要审核的记录');\
  return;\
}\
app.verifStatus.setValue(\"verify\");\
app.concatWin.setIconCls('record_edit_icon');\
app.concatWin.setTitle('合同审核');\
app.concatWin.show();\
Wb.setValue(app.concatWin,rec.data); \
app.gridCBZS.store.load({params:{M_ID:rec.data.ID}});\
\
//把记录数据应用到窗口\
app.isEdit = true;"}
            }
           ],
           "type": "toolbar"
          },
          {
           "configs": {
            "itemId": "store",
            "autoLoad": "false",
            "url": "m?xwl=feeManage/contract/java/queryAll"
           },
           "expanded": false,
           "children": [],
           "type": "store"
          },
          {
           "configs": {"itemId": "columns"},
           "expanded": true,
           "children": [
            {
             "configs": {
              "itemId": "colID",
              "hidden": "true",
              "dataIndex": "ID",
              "text": "合同号"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colDESCRIPTION",
              "dataIndex": "DESCRIPTION",
              "text": "合同名"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colLIFE_STATUS",
              "renderer": "if(value == \"1\"){\
\treturn \"启用\";\
}else if(value == \"2\"){\
\treturn \"不启用\";\
}",
              "dataIndex": "LIFE_STATUS",
              "text": "启用状态"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "col_CONTRACT_NO",
              "dataIndex": "CONTRACT_NO",
              "text": "合同编号"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "col_ORIGINAL_CONTRACT_ID",
              "dataIndex": "ORIGINAL_CONTRACT_ID",
              "text": "原始合同编号"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "col_EFFECTIVE_DATE",
              "dataIndex": "EFFECTIVE_DATE",
              "text": "生效日期"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "col_EXPIRED_DATE",
              "dataIndex": "EXPIRED_DATE",
              "text": "失效日期"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "col_CONFIRM_STATUS",
              "renderer": "if(value == 0){\
\treturn \"未提交\";\
}\
if(value == 1){\
\treturn \"已提交未审核\";\
}\
if(value == 2){\
\treturn \"已经审核\";\
}\
if(value == 3){\
\treturn \"未通过\";\
}",
              "dataIndex": "CONFIRM_STATUS",
              "text": "合同审核"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "col_CONFIRM_USER",
              "dataIndex": "CONFIRM_USER",
              "text": "合同确认人"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "col_CONFIRM_DATE",
              "dataIndex": "CONFIRM_DATE",
              "text": "合同确认时间"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "col_PAYMENT_AGENT",
              "dataIndex": "PAYMENT_AGENT",
              "text": "付费代理"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "col_PAYMENT_TYPE",
              "renderer": "if(value == 0){\
\treturn \"现金\";\
}\
if(value == 1){\
\treturn \"挂账\";\
}\
",
              "dataIndex": "PAYMENT_TYPE",
              "text": "付费类型"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "col_CONTRACT_TYPE",
              "renderer": "if(value == 0){\
\treturn \"船方\";\
}\
if(value == 1){\
\treturn \"货方\";\
}\
",
              "dataIndex": "CONTRACT_TYPE",
              "text": "合同类型"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "col_EXPAND_TO",
              "dataIndex": "EXPAND_TO",
              "text": "过期时间延长值"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "col_TRADE_TYPE",
              "renderer": "if(value == 'E'){\
\treturn \"外贸\";\
}\
if(value == 'I'){\
\treturn \"内贸\";\
}\
",
              "dataIndex": "TRADE_TYPE",
              "text": "贸易类型"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "col_BIZ_SCOPE",
              "dataIndex": "BIZ_SCOPE",
              "text": "业务范围"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "col_CATEGORY",
              "renderer": "\
if(value == 0){\
\treturn \"草稿\";\
}\
if(value == 1){\
\treturn \"模版\";\
}\
if(value == 2){\
\treturn \"正常合同\";\
}\
",
              "dataIndex": "CATEGORY",
              "text": "合同属性"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "col_VERSION",
              "dataIndex": "VERSION",
              "text": "版本号"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "col_VERSION_MEMO",
              "dataIndex": "VERSION_MEMO",
              "text": "版本备注"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "col_CURRENCY_ID",
              "renderer": "if(value == 1){\
\treturn \"现金\";\
}\
if(value == 2){\
\treturn \"月结\";\
}\
if(value == 3){\
\treturn \"托收单\";\
}",
              "dataIndex": "CURRENCY_ID",
              "text": "结算类型"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "col_APPROVE_MEMO",
              "dataIndex": "APPROVE_MEMO",
              "text": "审核备注"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colCREATEUSER",
              "dataIndex": "CREATEUSER",
              "text": "创建人"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "colCREATETIME",
              "dataIndex": "CREATETIME",
              "text": "创建时间"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            }
           ],
           "type": "array"
          }
         ],
         "type": "grid"
        },
        {
         "configs": {
          "itemId": "feeClassGrid",
          "title": "费类信息"
         },
         "expanded": false,
         "children": [
          {
           "configs": {"itemId": "tbar"},
           "expanded": true,
           "children": [
            {
             "configs": {
              "itemId": "editFeeClassMenu",
              "text": "选择费类",
              "iconCls": "db_form_add_icon"
             },
             "expanded": false,
             "children": [],
             "type": "item",
             "events": {"click": "\
app.feeClassWin.show();\
//app.feeClassWinGrid.store.load();\
Wb.request({\
    url: 'm?xwl=feeManage/contract/category/java/queryCateByContract',\
    params: {CONTRACT_ID:app.hidContract.getValue()},\
    success: function(resp) {\
      var roleRec;\
      var selRecs = [];\
      var roles = Wb.decode(resp.responseText);\
      Wb.each(roles.rows, function(data) {\
        roleRec = Wb.find(app.feeClassWinGrid.store, 'ID', data.CATEGORY_ID);\
        if (roleRec){\
          selRecs.push(roleRec);\
        }\
      });\
      app.feeClassWinGrid.setSelection(selRecs);\
      \
    }\
});\
"}
            },
            {
             "configs": {
              "itemId": "updateClassMenu",
              "text": "编辑费类",
              "iconCls": "record_edit_icon"
             },
             "expanded": false,
             "children": [],
             "type": "item",
             "events": {"click": "var rec = app.feeClassGrid.getSelection()[0];\
if (!rec) {\
  Wb.warn('请选择 1 条需要修改的记录');\
  return;\
}\
app.editClassWin.setIconCls('record_edit_icon');\
app.editClassWin.setTitle('修改合同费类');\
app.editClassWin.show();\
Wb.setValue(app.editClassWin,rec.data); \
\
//把记录数据应用到窗口\
app.isEdit = true;\
/*\
app.feeClassWin.show();\
app.feeClassWinGrid.store.load();\
Wb.request({\
    url: 'm?xwl=feeManage/contract/category/java/queryCateByContract',\
    params: {CONTRACT_ID:app.hidContract.getValue()},\
    success: function(resp) {\
      var roleRec;\
      var selRecs = [];\
      var roles = Wb.decode(resp.responseText);\
      Wb.each(roles.rows, function(data) {\
        roleRec = Wb.find(app.feeClassWinGrid.store, 'ID', data.CATEGORY_ID);\
        if (roleRec){\
          selRecs.push(roleRec);\
        }\
      });\
      app.feeClassWinGrid.setSelection(selRecs);\
      \
    }\
});\
*/"}
            }
           ],
           "type": "toolbar"
          },
          {
           "configs": {
            "itemId": "store",
            "autoLoad": "false",
            "url": "m?xwl=feeManage/contract/category/java/queryCateByContract"
           },
           "expanded": false,
           "children": [],
           "type": "store"
          },
          {
           "configs": {"itemId": "columns"},
           "expanded": true,
           "children": [
            {
             "configs": {
              "itemId": "col_ID",
              "hidden": "true",
              "dataIndex": "ID",
              "text": "编号"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "col_CATEGORY_ID",
              "dataIndex": "CATEGORY_ID",
              "keyName": "C_BASE_CATEGORY",
              "text": "费类名称"
             },
             "expanded": true,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "isAll",
              "renderer": "if(value == 1){\
  return \"包干\";\
}else{\
  return \"不包干\";\
}",
              "dataIndex": "IS_ALL",
              "text": "是否包干"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "col_EFFECTIVED",
              "renderer": "if(value == 0){\
  return \"草稿\";\
}\
if(value == 1){\
  return \"已生效\";\
}\
if(value == 2){\
  return \"已迁出\";\
}\
if(value == 3){\
  return \"已禁用\";\
}\
if(value == 4){\
  return \"历史版本\";\
}",
              "dataIndex": "EFFECTIVED",
              "text": "规则状态"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "col_BIZ_SCOPE",
              "dataIndex": "BIZ_SCOPE",
              "width": "150",
              "text": "业务范围"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "remark",
              "dataIndex": "NOTES",
              "width": "150",
              "text": "描述"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "col_CREATEUSER",
              "dataIndex": "CREATEUSER",
              "text": "创建人"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            },
            {
             "configs": {
              "itemId": "col_CREATETIME",
              "dataIndex": "CREATETIME",
              "text": "创建时间"
             },
             "expanded": false,
             "children": [],
             "type": "column"
            }
           ],
           "type": "array"
          }
         ],
         "type": "grid"
        },
        {
         "configs": {
          "layout": "border",
          "itemId": "item_panel",
          "split": "true",
          "region": "center"
         },
         "expanded": false,
         "children": [
          {
           "configs": {
            "itemId": "feeItemGrid",
            "title": "费目信息",
            "region": "north",
            "height": "300"
           },
           "expanded": true,
           "children": [
            {
             "configs": {"itemId": "tbar"},
             "expanded": true,
             "children": [
              {
               "configs": {
                "itemId": "editFeeItemMenu",
                "text": "选择费目",
                "iconCls": "db_form_add_icon"
               },
               "expanded": false,
               "children": [],
               "type": "item",
               "events": {"click": "app.feeItemWin.show();\
app.feeItemWinGrid.store.load({params:{CATEGORY_ID:app.hidTreeID.getValue()}});\
Wb.request({\
    url: 'm?xwl=feeManage/contract/item/java/queryItemByCate',\
    params: {CONTRACT_ID:app.hidContract.getValue(), CATEGORY_ID:app.hidTreeID.getValue() },\
    success: function(resp) {\
      var roleRec;\
      var selRecs = [];\
      var roles = Wb.decode(resp.responseText);\
      Wb.each(roles.rows, function(data) {\
        roleRec = Wb.find(app.feeItemWinGrid.store, 'CHARGING_ID', data.ITEM_ID);\
        if (roleRec){\
          selRecs.push(roleRec);\
        }\
      });\
      app.feeItemWinGrid.setSelection(selRecs);\
      \
    }\
});\
"}
              },
              {
               "configs": {
                "itemId": "updateItemMenu",
                "text": "编辑费目",
                "iconCls": "record_edit_icon"
               },
               "expanded": false,
               "children": [],
               "type": "item",
               "events": {"click": "var rec = app.feeItemGrid.getSelection()[0];\
if (!rec) {\
  Wb.warn('请选择 1 条需要修改的记录');\
  return;\
}\
app.editItemWin.setIconCls('record_edit_icon');\
app.editItemWin.setTitle('修改合同费目');\
app.editItemWin.show();\
Wb.setValue(app.editItemWin,rec.data); \
\
//把记录数据应用到窗口\
app.isEdit = true;\
\
/*\
app.feeItemWin.show();\
app.feeItemWinGrid.store.load({params:{CATEGORY_ID:app.hidTreeID.getValue()}});\
Wb.request({\
    url: 'm?xwl=feeManage/contract/item/java/queryItemByCate',\
    params: {CONTRACT_ID:app.hidContract.getValue(), CATEGORY_ID:app.hidTreeID.getValue() },\
    success: function(resp) {\
      var roleRec;\
      var selRecs = [];\
      var roles = Wb.decode(resp.responseText);\
      Wb.each(roles.rows, function(data) {\
        roleRec = Wb.find(app.feeItemWinGrid.store, 'CHARGING_ID', data.ITEM_ID);\
        if (roleRec){\
          selRecs.push(roleRec);\
        }\
      });\
      app.feeItemWinGrid.setSelection(selRecs);\
      \
    }\
});\
*/\
"}
              },
              {
               "configs": {"itemId": "contractItemNote"},
               "expanded": false,
               "children": [],
               "type": "text"
              },
              {
               "configs": {
                "itemId": "contractItemSearchBtn",
                "text": "筛选",
                "iconCls": "search_icon"
               },
               "expanded": false,
               "children": [],
               "type": "item",
               "events": {"click": "\
var nodeId = app.hidTreeID.getValue();\
var hidContract = app.hidContract.getValue();\
var contractItemNote = app.contractItemNote.getValue();\
\
app.feeItemGrid.store.load({params:{CONTRACT_ID:hidContract, CATEGORY_ID:nodeId, contractItemNote:contractItemNote}});\
\
\
"}
              }
             ],
             "type": "toolbar"
            },
            {
             "configs": {
              "itemId": "store",
              "autoLoad": "false",
              "url": "m?xwl=feeManage/contract/item/java/queryItemByCate"
             },
             "expanded": false,
             "children": [],
             "type": "store"
            },
            {
             "configs": {"itemId": "columns"},
             "expanded": true,
             "children": [
              {
               "configs": {
                "itemId": "col_ID",
                "hidden": "true",
                "dataIndex": "ID",
                "text": "编号"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "col_ITEM_ID",
                "dataIndex": "ITEM_ID",
                "width": "150",
                "keyName": "C_BASE_CHARGING_ITEM",
                "text": "费目名称"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "invoiceType",
                "dataIndex": "INVOICE_TYPE",
                "keyName": "C_BASE_INVOICE",
                "text": "发票类型"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "rateType",
                "renderer": "if(value === 0){\
  return \"普通\";\
}\
if(value == 1){\
  return \"分段\";\
}",
                "dataIndex": "RATE_TYPE",
                "text": "费率类型"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "lifeStatus",
                "renderer": "if(value === 0){\
  return \"不启用\";\
}else if(value === 1){\
  return \"启用\";\
}",
                "hidden": "true",
                "dataIndex": "LIFE_STATUS",
                "text": "有效状态"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "minAmount",
                "dataIndex": "MIN_AMOUNT",
                "text": "最小金额"
               },
               "expanded": true,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "maxAmount",
                "dataIndex": "MAX_AMOUNT",
                "text": "最大金额"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "unit",
                "dataIndex": "UNIT",
                "keyName": "FEE_UNIT",
                "text": "计价单位"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "isAutocalc",
                "renderer": "\
if(value === 0){\
  return \"自动\";\
}else if(value === 1){\
  return \"手动\";\
}",
                "dataIndex": "IS_AUTOCALC",
                "text": "自动计算"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "isFormat",
                "renderer": "if(value === 0){\
  return \"进整\";\
}else if(value === 1){\
  return \"四舍五入\";\
}else if(value === 2){\
  return \"去小数\";\t\
}",
                "dataIndex": "IS_FORMAT",
                "text": "计费吨取整"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "col_MIN_TON",
                "dataIndex": "MIN_TON",
                "text": "最小计费吨"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "formatUnit",
                "renderer": "if(value === 0){\
  return \"分\";\
}\
if(value === 1){\
  return \"角\";\
}\
if(value === 2){\
  return \"元\";\
}\
if(value === 3){\
  return \"十元\";\
}",
                "dataIndex": "FORMAT_UNIT",
                "text": "取整单位"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "currency",
                "dataIndex": "CURRENCY",
                "keyName": "C_CURRENCY",
                "text": "币种"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "glCode",
                "dataIndex": "GL_CODE",
                "text": "会计科目"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "flatRate",
                "renderer": "if(value === 0){\
  return \"否\";\
}else if(value == 1){\
  return \"是\";\
}",
                "dataIndex": "FLAT_RATE",
                "text": "固定费率"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "isAll",
                "renderer": "\
if(value === 0){\
  return \"不包干\";\
}\
if(value === 1){\
  return \"包干\";\
}",
                "dataIndex": "IS_ALL",
                "text": "是否包干"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "accountType",
                "renderer": "\
if(value == 1){\
  return \"现金\";\
}\
if(value == 2){\
  return \"月结\";\
}\
if(value == 3){\
  return \"托收单\";\
}",
                "dataIndex": "ACCOUNT_TYPE",
                "text": "结算方式"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "isAMOUNT_FORMAT",
                "renderer": "if(value === 0){\
  return \"进整\";\
}else if(value === 1){\
  return \"四舍五入\";\
}else if(value === 2){\
  return \"去小数\";\t\
}",
                "dataIndex": "AMOUNT_FORMAT",
                "text": "金额取整"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "col_BYAGENT",
                "renderer": "if(value == 0){\
  return \"货主\";\
}\
if(value == 1){\
  return \"船公司\";\
}",
                "dataIndex": "BYAGENT",
                "text": "是否船公司付费"
               },
               "expanded": true,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "col_BYDAY",
                "renderer": "if(value == 0){\
  return \"否\";\
}\
if(value == 1){\
  return \"是\";\
}",
                "dataIndex": "BYDAY",
                "text": "按天数计算"
               },
               "expanded": true,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "col_BYTON",
                "renderer": "if(value == 0){\
  return \"超重吨\";\
}\
if(value == 1){\
  return \"重量吨\";\
}\
if(value == 2){\
  return \"体积吨\";\
}",
                "dataIndex": "BYTON",
                "text": "择大计收"
               },
               "expanded": true,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "col_TONS_STERE",
                "dataIndex": "TONS_STERE",
                "text": "体积吨换算率"
               },
               "expanded": true,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "col_DERATE_TYPE",
                "renderer": "if(value == 0){\
  return \"前免\";\
}\
if(value == 1){\
  return \"后免\";\
}",
                "dataIndex": "DERATE_TYPE",
                "text": "分段减免类型"
               },
               "expanded": true,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "col_DERATE_DAY",
                "dataIndex": "DERATE_DAY",
                "text": "分段减免天"
               },
               "expanded": true,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "col_ENABLED",
                "renderer": "if(value === 0){\
  return \"否\";\
}\
if(value == 1){\
  return \"是\";\
}",
                "dataIndex": "ENABLED",
                "text": "是否参考价"
               },
               "expanded": true,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "notes",
                "dataIndex": "NOTES",
                "text": "备注"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "col_CREATEUSER",
                "dataIndex": "CREATEUSER",
                "text": "创建人"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "col_CREATETIME",
                "dataIndex": "CREATETIME",
                "text": "创建时间"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              }
             ],
             "type": "array"
            }
           ],
           "type": "grid",
           "events": {"itemclick": "app.itemRuleGrid.store.load({\
   params:{CONT_ITEM_ID : record.data.ID}\
});\
app.itemDerateGrid.store.removeAll();"}
          },
          {
           "configs": {
            "layout": "border",
            "itemId": "panel2",
            "region": "center"
           },
           "expanded": true,
           "children": [
            {
             "configs": {
              "layout": "border",
              "itemId": "panel11",
              "width": "400",
              "region": "west",
              "title": "计费状态"
             },
             "expanded": false,
             "children": [
              {
               "configs": {
                "itemId": "contract_toolbar",
                "region": "north"
               },
               "expanded": false,
               "children": [
                {
                 "configs": {
                  "itemId": "add",
                  "tooltip": "增加记录",
                  "text": "增加",
                  "iconCls": "record_add_icon"
                 },
                 "expanded": false,
                 "children": [],
                 "type": "item",
                 "events": {"click": "var rec = app.feeItemGrid.getSelection()[0];\
if (!rec) {\
  Wb.warn('请选择一条费目。');\
  return;\
} \
Wb.addEdit(app.itemRuleGrid,{KEY_NAME:''});  "}
                },
                {
                 "configs": {
                  "itemId": "delete",
                  "tooltip": "删除记录",
                  "text": "删除",
                  "iconCls": "record_delete_icon"
                 },
                 "expanded": false,
                 "children": [],
                 "type": "item",
                 "events": {"click": "Wb.remove(app.itemRuleGrid);"}
                },
                {
                 "configs": {
                  "itemId": "save",
                  "tooltip": "保存记录",
                  "text": "保存",
                  "iconCls": "save_icon"
                 },
                 "expanded": false,
                 "children": [],
                 "type": "item",
                 "events": {"click": "if (!Wb.verifyGrid(app.itemRuleGrid)) //验证数据是否合法\
  return;\
var rec = app.feeItemGrid.getSelection()[0];\
var param = Wb.getValue(app.itemRuleGrid);\
param = Wb.applyIf(param, Wb.getModified(app.itemRuleGrid));//获取增删改json串\
param = Wb.applyIf(param,{CONT_ITEM_ID:rec.data.ID});//客户编号\
\
Wb.request({\
  url: 'm?xwl=feeManage/contract/rule/java/saveContItemRule',\
  params: param,\
  success: function(resp) {\
    //ID_FIELD值在后台生成，把返回的ID_FIELD值列表同步到表格中\
    //Wb.syncCreate(app.grid11, Wb.decode(resp.responseText));\
    app.itemRuleGrid.store.load({params:{CONT_ITEM_ID:rec.data.ID}});\
    app.itemDerateGrid.store.removeAll();\
  }\
});"}
                }
               ],
               "type": "toolbar"
              },
              {
               "configs": {
                "itemId": "itemRuleGrid",
                "editable": "true",
                "region": "center"
               },
               "expanded": false,
               "children": [
                {
                 "configs": {
                  "itemId": "store",
                  "autoLoad": "false",
                  "url": "m?xwl=feeManage/contract/rule/java/findContItemRule"
                 },
                 "expanded": false,
                 "children": [],
                 "type": "store"
                },
                {
                 "configs": {"itemId": "columns"},
                 "expanded": true,
                 "children": [
                  {
                   "configs": {
                    "itemId": "numCol",
                    "xtype": "rownumberer"
                   },
                   "expanded": false,
                   "children": [],
                   "type": "column"
                  },
                  {
                   "configs": {
                    "itemId": "id1",
                    "hidden": "true",
                    "dataIndex": "ID"
                   },
                   "expanded": false,
                   "children": [],
                   "type": "column"
                  },
                  {
                   "configs": {
                    "itemId": "col_ACCOUNT_STATUS",
                    "renderer": "if(value === 0){\
  return \"收费\";\
}\
if(value === 1){\
  return \"免费\";\
}",
                    "dataIndex": "ACCOUNT_STATUS",
                    "width": "120",
                    "text": "<font color='red'>*<\/font>计费状态"
                   },
                   "expanded": true,
                   "children": [{
                    "configs": {
                     "itemId": "editor",
                     "pickList": "[[0, '收费'],[1, '免费']]"
                    },
                    "expanded": false,
                    "children": [],
                    "type": "combo"
                   }],
                   "type": "column"
                  },
                  {
                   "configs": {
                    "itemId": "col_DESCRIPTION",
                    "dataIndex": "DESCRIPTION",
                    "width": "200",
                    "text": "描述"
                   },
                   "expanded": true,
                   "children": [{
                    "configs": {"itemId": "editor"},
                    "expanded": false,
                    "children": [],
                    "type": "text"
                   }],
                   "type": "column"
                  }
                 ],
                 "type": "array"
                }
               ],
               "type": "grid",
               "events": {"itemclick": "var rid = record.data.ID;\
if(rid == undefined || rid == \"\"){\
  app.itemDerateGrid.store.removeAll();\
  return false;\
}\
app.itemDerateGrid.store.load({\
   params:{ITEM_RULE_ID : rid}\
});"}
              }
             ],
             "type": "panel"
            },
            {
             "configs": {
              "layout": "border",
              "itemId": "panel1",
              "region": "center",
              "title": "计费条件"
             },
             "expanded": false,
             "children": [
              {
               "configs": {
                "itemId": "contract_toolbar",
                "region": "north"
               },
               "expanded": true,
               "children": [
                {
                 "configs": {
                  "itemId": "add",
                  "tooltip": "增加记录",
                  "text": "增加",
                  "iconCls": "record_add_icon"
                 },
                 "expanded": false,
                 "children": [],
                 "type": "item",
                 "events": {"click": "var rec = app.itemRuleGrid.getSelection()[0];\
if (!rec) {\
  Wb.warn('请选择一条计费状态。');\
  return;\
} \
Wb.add(app.itemDerateGrid,{OPER_CHAR:\"=\"},'last',1,false);  \
"}
                },
                {
                 "configs": {
                  "itemId": "delete",
                  "tooltip": "删除记录",
                  "text": "删除",
                  "iconCls": "record_delete_icon"
                 },
                 "expanded": false,
                 "children": [],
                 "type": "item",
                 "events": {"click": "Wb.remove(app.itemDerateGrid);"}
                },
                {
                 "configs": {
                  "itemId": "save",
                  "normalName": "feeSaveBtn",
                  "tooltip": "保存记录",
                  "text": "保存",
                  "iconCls": "save_icon"
                 },
                 "expanded": false,
                 "children": [],
                 "type": "item",
                 "events": {"click": "if (!Wb.verifyGrid(app.itemDerateGrid)) //验证数据是否合法\
  return;\
var rec = app.itemRuleGrid.getSelection()[0];\
if(rec === undefined){\
Wb.warn(\"请先选择计费状态！\");\
}\
var param = Wb.getValue(app.itemDerateGrid);\
param = Wb.applyIf(param, Wb.getModified(app.itemDerateGrid));//获取增删改json串\
param = Wb.applyIf(param,{ITEM_RULE_ID:rec.data.ID});//客户编号\
\
Wb.request({\
  url: 'm?xwl=feeManage/contract/derate/java/saveContItemDerate',\
  params: param,\
  success: function(resp) {\
    //ID_FIELD值在后台生成，把返回的ID_FIELD值列表同步到表格中\
    //Wb.syncCreate(app.grid11, Wb.decode(resp.responseText));\
    app.itemDerateGrid.store.load({params:{ITEM_RULE_ID:rec.data.ID}});\
  }\
});"}
                }
               ],
               "type": "toolbar"
              },
              {
               "configs": {
                "itemId": "itemDerateGrid",
                "editable": "true",
                "region": "center"
               },
               "expanded": true,
               "children": [
                {
                 "configs": {
                  "itemId": "store",
                  "autoLoad": "false",
                  "url": "m?xwl=feeManage/contract/derate/java/findContItemDerate"
                 },
                 "expanded": false,
                 "children": [],
                 "type": "store"
                },
                {
                 "configs": {"itemId": "columns"},
                 "expanded": true,
                 "children": [
                  {
                   "configs": {
                    "itemId": "id1",
                    "hidden": "true",
                    "dataIndex": "ID"
                   },
                   "expanded": false,
                   "children": [],
                   "type": "column"
                  },
                  {
                   "configs": {
                    "itemId": "col_KEY_NAME",
                    "dataIndex": "KEY_NAME",
                    "width": "120",
                    "keyName": "C_BASE_DICT",
                    "text": "约束条件"
                   },
                   "expanded": true,
                   "children": [{
                    "configs": {
                     "itemId": "editor",
                     "editable": "false",
                     "keyName": "C_BASE_DICT",
                     "queryDelay": "500"
                    },
                    "expanded": true,
                    "children": [],
                    "type": "combo",
                    "events": {"select": "\
// app.COMPARE_VAL.editor.reset();\
// app.COMPARE_VAL.editor.load({\
//   params: {\
//     ID: app.KEY_NAME.editor.getValue()\
//   }\
// });"}
                   }],
                   "type": "column"
                  },
                  {
                   "configs": {
                    "itemId": "col_OPER_CHAR",
                    "dataIndex": "OPER_CHAR",
                    "width": "120",
                    "keyName": "compareCode",
                    "text": "运算符"
                   },
                   "expanded": true,
                   "children": [{
                    "configs": {
                     "itemId": "editor",
                     "keyName": "compareCode",
                     "queryDelay": "500"
                    },
                    "expanded": true,
                    "children": [],
                    "type": "combo"
                   }],
                   "type": "column"
                  },
                  {
                   "configs": {
                    "itemId": "col_COMPARE_VAL",
                    "dataIndex": "COMPARE_VAL",
                    "width": "100",
                    "text": "比较键"
                   },
                   "expanded": true,
                   "children": [{
                    "configs": {
                     "itemId": "editor",
                     "editable": "true",
                     "displayField": "V",
                     "valueField": "K",
                     "multiSelect": "true"
                    },
                    "expanded": true,
                    "children": [{
                     "configs": {
                      "itemId": "store",
                      "autoLoad": "true",
                      "url": "m?xwl=feeManage/calc/selectCod"
                     },
                     "expanded": false,
                     "children": [],
                     "type": "store",
                     "events": {"beforeload": "operation.params = {\
  fldId: app.getColNam(),\
  query: operation.params.query\
};\
"}
                    }],
                    "type": "combo",
                    "events": {"select": "\
var rec = app.itemDerateGrid.getSelection()[0];\
rec.set('COMPARE_NAME',combo.getRawValue());\
"}
                   }],
                   "type": "column"
                  },
                  {
                   "configs": {
                    "itemId": "col_COMPARE_NAME",
                    "dataIndex": "COMPARE_NAME",
                    "width": "100",
                    "text": "比较值"
                   },
                   "expanded": true,
                   "children": [],
                   "type": "column"
                  },
                  {
                   "configs": {
                    "itemId": "col_COMPARE_NAME1",
                    "handler": "Wb.request({\
  url: 'm?xwl=shipBIlla/supcanVbill/billEdit/billStateEdit/deleteFenBill',\
  params: {\
    billId: record.get(\"ID\"),\
    vId: app.vId.getValue(),\
    pBillNo: app.pBillNo.getValue()\
  },\
  success: function(resp) {\
    Wb.remove(app.billSelGrid);\
  }\
});",
                    "xtype": "actioncolumn",
                    "dataIndex": "COMPARE_NAME",
                    "width": "100",
                    "text": "操作"
                   },
                   "expanded": true,
                   "children": [{
                    "configs": {"itemId": "items"},
                    "expanded": true,
                    "children": [{
                     "configs": {
                      "itemId": "addAction",
                      "handler": "// var  index=app.grid1.store.find(\"REAL_NAME\",\"guoxiaowei1\");\
// app.grid1.getSelectionModel().select(index); \
\
var  ms=app.itemDerateGrid.store.getModifiedRecords();\
if(ms!=\"\")\
{\
\tWb.confirm(\"请先保存数据\",function(){\
    app.feeSaveBtn.fireEvent('click');\
    });\
}else{\
 app.filterWin.show();\
 app.filterWin.fldId=record.get('KEY_NAME');\
 app.filterWin.ID=record.get('ID');\
 app.gridAll.store.load({params:{fldId:record.get('KEY_NAME'),ID:record.get('ID')}});\
 app.gridAboard.store.load({params:{fldId:record.get('KEY_NAME'),ID:record.get('ID')}});\
}",
                      "tooltip": "添加",
                      "iconCls": "record_add_icon"
                     },
                     "expanded": false,
                     "children": [],
                     "type": "column"
                    }],
                    "type": "array"
                   }],
                   "type": "column"
                  }
                 ],
                 "type": "array"
                }
               ],
               "type": "grid"
              }
             ],
             "type": "panel"
            }
           ],
           "type": "panel"
          }
         ],
         "type": "panel"
        },
        {
         "configs": {
          "layout": "border",
          "itemId": "tariff_panel",
          "split": "true",
          "region": "center"
         },
         "expanded": false,
         "children": [
          {
           "configs": {
            "itemId": "toolbarBtn",
            "hidden": "false",
            "region": "north",
            "height": "30"
           },
           "expanded": false,
           "children": [
            {
             "configs": {
              "itemId": "txtName",
              "labelAlign": "right",
              "emptyText": "多条件以英文逗号分割",
              "fieldLabel": "名称",
              "labelWidth": "60"
             },
             "expanded": false,
             "children": [],
             "type": "text"
            },
            {
             "configs": {
              "queryMode": "remote",
              "labelWidth": "90",
              "queryCaching": "true",
              "valueField": "ID",
              "queryDelay": "500",
              "minChars": "2",
              "itemId": "comb_customer",
              "labelAlign": "right",
              "fieldLabel": "选择客户",
              "x": "0",
              "width": "300",
              "y": "216",
              "displayField": "CNAME",
              "height": "24",
              "multiSelect": "false"
             },
             "expanded": false,
             "children": [{
              "configs": {
               "itemId": "store",
               "autoLoad": "false",
               "params": "{fldId:'CE'}",
               "url": "m?xwl=system/common/clientSelect"
              },
              "expanded": false,
              "children": [],
              "type": "store"
             }],
             "type": "combo"
            },
            {
             "configs": {
              "itemId": "queryBtn",
              "text": "查询",
              "iconCls": "ajax_icon",
              "height": "22"
             },
             "expanded": false,
             "children": [],
             "type": "button",
             "events": {"click": "\
app.grid1.store.load({\
  params : {\
    CONTRACT_ID : app.hidContract.getValue(),\
    DESCRIPTION : app.txtName.getValue(),\
    CHARGING_ID : app.hidTreeID.getValue(),\
    CUSTOMERS   : app.comb_customer.getValue()\
  }\
});\
\
"}
            },
            {
             "configs": {
              "itemId": "addBtn",
              "text": "新增",
              "iconCls": "record_add_icon",
              "height": "22"
             },
             "expanded": false,
             "children": [],
             "type": "button",
             "events": {"click": "if(Wb.isEmpty(app.hidTreeID.getValue())){\
  alert(\"请先选择费目节点！\");\
  return;\
}\
\
Wb.reset(app.customWin);\
app.FLAT_RATE.setValue(0);\
app.CURRENCY.setValue('1');\
app.IS_NIGHTSHIFT.setValue(0);\
app.IS_WEEKDAY.setValue(0);\
app.IS_TIMES.setValue(0);\
app.IS_VACATION.setValue(0);\
Wb.setVal(app.tariff_panel,'DISCOUNT', 100);\
app.multistepGrid.store.removeAll();\
\
//app.DISCOUNT.setValue(100);\
\
app.customWin.setTitle('添加 - 费率');\
app.customWin.setIconCls('record_add_icon');\
app.customWin.show();\
app.isEdit = false; //标识是否为添加或修改状态，在editWin的ok事件中用到此属性\
\
if(app.pickComp !== undefined){\
app.pickComStore.load({params:{query:'',itemId:app.hidTreeID.getValue()}});}"}
            },
            {
             "configs": {
              "itemId": "editBtn",
              "text": "编辑",
              "iconCls": "record_edit_icon",
              "height": "22"
             },
             "expanded": false,
             "children": [],
             "type": "button",
             "events": {"click": "var rec = app.grid1.getSelection()[0];\
if (!rec) {\
  Wb.warn('请选择 1 条需要修改的记录');\
  return;\
}\
app.customWin.setIconCls('record_edit_icon');\
app.customWin.setTitle('修改');\
app.customWin.show();\
Wb.setValue(app.customWin,rec.data); \
app.multistepGrid.store.load({params:{tariffId:rec.data.ID}});\
\
//把记录数据应用到窗口\
app.isEdit = true;\
//app.pickComp.store.load({params:{itemId:app.hidTreeID.getValue()}});"}
            },
            {
             "configs": {
              "itemId": "delBtn",
              "text": "删除",
              "iconCls": "record_delete_icon",
              "height": "22"
             },
             "expanded": false,
             "children": [],
             "type": "button",
             "events": {"click": "\
var rec = app.grid1.getSelection()[0];\
if (!rec) {\
  Wb.warn('请选择 1 条需要删除的记录');\
  return;\
}\
var param ={\
  url : 'm?xwl=feeManage/tariff/java/delete',\
  params:{id: rec.data.ID},\
//   failure :function(){\
//     alert('数据已被使用，不能删除！');\
//   },\
  titleField:'DESCRIPTION'\
};\
\
Wb.del(app.grid1, param);"}
            },
            {
             "configs": {
              "itemId": "resetBtn",
              "hidden": "true",
              "text": "重置",
              "iconCls": "record_add_icon",
              "height": "22"
             },
             "expanded": false,
             "children": [],
             "type": "button",
             "events": {"click": "\
Wb.reset(app.toolbar1);\
app.grid1.store.load({\
  out: app.panel1\
});"}
            },
            {
             "configs": {
              "itemId": "copyBtn",
              "text": "复制费率",
              "iconCls": "record_edit_icon",
              "height": "22"
             },
             "expanded": false,
             "children": [],
             "type": "button",
             "events": {"click": "var rec = app.grid1.getSelection()[0];\
if (!rec) {\
  Wb.warn('请选择 1 条需要修改的记录');\
  return;\
}\
app.customWin.setIconCls('record_edit_icon');\
app.customWin.setTitle('修改');\
app.customWin.show();\
Wb.setValue(app.customWin,rec.data); \
\
//把记录数据应用到窗口\
app.isEdit = true;\
//app.pickComp.store.load({params:{itemId:app.hidTreeID.getValue()}});"}
            }
           ],
           "type": "toolbar"
          },
          {
           "configs": {
            "itemId": "grid1",
            "region": "north",
            "height": "300"
           },
           "expanded": false,
           "children": [
            {
             "configs": {
              "itemId": "store",
              "autoLoad": "false",
              "url": "m?xwl=feeManage/tariff/java/findTariffByCategory"
             },
             "expanded": true,
             "children": [],
             "type": "store"
            },
            {
             "configs": {"itemId": "columns"},
             "expanded": true,
             "children": [
              {
               "configs": {
                "itemId": "id1",
                "hidden": "true",
                "dataIndex": "ID"
               },
               "expanded": true,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "DESCRIPTION1",
                "dataIndex": "DESCRIPTION",
                "text": "描述"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "NOTES1",
                "dataIndex": "NOTES",
                "text": "备注"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "FILTER_ID1",
                "hidden": "true",
                "dataIndex": "FILTER_ID",
                "text": "费率条件编号"
               },
               "expanded": true,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "FILTER_NAME1",
                "dataIndex": "FILTER_NAME",
                "text": "费率条件"
               },
               "expanded": true,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "CUSTOMERS1",
                "hidden": "true",
                "dataIndex": "CUSTOMERS",
                "text": "客户编号"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "RATE1",
                "dataIndex": "RATE",
                "text": "费率金额"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "RATE_TYPE1",
                "renderer": "if(value == '0'){\
    return \"普通\";\
}else if(value == '1'){\
    return \"分段\";\
}",
                "dataIndex": "RATE_TYPE",
                "text": "计费类型"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "CUSTOMERS11",
                "dataIndex": "CUSTOMER_NAM",
                "text": "客户名称"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "col_VOL_PRICE",
                "dataIndex": "VOL_PRICE",
                "text": "体积吨金额"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "DISCOUNT1",
                "dataIndex": "DISCOUNT",
                "text": "折扣"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "CURRENCY1",
                "dataIndex": "CURRENCY",
                "keyName": "C_CURRENCY",
                "text": "币种"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "GL_CODE1",
                "dataIndex": "GL_CODE",
                "text": "会计科目"
               },
               "expanded": true,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "MIN_AMOUNT1",
                "dataIndex": "MIN_AMOUNT",
                "text": "吨/车"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "MAX_AMOUNT1",
                "dataIndex": "MAX_AMOUNT",
                "text": "元/车"
               },
               "expanded": true,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "FLAT_RATE1",
                "renderer": "if(value == '0'){\
    return \"否\";\
}else if(value == '1'){\
    return \"是\";\
}",
                "dataIndex": "FLAT_RATE",
                "text": "是否统一费率"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "IS_VACATION1",
                "renderer": "if(value == '0'){\
    return \"否\";\
}else if(value == '1'){\
    return \"是\";\
}",
                "dataIndex": "IS_VACATION",
                "text": "是否假期计费"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "IS_NIGHTSHIFT1",
                "renderer": "if(value == '0'){\
    return \"否\";\
}else if(value == '1'){\
    return \"是\";\
}",
                "dataIndex": "IS_NIGHTSHIFT",
                "text": "是否夜班计费"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "IS_WEEKDAY1",
                "renderer": "if(value == '0'){\
    return \"否\";\
}else if(value == '1'){\
    return \"是\";\
}",
                "dataIndex": "IS_WEEKDAY",
                "text": "是否周末计费"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "IS_TIMES1",
                "renderer": "if(value == '0'){\
    return \"否\";\
}else if(value == '1'){\
    return \"是\";\
}",
                "dataIndex": "IS_TIMES",
                "text": "是否按时间段计费"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "TIME_UNIT1",
                "renderer": "if(value == '1'){\
    return \"分钟\";\
}else if(value == '2'){\
    return \"小时\";\
}else if(value == '3'){\
    return \"天\";\
}",
                "dataIndex": "TIME_UNIT",
                "text": "时间段计费单位"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "START_FIELD1",
                "dataIndex": "START_FIELD",
                "text": "优惠起始"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              },
              {
               "configs": {
                "itemId": "END_FIELD1",
                "dataIndex": "END_FIELD",
                "text": "优惠截止"
               },
               "expanded": false,
               "children": [],
               "type": "column"
              }
             ],
             "type": "array"
            }
           ],
           "type": "grid",
           "events": {"beforeselect": "app.ritem_grid.store.load({params:{ID:record.data.FILTER_ID}});\
app.multistepGrid2.store.load({params:{tariffId:record.data.ID}});"}
          },
          {
           "configs": {
            "layout": "border",
            "itemId": "panel1",
            "region": "center"
           },
           "expanded": false,
           "children": [
            {
             "configs": {
              "itemId": "ritem_grid",
              "split": "true",
              "width": "500",
              "region": "west",
              "title": "费率条件"
             },
             "expanded": true,
             "children": [
              {
               "configs": {
                "itemId": "store",
                "autoLoad": "false",
                "url": "m?xwl=feeManage/rule/java/queryItemByRule"
               },
               "expanded": true,
               "children": [],
               "type": "store"
              },
              {
               "configs": {"itemId": "columns"},
               "expanded": true,
               "children": [
                {
                 "configs": {
                  "itemId": "rule_id",
                  "hidden": "true",
                  "dataIndex": "ID",
                  "text": "编号"
                 },
                 "expanded": true,
                 "children": [],
                 "type": "column"
                },
                {
                 "configs": {
                  "itemId": "rule_KEY_NAME",
                  "dataIndex": "KEY_NAME",
                  "width": "200",
                  "keyName": "C_BASE_DICT",
                  "text": "条件"
                 },
                 "expanded": false,
                 "children": [],
                 "type": "column"
                },
                {
                 "configs": {
                  "itemId": "rule_OPER_CHAR",
                  "dataIndex": "OPER_CHAR",
                  "width": "80",
                  "keyName": "compareCode",
                  "text": "运算符"
                 },
                 "expanded": false,
                 "children": [],
                 "type": "column"
                },
                {
                 "configs": {
                  "itemId": "rule_COMPARE_VAL",
                  "dataIndex": "COMPARE_VAL",
                  "width": "300",
                  "text": "比较值"
                 },
                 "expanded": false,
                 "children": [],
                 "type": "column"
                },
                {
                 "configs": {
                  "itemId": "rule_COMPARE_NAME",
                  "dataIndex": "COMPARE_NAME",
                  "width": "360",
                  "text": "比较值"
                 },
                 "expanded": false,
                 "children": [],
                 "type": "column"
                }
               ],
               "type": "array"
              }
             ],
             "type": "grid"
            },
            {
             "configs": {
              "itemId": "multistepGrid2",
              "editable": "true",
              "pagingBar": "false",
              "region": "center",
              "title": "阶梯费率（<font color='red'>费率中计费类型为分段时有效<\/font>）"
             },
             "expanded": true,
             "children": [
              {
               "configs": {
                "itemId": "store",
                "remoteSort": "true",
                "autoLoad": "false",
                "url": "m?xwl=feeManage/tariff/java/findMultistep"
               },
               "expanded": false,
               "children": [],
               "type": "store"
              },
              {
               "configs": {"itemId": "columns"},
               "expanded": true,
               "children": [
                {
                 "configs": {
                  "itemId": "multi_ID",
                  "hidden": "true",
                  "dataIndex": "ID",
                  "width": "100"
                 },
                 "expanded": true,
                 "children": [],
                 "type": "column"
                },
                {
                 "configs": {
                  "itemId": "numCol",
                  "xtype": "rownumberer"
                 },
                 "expanded": false,
                 "children": [],
                 "type": "column"
                },
                {
                 "configs": {
                  "itemId": "START_VAL",
                  "dataIndex": "START_VAL",
                  "width": "100",
                  "text": "起始值"
                 },
                 "expanded": true,
                 "children": [],
                 "type": "column"
                },
                {
                 "configs": {
                  "itemId": "END_VAL",
                  "dataIndex": "END_VAL",
                  "width": "80",
                  "text": "截止值"
                 },
                 "expanded": true,
                 "children": [],
                 "type": "column"
                },
                {
                 "configs": {
                  "itemId": "STEP_RATE",
                  "dataIndex": "STEP_RATE",
                  "width": "100",
                  "text": "阶梯费率（元）"
                 },
                 "expanded": true,
                 "children": [],
                 "type": "column"
                },
                {
                 "configs": {
                  "itemId": "DISCOUNT",
                  "dataIndex": "DISCOUNT",
                  "width": "100",
                  "text": "折扣（%）"
                 },
                 "expanded": true,
                 "children": [],
                 "type": "column"
                }
               ],
               "type": "array"
              }
             ],
             "type": "grid"
            }
           ],
           "type": "panel"
          }
         ],
         "type": "panel"
        }
       ],
       "type": "panel"
      }
     ],
     "type": "panel"
    }],
    "type": "viewport"
   }
  ],
  "type": "module",
  "events": {
   "finalize": "app.contractItemNote.addListener(\"specialkey\", function(field, e) {\
  if (e.getKey() == e.ENTER) {\
    app.contractItemSearchBtn.fireEvent('click');\
  }\
});\
\
app.contract_description.addListener(\"specialkey\", function(field, e) {\
  if (e.getKey() == e.ENTER) {\
    app.queryConcatMenu.fireEvent('click');\
    \
  }\
});\
",
   "initialize": "Wb.apply(app,{\
getColNam: function() {\
var  rec=app.itemDerateGrid.getSelection();\
  return rec[0].data.KEY_NAME;\
},\
  getColName: function() {\
var  rec=app.feeRitemGrid.getSelection();\
  return rec[0].data.KEY_NAME;\
}\
});\
"
  }
 }],
 "roles": {
  "CD": 1,
  "xlcwb": 1,
  "JCB": 1
 },
 "title": "客户合同费项费率维护",
 "iconCls": "",
 "inframe": false,
 "pageLink": ""
}