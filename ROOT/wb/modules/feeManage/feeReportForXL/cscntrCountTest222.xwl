{
 "hidden": false,
 "children": [{
  "configs": {
   "itemId": "module",
   "serverScript": "app.set({\
  JSESSIONID: request.getSession().getId()\
});\
var tenancyId=app.get('sys.TENANCY_ID');\
var  rs=app.run(\"SELECT c_fee_report.notes NAME, report_path path, item_id,DESCRIPTION ITEM_NAME,TRADE_ID \\\
  FROM c_fee_report, c_fee_report_contact, C_BASE_CHARGING_ITEM\\\
 WHERE c_fee_report.ID = c_fee_report_contact.report_id  and c_fee_report_contact.ITEM_ID=C_BASE_CHARGING_ITEM.ID\\\
   AND c_fee_report.tenancy_id = '\"+tenancyId+\"'   and TYPE ='1' \"),feeList=\"\",i=0;\
\
// while(rs.next()){\
//   feeList+='{\"NAME\":\\\"'+rs.getString(\"NAME\")+'\\\", \"PATH\":\\\"'+rs.getString(\"PATH\")+'\\\",\"ITEM_NAME\":\\\"'+rs.getString(\"ITEM_NAME\")+'\\\",\"ITEM_ID\":\\\"'+rs.getString(\"ITEM_ID\")+'\\\",\"TRADE_ID\":\\\"'+rs.getString('TRADE_ID')+'\\\"},';\
// }\
while(rs.next()){\
//   feeList+='{\"NAME\":\\\"'+rs.getString(\"NAME\")+'\\\", \"PATH\":\\\"'+rs.getString(\"PATH\")+'\\\",\"ITEM_NAME\":\\\"'+rs.getString(\"ITEM_NAME\")+'\\\",\"ITEM_ID\":\\\"'+rs.getString(\"ITEM_ID\")+'-'+rs.getString(\"TRADE_ID\")+'\\\",\"TRADE_ID\":\\\"'+rs.getString(\"TRADE_ID\")+'\\\"},';\
 feeList+='{\"NAME\":\\\"'+rs.getString(\"NAME\")+'\\\", \"PATH\":\\\"'+rs.getString(\"PATH\")+'\\\",\"ITEM_NAME\":\\\"'+rs.getString(\"ITEM_NAME\")+'\\\",\"ITEM_ID\":\\\"'+rs.getString(\"ITEM_ID\")+'\\\",\"TRADE_ID\":\\\"'+rs.getString(\"TRADE_ID\")+'\\\",\"ITEM_ID_S\":\\\"'+rs.getString(\"ITEM_ID\")+\"-\"+rs.getString('TRADE_ID')+'\\\"},';\
}\
feeList=feeList.substr(0,feeList.length-1);\
request.setAttribute(\"feeList\",StringUtil.text(\"[\"+feeList+\"]\"));"
  },
  "expanded": true,
  "children": [{
   "configs": {
    "layout": "fit",
    "itemId": "viewport1"
   },
   "expanded": true,
   "children": [{
    "configs": {
     "layout": "border",
     "border": "false",
     "itemId": "panel1",
     "rbar": "app.tbarGrid"
    },
    "expanded": true,
    "children": [
     {
      "configs": {
       "itemId": "tbar",
       "enableOverflow": "true",
       "region": "north"
      },
      "expanded": false,
      "children": [
       {
        "configs": {
         "layout": "hbox",
         "itemId": "radioMD",
         "padding": "0 0 0 10",
         "width": "240"
        },
        "expanded": false,
        "children": [
         {
          "configs": {
           "itemId": "radioM",
           "boxLabel": "按月统计",
           "flex": "1",
           "name": "radioMD",
           "checked": "true"
          },
          "expanded": false,
          "children": [],
          "type": "radio",
          "events": {"change": "if (newValue) {\
  app.cboY.setVisible(true);\
  app.cboM.setVisible(true);\
  var today = new Date(); //获取当前日期\
  app.cboY.setValue(today.getFullYear());\
  app.date1.setVisible(false);\
  app.date1.setValue(new Date());\
  app.sdate.setValue(\"\");\
  app.edate.setValue(\"\");\
  app.sdate.setVisible(false);\
  app.edate.setVisible(false);\
}"}
         },
         {
          "configs": {
           "itemId": "radioD",
           "boxLabel": "按天统计",
           "flex": "1",
           "name": "radioMD"
          },
          "expanded": false,
          "children": [],
          "type": "radio",
          "events": {"change": "if (newValue) {\
  var today = new Date(); //获取当前日期\
  var days = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate(); //获取当前月份天数\
  app.date1.setVisible(true);\
  app.date1.setValue(today);\
  app.sdate.setValue(new Date());\
  app.edate.setValue(new Date());\
  app.cboY.setVisible(false);\
  app.cboM.setVisible(false);\
  app.cboM.setValue(\"\");\
  app.sdate.setVisible(false);\
  app.edate.setVisible(false);\
}"}
         },
         {
          "configs": {
           "itemId": "radioS",
           "boxLabel": "按时间段",
           "flex": "1",
           "name": "radioMD"
          },
          "expanded": false,
          "children": [],
          "type": "radio",
          "events": {"change": "if (newValue) {\
  var today = new Date(); //获取当前日期\
  var days = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate(); //获取当前月份天数\
  app.date1.setVisible(true);\
  app.date1.setValue(today);\
  app.sdate.setValue(new Date());\
  app.edate.setValue(new Date());\
  app.cboY.setVisible(false);\
  app.cboM.setVisible(false);\
  app.cboM.setValue(\"\");\
  app.sdate.setVisible(true);\
  app.edate.setVisible(true);\
  app.date1.setVisible(false);\
}"}
         }
        ],
        "type": "container"
       },
       {
        "configs": {
         "itemId": "cboY",
         "allowBlank": "false",
         "emptyText": "年",
         "width": "60",
         "displayField": "YEAR",
         "valueField": "ID",
         "forceSelection": "false"
        },
        "expanded": false,
        "children": [],
        "type": "combo",
        "events": {"select": "if (app.radioM.checked) {\
  var year = app.cboY.getValue();\
  var month = app.cboM.getValue();\
  var sdate = new Date(year + \"-\" + month + \"-01\");\
  app.sdate.setValue(sdate);\
  var days = new Date(year, month, 0).getDate(); //获取当前月份天数\
  var edate = new Date(year + \"-\" + month + \"-\" + days);\
  app.edate.setValue(edate);\
}\
if (app.radioD.checked) {\
  var date = new Date();\
  var year = app.cboY.getValue();\
  var month = date.getMonth() + 1;\
  var sdate = new Date(year + \"-\" + month + \"-\" + app.cboD.getValue());\
  app.sdate.setValue(sdate);\
  var edate = new Date(year + \"-\" + month + \"-\" + app.cboD.getValue());\
  app.edate.setValue(edate);\
}"}
       },
       {
        "configs": {
         "itemId": "cboM",
         "allowBlank": "false",
         "pickList": "[\
  [1, \"1月\"],\
  [2, \"2月\"],\
  [3, \"3月\"],\
  [4, \"4月\"],\
  [5, \"5月\"],\
  [6, \"6月\"],\
  [7, \"7月\"],\
  [8, \"8月\"],\
  [9, \"9月\"],\
  [10, \"10月\"],\
  [11, \"11月\"],\
  [12, \"12月\"]\
]",
         "emptyText": "月",
         "width": "50",
         "forceSelection": "true"
        },
        "expanded": false,
        "children": [],
        "type": "combo",
        "events": {"select": "var year = app.cboY.getValue();\
var month = combo.getValue();\
var sdate = new Date(year + \"-\" + month + \"-01\");\
app.sdate.setValue(sdate);\
var days = new Date(year, month, 0).getDate(); //获取当前月份天数\
var edate = new Date(year + \"-\" + month + \"-\" + days);\
app.edate.setValue(edate);"}
       },
       {
        "configs": {
         "itemId": "date1",
         "allowBlank": "false",
         "width": "90"
        },
        "expanded": false,
        "children": [],
        "type": "date",
        "events": {"select": "app.sdate.setValue(value);\
app.edate.setValue(value);"}
       },
       {
        "configs": {
         "itemId": "sdate",
         "allowBlank": "false",
         "hidden": "true",
         "labelAlign": "right",
         "fieldLabel": "开始时间",
         "width": "175",
         "labelWidth": "70"
        },
        "expanded": false,
        "children": [],
        "type": "date"
       },
       {
        "configs": {
         "itemId": "edate",
         "allowBlank": "false",
         "hidden": "true",
         "labelAlign": "right",
         "fieldLabel": "结束时间",
         "width": "175",
         "labelWidth": "80"
        },
        "expanded": false,
        "children": [],
        "type": "date"
       },
       {
        "configs": {
         "tagConfigs": " matchFieldWidth:false",
         "pageSize": "50",
         "selectOnTab": "true",
         "labelWidth": "40",
         "listConfig": "{width:450}",
         "valueField": "ID",
         "queryDelay": "500",
         "hideTrigger": "true",
         "itemId": "CUSTOM",
         "tpl": "<table cellspacing='0' width='100%'>\
   <tr  >\
      <td width='5px'>\
      代码\
      <\/td>\
      <td>\
       名称\
      <\/td>\
       <td>\
       税号\
      <\/td>\
    <\/tr>\
  <tpl for='.'>\
    <tr class='x-boundlist-item' >\
      <td >\
        {ID}\
      <\/td>\
      <td>\
       {CNAME}\
      <\/td>\
       <td>\
       {GOV_CODE}\
      <\/td>\
    <\/tr>\
  <\/tpl>\
<\/table>",
         "labelAlign": "right",
         "fieldLabel": "客户",
         "width": "220",
         "x": "200",
         "y": "67",
         "displayField": "CNAME",
         "height": "22",
         "multiSelect": "true"
        },
        "expanded": false,
        "children": [{
         "configs": {
          "itemId": "store",
          "autoLoad": "true",
          "url": "m?xwl=feeManage/feeReport/other/clientSelect"
         },
         "expanded": false,
         "children": [],
         "type": "store"
        }],
        "type": "combo",
        "events": {"select": "var ids = \"\";\
for (var i = 0; i < records.length; i++) {\
  ids += \"'\" + records[i].data.ID + \"',\";\
}\
if (ids.length > 0) {\
  ids = ids.slice(0, ids.length - 1);\
} else {\
  ids = \"''\";\
}\
app.IDS.setValue(ids);"}
       },
       {
        "configs": {
         "tagConfigs": "matchFieldWidth: false",
         "labelWidth": "40",
         "listConfig": "{\
  width: 300\
}",
         "valueField": "ID",
         "queryDelay": "500",
         "itemId": "VID",
         "tpl": "<table cellspacing='0' width='100%'>\
  <tr>\
    <td>\
      船名\
    <\/td>\
    <td>\
      进出口\
    <\/td>\
  <\/tr>\
  <tpl for='.'>\
    <tr class='x-boundlist-item' >\
      <td >\
        {CNAME}\
      <\/td>\
      <td>\
        {I_E}\
      <\/td>\
    <\/tr>\
  <\/tpl>\
<\/table>",
         "labelAlign": "right",
         "fieldLabel": "船名",
         "x": "648",
         "width": "140",
         "y": "8",
         "displayField": "CNAME",
         "anyMatch": "true",
         "forceSelection": "true",
         "height": "22"
        },
        "expanded": false,
        "children": [{
         "configs": {
          "itemId": "store",
          "autoLoad": "false",
          "pageSize": "-1",
          "url": "m?xwl=feeManage/detail/getVoyageByDate"
         },
         "expanded": false,
         "children": [],
         "type": "store",
         "events": {"beforeload": "operation.params = {\
  rd: app.radioD.getValue(),\
  date: app.date1.getRawValue(),\
  query:app.VID.getValue()\
};"}
        }],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "cboI_E",
         "labelAlign": "right",
         "pickList": "[\
  [\"I\", \"进口\"],\
  [\"E\", \"出口\"]\
]",
         "fieldLabel": "进出口",
         "width": "130",
         "labelWidth": "50",
         "forceSelection": "true"
        },
        "expanded": false,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "cboTRADE",
         "labelAlign": "right",
         "pickList": "[\
  [\"1\", \"外贸\"],\
  [\"2\", \"内贸\"]\
]",
         "fieldLabel": "内外贸",
         "width": "130",
         "labelWidth": "50",
         "forceSelection": "true"
        },
        "expanded": false,
        "children": [],
        "type": "combo"
       }
      ],
      "type": "toolbar"
     },
     {
      "configs": {
       "itemId": "tbar2",
       "enableOverflow": "true",
       "region": "north"
      },
      "expanded": true,
      "children": [
       {
        "configs": {
         "itemId": "cboBilltype",
         "labelAlign": "right",
         "fieldLabel": "包装类型",
         "keyName": "BILL_TYPE",
         "width": "140",
         "labelWidth": "60",
         "forceSelection": "true"
        },
        "expanded": false,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "cboSettleStatus",
         "labelAlign": "right",
         "pickList": "[\
  [\"0\", \"未结算\"],\
  [\"1\", \"已结算\"],\
  [\"2\", \"已开票\"],\
  [\"3\", \"部分开票\"]\
]",
         "fieldLabel": "结算状态",
         "width": "140",
         "labelWidth": "60",
         "forceSelection": "true"
        },
        "expanded": false,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "cboPayType",
         "labelAlign": "right",
         "pickList": "[\
  [\"1\", \"现金\"],\
  [\"2\", \"月结\"]\
]",
         "fieldLabel": "付款类型",
         "width": "140",
         "labelWidth": "65",
         "forceSelection": "true"
        },
        "expanded": false,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "cboYTline",
         "labelAlign": "right",
         "pickList": "[\
  [\"1\", \"盐田线\"],\
  [\"2\", \"非盐田线\"]\
]",
         "fieldLabel": "盐田非盐田",
         "width": "160",
         "labelWidth": "73",
         "forceSelection": "true"
        },
        "expanded": false,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "transittype",
         "labelAlign": "right",
         "fieldLabel": "贸易方式",
         "keyName": "TRANSIT",
         "width": "150",
         "labelWidth": "60",
         "forceSelection": "true"
        },
        "expanded": false,
        "children": [],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "cboFeeList",
         "labelAlign": "right",
         "fieldLabel": "费目",
         "width": "160",
         "displayField": "DESCRIPTION",
         "labelWidth": "40",
         "valueField": "ID",
         "forceSelection": "true"
        },
        "expanded": false,
        "children": [{
         "configs": {
          "itemId": "store",
          "autoLoad": "true",
          "pageSize": "-1",
          "url": "m?xwl=feeManage/feeReport/other/feelistquery"
         },
         "expanded": false,
         "children": [],
         "type": "store"
        }],
        "type": "combo"
       },
       {
        "configs": {
         "itemId": "IDS",
         "hidden": "true"
        },
        "expanded": false,
        "children": [],
        "type": "text"
       }
      ],
      "type": "toolbar"
     },
     {
      "configs": {
       "itemId": "tbar3",
       "enableOverflow": "true",
       "region": "north"
      },
      "expanded": true,
      "children": [
       {
        "configs": {
         "tagConfigs": " matchFieldWidth:false",
         "pageSize": "50",
         "selectOnTab": "true",
         "labelWidth": "55",
         "listConfig": "{width:450}",
         "valueField": "ID",
         "queryDelay": "500",
         "hideTrigger": "true",
         "itemId": "CNTR_OPERATOR_COD",
         "tpl": "<table cellspacing='0' width='100%'>\
   <tr  >\
      <td width='5px'>\
      代码\
      <\/td>\
      <td>\
       名称\
      <\/td>\
       <td>\
       税号\
      <\/td>\
    <\/tr>\
  <tpl for='.'>\
    <tr class='x-boundlist-item' >\
      <td >\
        {ID}\
      <\/td>\
      <td>\
       {CNAME}\
      <\/td>\
       <td>\
       {GOV_CODE}\
      <\/td>\
    <\/tr>\
  <\/tpl>\
<\/table>",
         "labelAlign": "right",
         "fieldLabel": "船公司",
         "width": "220",
         "x": "200",
         "y": "67",
         "displayField": "CNAME",
         "height": "22",
         "multiSelect": "true"
        },
        "expanded": true,
        "children": [{
         "configs": {
          "itemId": "store",
          "autoLoad": "true",
          "params": "{fldId:'AG'}",
          "url": "m?xwl=system/common/client/clientSelect"
         },
         "expanded": false,
         "children": [],
         "type": "store"
        }],
        "type": "combo",
        "events": {"select": "var ids = \"\";\
for (var i = 0; i < records.length; i++) {\
  ids += \"'\" + records[i].data.ID + \"',\";\
}\
if (ids.length > 0) {\
  ids = ids.slice(0, ids.length - 1);\
} else {\
  ids = \"''\";\
}\
app.IDS.setValue(ids);"}
       },
       {
        "configs": {
         "itemId": "selBtn",
         "text": "查询",
         "iconCls": "search_icon"
        },
        "expanded": true,
        "children": [],
        "type": "item",
        "events": {"click": "// if (!Wb.verify(app.tbarGrid))\
//   return;\
var AF1 = document.getElementById(opt);\
AF1.func(\"SetCurrentWorkSheet\", \"0\");\
var sheetIndex = AF1.func(\"GetCurrentWorksheet\", \"\");\
var whereSql = \"\";\
//代收代支数据源sql\
var whereSql1 = \"\";\
//船公司数据源\
var whereSql2 = \"\";\
if (Wb.isEmpty(app.VID.getValue())) {\
  whereSql += encodeURI(\" and ACCOUNTS_DETAILS.JOB_FINISH_DATE>=to_date('\" + app.sdate.getRawValue() + \" 00:00:00','yyyy-mm-dd hh24:mi:ss')\" +\
    \" and ACCOUNTS_DETAILS.JOB_FINISH_DATE<=to_date('\" + app.edate.getRawValue() + \" 23:59:59','yyyy-mm-dd hh24:mi:ss')\");\
  whereSql1 += encodeURI(\" and PAYMENT_ON>=to_date('\" + app.sdate.getRawValue() + \" 00:00:00','yyyy-mm-dd hh24:mi:ss')\" +\
    \" and PAYMENT_ON<=to_date('\" + app.edate.getRawValue() + \" 23:59:59','yyyy-mm-dd hh24:mi:ss')\");\
  whereSql2 += encodeURI(\" and JOB_FINISH_DATE>=to_date('\" + app.sdate.getRawValue() + \" 00:00:00','yyyy-mm-dd hh24:mi:ss')\" +\
    \" and JOB_FINISH_DATE<=to_date('\" + app.edate.getRawValue() + \" 23:59:59','yyyy-mm-dd hh24:mi:ss')\");\
}\
if (!Wb.isEmpty(app.CUSTOM.getValue())) {\
  //   whereSql += \" and PAYMENT_CUSTOMER_CODE = '\" + app.CUSTOM.getValue() + \"'  \";\
  whereSql += \" and PAYMENT_CUSTOMER_CODE IN(\" + app.IDS.getValue() + \")  \";\
  whereSql1 += \" and (PAYMENT_CUSTOMER_ID='\" + app.CUSTOM.getValue() + \"' or PROXY_CUSTOMER_ID='\" + app.CUSTOM.getValue() + \"')\";\
  whereSql2 += \" and PAYMENT_CUSTOMER_CODE IN(\" + app.IDS.getValue() + \")  \";\
}\
if (!Wb.isEmpty(app.CNTR_OPERATOR_COD.getValue())) {\
  //   whereSql += \" and PAYMENT_CUSTOMER_CODE = '\" + app.CUSTOM.getValue() + \"'  \";\
  whereSql += \" and CNTR_OPERATOR_COD ='\" + app.CNTR_OPERATOR_COD.getValue() + \"'  \";\
  whereSql1 += \" and 1=1 \";\
  whereSql2 += \" and CNTR_OPERATOR_COD ='\" + app.CNTR_OPERATOR_COD.getValue() + \"'  \";\
}\
if (!Wb.isEmpty(app.VID.getValue())) {\
  whereSql += \" and vid='\" + app.VID.getValue() + \"'\";\
  whereSql2 += \" and vid='\" + app.VID.getValue() + \"'\";\
}\
if (!Wb.isEmpty(app.cboI_E.getValue())) {\
  whereSql += \" and i_e_id='\" + app.cboI_E.getValue() + \"'\";\
  whereSql2 += \" and i_e_id='\" + app.cboI_E.getValue() + \"'\";\
  whereSql1 += \" and 1=2\";\
}\
if (!Wb.isEmpty(app.cboTRADE.getValue())) {\
  whereSql += \" and trade_id='\" + app.cboTRADE.getValue() + \"'\";\
  whereSql2 += \" and trade_id='\" + app.cboTRADE.getValue() + \"'\";\
  whereSql1 += \" and 1=2\";\
}\
if (!Wb.isEmpty(app.cboSettleStatus.getValue())) {\
  whereSql += \" and SETTLE_STATUS=\" + app.cboSettleStatus.getValue() + \"\";\
  whereSql2 += \" and SETTLE_STATUS=\" + app.cboSettleStatus.getValue() + \"\";\
  whereSql1 += \" and 1=2\";\
}\
if (!Wb.isEmpty(app.cboPayType.getValue())) {\
  whereSql += \" and PAYMENT_TYPE='\" + app.cboPayType.getValue() + \"'\";\
  whereSql2 += \" and PAYMENT_TYPE='\" + app.cboPayType.getValue() + \"'\";\
  whereSql1 += \" and 1=2\";\
}\
\
if (!Wb.isEmpty(app.cboBilltype.getValue())) {\
  whereSql += \" and BILL_TYPE='\" + app.cboBilltype.getValue() + \"'\";\
  whereSql2 += \" and BILL_TYPE='\" + app.cboBilltype.getValue() + \"'\";\
  whereSql1 += \" and 1=2\";\
}\
\
if (!Wb.isEmpty(app.transittype.getValue())) {\
  whereSql += \" and TRANSIT='\" + app.transittype.getValue() + \"'\";\
  whereSql2 += \" and TRANSIT='\" + app.transittype.getValue() + \"'\";\
  whereSql1 += \" and 1=2\";\
}\
\
if (!Wb.isEmpty(app.cboFeeList.getValue())) {\
  whereSql += \" and FEE_LIST_ID='\" + app.cboFeeList.getValue() + \"'\";\
  whereSql2 += \" and FEE_LIST_ID='\" + app.cboFeeList.getValue() + \"'\";\
  whereSql1 += \" and 1=2\";\
}\
\
if (!Wb.isEmpty(app.cboYTline.getValue())) {\
  if (app.cboYTline.getValue()==1){\
    whereSql += encodeURI(\" and  voyage='中山-深圳东'\");\
    whereSql2 += encodeURI(\" and voyage='中山-深圳东'\");\
    whereSql1 += \" and 1=2\";\
\
  }\
  else\
  {\
    whereSql += encodeURI(\" and  nvl(voyage,'www')<>'中山-深圳东'\");\
    whereSql2 += encodeURI( \" and nvl(voyage,'www')<>'中山-深圳东'\");\
    whereSql1 += \" and 1=2\";   \
  }\
}\
\
\
mainConditionSql = whereSql;\
AF1.func(\"SetParas\", \"ds1 \\r\\
 para=1;whereSql=\" + mainConditionSql + \";ee333e=\" + new Date() + \";tenancyId=\" + '{#sys.TENANCY_ID#}');\
AF1.func(\"SetParas\", \"ds3 \\r\\
 para=1;whereSql=\" + whereSql1 + \";ee333e=\" + new Date() + \";tenancyId=\" + '{#sys.TENANCY_ID#}');\
AF1.func(\"SetParas\", \"ds4 \\r\\
 para=1;whereSql=\" + whereSql2 + \";ee333e=\" + new Date() + \";tenancyId=\" + '{#sys.TENANCY_ID#}');\
// alert(Wb.format(app.date1.getValue(),'Y'+\"年\"+'m'+\"月\"+'d'+\"天\"));\
if (app.radioD.getValue() == 1) {\
  AF1.func(\"SetCellData\", \"B2  \\r\\
 \" + Wb.format(app.date1.getValue(), 'Y' + \"年\" + 'm' + \"月\" + 'd' + \"日\") + \" 货柜及拼柜收费通知单\");\
}\
if (app.radioM.getValue() == 1) {\
//   AF1.func(\"SetCellData\", \"B2  \\r\\
 2017 年 \" + app.cboM.getValue() + \" 月份货柜及拼柜收费通知单\");\
  AF1.func(\"SetCellData\", \"B2  \\r\\
 2017 年 \" + app.cboM.getValue() + \" 月份收费通知单\");\
}\
// AF1.func(\"SetCellData\", \"<data B3='托运单位:\" + app.CUSTOM.getRawValue() + \"'   F6='\" + '{#sys.dispname#}' + \"'  F7='\" + Wb.dateToText(new Date(), 'yyyy-mm-dd') + \"'/> \");\
AF1.func(\"SetCellData\", \"<data B3='托运单位:\" + app.CUSTOM.getRawValue() + \"'   F7='\" + '{#sys.dispname#}' + \"'  F8='\" + Wb.dateToText(new Date(), 'yyyy-mm-dd') + \"'/> \");\
AF1.func(\"Calc\", \"range=current\");\
AF1.func(\"Calc\", \"range=\" + (sheetIndex + 1) + \"\t\");"}
       },
       {
        "configs": {
         "itemId": "backBtn",
         "text": "返回",
         "iconCls": "first_icon"
        },
        "expanded": false,
        "children": [],
        "type": "item",
        "events": {"click": "// if (!Wb.verify(app.tbarGrid))\
//   return;\
var AF1 = document.getElementById(opt);\
var sheetIndex = AF1.func(\"GetCurrentWorksheet\", \"\");\
// if (sheetIndex > 0) {\
//   AF1.func(\"SetCurrentWorkSheet\", (sheetIndex - 1) + \"\");\
// }\
if (sheetIndex > 0) {\
  AF1.func(\"SetCurrentWorkSheet\", \"0\");\
}"}
       }
      ],
      "type": "toolbar"
     },
     {
      "configs": {
       "layout": "absolute",
       "border": "false",
       "itemId": "panelAcc",
       "region": "center",
       "height": "350"
      },
      "expanded": true,
      "children": [],
      "type": "panel"
     }
    ],
    "type": "panel"
   }],
   "type": "viewport",
   "events": {
    "afterrender": "var mt1 = bldStr(\"LuxForm\", opt, '', \"100%\");\
app.panelAcc.update(mt1);",
    "destroy": "delete  window[\"init\" + opt];\
"
   }
  }],
  "type": "module",
  "events": {
   "finalize": "var ms = Wb.decode(\"{#feeList#}\");\
var tenancyid = \"{#sys.TENANCY_ID#}\";\
// var colse=Wb.find(ms, 'ITEM_ID', \"8f46baa3ffbf4091b05c069a1af4c793\");\
// alert(colse.NAME+\"==\"+colse.PATH);\
window[\"init\" + opt] = function(id) {\
  var m = document.getElementById(opt);\
  var s = Math.random();\
  if (id == opt) {\
    m.func(\"setCookie\", \"JSESSIONID={#JSESSIONID#}\");\
    m.func(\"callfunc\", \"4\");\
    m.func(\"SubscribeEvent\", \"Clicked\"); //预订鼠标点击事件\
    m.func(\"Build\", '/supcan/report/fee/customeFeeMonthTestVersion1111.xml?' + Math.round(Math.random() * 100));\
    m.func(\"DisableMenu\", \"showRuler,exportAll,printAll,delete,insert,import ,curselMode,hue ,language , enter    \\r\\
 true\");\
    m.func(\"SetSource\", \"m?xwl=system/common/report/reportTemplate/dataSource&\" + Math.random() * 1000);\
  }\
};\
window[\"event\" + opt] = function(id, Event, p1, p2, p3, p4) {\
  var AF = document.getElementById(opt);\
  if (Event == 'WorkSheetSelChanged' && p2 == 0) {\
    if (p1 == 0) {\
      AF.func(\"DeleteWorksheet\", \"2\");\
      if (AF.func(\"GetSources\", \"\").indexOf(\"ds2\"))\
        AF.func(\"DeleteDS\", \"ds2\");\
    }\
\
  } else if (Event != \"Clicked\")\
    return;\
  console.log(p3);\
  var sheetIndex = AF.func(\"GetCurrentWorksheet\", \"\");\
  if (sheetIndex == 0) { //第一个工作表的事件\
    //过滤 \"科目代码\" 超链接以外的事件\
    if (p4 != \"HID\") return;\
    var arr = p3.split(\"@\");\
    var sheetName = Wb.find(ms, ['ITEM_ID'], arr[0]);\
    console.log(sheetName);\
    if (sheetName == null) {\
      //针对费用报表维护的内外贸为空的情况\
      sheetName = Wb.find(ms, ['ITEM_ID_S'], (arr[0] + \"-\" + arr[2]));\
      console.log(sheetName);\
    } else if (sheetName.TRADE_ID != arr[2] && sheetName.TRADE_ID != \"\") {\
      //针对费用报表维护中--内外贸都有维护的情况\
      sheetName = Wb.find(ms, ['ITEM_ID_S'], (arr[0] + \"-\" + arr[2]));\
    }\
    console.log(\"sheetName.PATH:\" + sheetName.PATH);\
    //     if (sheetName.TRADE_ID != arr[2]) {\
    //       sheetName = Wb.find(ms, ['ITEM_ID_S'], (arr[0] + \"-\" + arr[2]));\
    //     }\
    //             console.log(arr);\
    //     var sheetName = Wb.find(ms, ['ITEM_ID'], (arr[0] + \"-\" + arr[2]));\
    //         console.log(sheetName);\
    //         alert(sheetName.PATH );\
    //切换到第二个工作表：明细表\
    AF.func(\"appendWorksheet\", sheetName.PATH + \" \\r\\
 sheetName=222222; isOpenDialog=true\");\
    //     AF.func(\"SetWorksheetName\", \"1 \\r\\
\" + sheetName.ITEM_NAME);\
    AF.func(\"SetWorksheetName\", \"2 \\r\\
\" + sheetName.ITEM_NAME);\
    AF.func(\"SetCellData\", \"A1 \\r\\
\" + sheetName.ITEM_NAME + \"明细账\");\
    //     AF.func(\"SetCurrentWorkSheet\", \"1\");\
\
    //    //修改标题 (别名是 \"title\" 的单元格)， 以及期初余额 (别名是 \"qcye\" 的单元格)\
    //    AF.func(\"SetCellData\", \"title \\r\\
\" + p3 + \"-\" + kmmc + \"明细账\");\
    //    AF.func(\"SetCellData\", \"qcye \\r\\
\" + qcye);\
    //var whereSql = \" and rownum<2 \";\
    /*var whereSql = \" and JOB_FINISH_DATE>=to_date('\" + app.sdate.getRawValue() + \" 00:00:00','yyyy-mm-dd hh24:mi:ss')\" +\
      \" and JOB_FINISH_DATE<=to_date('\" + app.edate.getRawValue() + \" 23:59:59','yyyy-mm-dd hh24:mi:ss')\";\
    if (!Wb.isEmpty(app.CUSTOM.getValue())) {\
      whereSql += \" and PAYMENT_CUSTOMER_CODE = '\" + app.CUSTOM.getValue() + \"'\";\
    }*/\
    var whereSql = \" and accounts_details.FEE_LIST_ID='\" + arr[0] + \"'\" +\
      \" and accounts_details.I_E_ID='\" + arr[1] + \"' and accounts_details.TENANCY_ID='\" + tenancyid + \"' and accounts_details.TRADE_ID='\" + arr[2] + \"'\" +\
      \" and accounts_details.JOB_FINISH_DATE>=to_date('\" + app.sdate.getRawValue() + \" 00:00:00','yyyy-mm-dd hh24:mi:ss')\" +\
      \" and accounts_details.JOB_FINISH_DATE<=to_date('\" + app.edate.getRawValue() + \" 23:59:59','yyyy-mm-dd hh24:mi:ss')\";\
    if (!Wb.isEmpty(app.cboTRADE.getValue()))\
      whereSql += \" and accounts_details.trade_id = '\" + app.cboTRADE.getValue() + \"'\";\
    //     if (!Wb.isEmpty(app.CUSTOM.getValue()))\
    //       whereSql += \" and accounts_details.PAYMENT_CUSTOMER_CODE = '\" + app.CUSTOM.getValue() + \"'\";\
    if (!Wb.isEmpty(app.CUSTOM.getValue()))\
      whereSql += \" and PAYMENT_CUSTOMER_CODE IN(\" + app.IDS.getValue() + \")  \";\
    if (!Wb.isEmpty(app.cboSettleStatus.getValue()))\
      whereSql += \" and accounts_details.SETTLE_STATUS=\" + app.cboSettleStatus.getValue();\
    if (!Wb.isEmpty(app.cboPayType.getValue()))\
      whereSql += \" and PAYMENT_TYPE=\" + app.cboPayType.getValue();\
\
    if (!Wb.isEmpty(app.VID.getValue())) {\
      whereSql += \" and accounts_details.vid='\" + app.VID.getValue() + \"'\";\
    }\
    if (!Wb.isEmpty(app.CNTR_OPERATOR_COD.getValue())) {\
      whereSql += \" and accounts_details.CNTR_OPERATOR_COD='\" + app.CNTR_OPERATOR_COD.getValue() + \"'\";\
    }\
    if (!Wb.isEmpty(app.cboYTline.getValue())) {\
      if (app.cboYTline.getValue() == 1) {\
        whereSql += encodeURI(\" and   accounts_details.voyage='中山-深圳东'\");\
      } else {\
        whereSql += encodeURI(\" and  nvl( accounts_details.voyage,'www')<>'中山-深圳东'\");\
      }\
    }\
    //     if (arr[1] == 'I') {\
    //       var whereSql = \" and FEE_LIST_ID='\" + arr[0] + \"' and ad.TENANCY_ID='\" + tenancyid + \"' and to_char(ata,'yyyy-MM') ='\" + app.cboY.getValue() + \"-0\" + app.cboM.getValue() + \"'\";\
    //     } else {\
    //       var whereSql = \" and FEE_LIST_ID='\" + arr[0] + \"' and ad.TENANCY_ID='\" + tenancyid + \"' and to_char(atd,'yyyy-MM') ='\" + app.cboY.getValue() + \"-0\" + app.cboM.getValue() + \"'\";\
    //     }\
    AF.func(\"SetParas\", \"ds2 \\r\\
 para=1;whereSql=\" + whereSql + \";eeee=\" + new Date() + \";tenancyId=\" + tenancyid);\
    //动态设置参数：科目代码\
    //仅计算本工作表\
\
    AF.func(\"calc\", \"range=current\");\
  }\
  //处理第二个工作表的事件===========\
  else if (sheetIndex == 1) {\
    /*//滤除 \"凭证号\" 超链接以外的事件\
    if (p4 != \"TID\") return;\
    var arr = p3.split(\"@\");\
    var detailSql = \"\";\
    /*if (!Wb.isEmpty(app.CUSTOM.getValue())) {\
      detailSql += \" and PAYMENT_CUSTOMER_CODE = '\" + app.CUSTOM.getValue() + \"'\";\
    }*/\
    /*\
        detailSql = mainConditionSql + \" and FEE_LIST_ID='\" + arr[0] + \"'   and   I_E_ID='\" + arr[1] +\
          \"' and JOB_FINISH_DATE>=to_date('\" + arr[2] + \" 00:00:00','yyyy-mm-dd hh24:mi:ss')\" +\
          \" and JOB_FINISH_DATE<=to_date('\" + arr[2] + \" 23:59:59','yyyy-mm-dd hh24:mi:ss')\" +\
          \" and TENANCY_ID='{#sys.TENANCY_ID#}'\";\
        if (!Wb.isEmpty(arr[3])) {\
          detailSql += \" and vid='\" + arr[3] + \"'\";\
        }\
        /*if (!Wb.isEmpty(app.cboTRADE.getValue()))\
          detailSql += \" and trade_id = '\" + app.cboTRADE.getValue() + \"'\";*/\
    //切换到第三个工作表 (凭证)\
    if (p4 != \"TID\") return;\
    var detailSql = \"\";\
    var arr = p3.split('-');\
    detailSql = encodeURI(\" and ACCOUNTS_DETAILS.JOB_FINISH_DATE>=to_date('\" + app.sdate.getRawValue() + \" 00:00:00','yyyy-mm-dd hh24:mi:ss')\" +\
      \" and ACCOUNTS_DETAILS.JOB_FINISH_DATE<=to_date('\" + app.edate.getRawValue() + \" 23:59:59','yyyy-mm-dd hh24:mi:ss')\");\
    if (!Wb.isEmpty(app.cboI_E.getValue())) {\
      detailSql += \" and i_e_id='\" + app.cboI_E.getValue() + \"'\";\
    }\
    if (!Wb.isEmpty(app.cboTRADE.getValue())) {\
      detailSql += \" and trade_id='\" + app.cboTRADE.getValue() + \"'\";\
    }\
    if (!Wb.isEmpty(app.cboSettleStatus.getValue())) {\
      detailSql += \" and SETTLE_STATUS=\" + app.cboSettleStatus.getValue() + \"\";\
    }\
    if (!Wb.isEmpty(app.cboPayType.getValue())) {\
      detailSql += \" and PAYMENT_TYPE=\" + app.cboPayType.getValue() + \"\";\
    }\
    if (!Wb.isEmpty(app.VID.getValue())) {\
      detailSql += \" and vid='\" + app.VID.getValue() + \"'\";\
    }\
    if (!Wb.isEmpty(app.cboBilltype.getValue())) {\
      detailSql += \" and BILL_TYPE='\" + app.cboBilltype.getValue() + \"'\";\
    }\
    if (!Wb.isEmpty(app.cboYTline.getValue())) {\
      if (app.cboYTline.getValue() == 1) {\
        detailSql += encodeURI(\" and  voyage='中山-深圳东'\");\
      } else {\
        detailSql += encodeURI(\" and  nvl(voyage,'www')<>'中山-深圳东'\");\
      }\
    }\
    if (!Wb.isEmpty(app.cboFeeList.getValue())) {\
      detailSql += \" and FEE_LIST_ID='\" + app.cboFeeList.getValue() + \"'\";\
    }\
    app.CUSTOM.setValue(arr[0]);\
    app.IDS.setValue(\"'\" + arr[0] + \"'\");\
    app.CUSTOM.focus();\
    app.CUSTOM.store.load({\
      params: {\
        query: arr[0]\
      }\
    });\
    //     Wb.select(app.CUSTOM,arr[0]);\
    detailSql += \" and PAYMENT_CUSTOMER_CODE IN('\" + arr[0] + \"') \";\
    AF.func(\"SetCurrentWorkSheet\", \"0\");\
\
    //为别名为 \"pzh\" 的单元格 (B2) 赋值\
    AF.func(\"SetParas\", \"ds1 \\r\\
 para=1;whereSql=\" + detailSql + \" ;eeee=\" + new Date() + \";tenancyId=\" + '{#sys.TENANCY_ID#}');\
    //仅计算本工作表\
    AF.func(\"calc\", \"range=0\");\
  }\
  //处理第三个工作表的事件===========\
  else if (sheetIndex == 2) {\
    //切换到第四个工作表 (舱单数据)\
    if (p4 != \"TID\") return;\
    var detailSql = \"\";\
    var arr = p3.split('-');\
    detailSql = encodeURI(\" and ACCOUNTS_DETAILS.JOB_FINISH_DATE>=to_date('\" + app.sdate.getRawValue() + \" 00:00:00','yyyy-mm-dd hh24:mi:ss')\" +\
      \" and ACCOUNTS_DETAILS.JOB_FINISH_DATE<=to_date('\" + app.edate.getRawValue() + \" 23:59:59','yyyy-mm-dd hh24:mi:ss')\");\
    if (!Wb.isEmpty(app.cboI_E.getValue())) {\
      detailSql += \" and i_e_id='\" + app.cboI_E.getValue() + \"'\";\
    }\
    if (!Wb.isEmpty(app.cboTRADE.getValue())) {\
      detailSql += \" and trade_id='\" + app.cboTRADE.getValue() + \"'\";\
    }\
    if (!Wb.isEmpty(app.cboSettleStatus.getValue())) {\
      detailSql += \" and SETTLE_STATUS=\" + app.cboSettleStatus.getValue() + \"\";\
    }\
    if (!Wb.isEmpty(app.cboPayType.getValue())) {\
      detailSql += \" and PAYMENT_TYPE=\" + app.cboPayType.getValue() + \"\";\
    }\
    detailSql += \" and PAYMENT_CUSTOMER_CODE IN('\" + arr[0] + \"') \";\
    AF.func(\"SetCurrentWorkSheet\", \"0\");\
\
    //为别名为 \"pzh\" 的单元格 (B2) 赋值\
    AF.func(\"SetParas\", \"ds1 \\r\\
 para=1;whereSql=\" + detailSql + \" ;eeee=\" + new Date() + \";tenancyId=\" + '{#sys.TENANCY_ID#}');\
    //仅计算本工作表\
    AF.func(\"calc\", \"range=0\");\
  }\
};\
//==============时间控件的处理=============\
var yearjson = \"[]\";\
var years = eval('(' + yearjson + ')');\
for (var i = 2016; i <= 2050; i++) {\
  var year = {\
    \"ID\": i,\
    \"YEAR\": i\
  };\
  years.push(year);\
}\
var d = new Date();\
app.cboM.setValue(d.getMonth() + 1);\
//定义一个Store,绑定数据\
var yearStore = Ext.create('Ext.data.Store', {\
  fields: ['ID', 'YEAR'],\
  data: years\
});\
//combo通过代码绑定Stroe\
app.cboY.bindStore(yearStore);\
var today = new Date(); //获取当前日期\
app.cboY.setValue(today.getFullYear());\
// var d = new Date(today.getFullYear(), today.getMonth() + 1, 0); //获取当前月份天数\
// app.sdate.setValue(new Date(today.getTime() - (d.getDate() - 1) * 24 * 3600 * 1000));\
// app.edate.setValue(today);\
if (app.radioM.checked) {\
  app.cboM.setVisible(true);\
  app.date1.setVisible(false);\
}\
\
var year = app.cboY.getValue();\
var month = app.cboM.getValue();\
var sdate = new Date(year + \"-\" + month + \"-01\");\
app.sdate.setValue(sdate);\
var days = new Date(year, month, 0).getDate(); //获取当前月份天数\
var edate = new Date(year + \"-\" + month + \"-\" + days);\
app.edate.setValue(edate);",
   "initialize": "var opt = Wb.getId();\
var mainConditionSql = \"\";"
  }
 }],
 "roles": {
  "JCB": 1,
  "SWB": 1
 },
 "title": "所有客户费用明细",
 "iconCls": "",
 "inframe": false,
 "pageLink": ""
}