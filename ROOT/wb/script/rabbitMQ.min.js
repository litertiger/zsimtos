!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.RabbitMQ=void 0;var i=n(1),o=r(i);t.RabbitMQ=o.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){if(console.log(e.client.ws),3==e.client.ws.readyState){e.client._cleanUp();var t=e.client.debug,n=e.client.onreceive,r=new WebSocket(e.url);e.client=c.default.over(r),e.client.debug=t,e.client.onreceive=n,e.client.connect(e.usr,e.passwd,function(){console.log("reconnect to "+e.url);var t=e.subCallBack;e.subCallBack={};for(var n in t)e.subscribe(n,t[n].callback)},function(){return console.log("error")},e.host),r.onclose=function(){return o(e)},console.log(e.client.ws)}}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(2),c=r(u),a=function(){function e(t,n,r,s){var u=this;i(this,e),this.url=t,this.usr=n,this.passwd=r,this.host=s;var a=new WebSocket(t);this.rpcCallBack={},this.subCallBack={},this.client=c.default.over(a),this.client.connect(n,r,function(){console.log("connect to "+t),u.connected=!0,u.onConnected&&u.onConnected()},function(){console.log("error"),u.onError&&u.onError()},s),this.count=1,this.onreceive=function(e){var t=null;e.headers.rpc_id&&(t=u.rpcCallBack[e.headers.rpc_id])?(t(e),delete u.rpcCallBack[e.headers.rpc_id]):(console.log("unhandled message:"),console.log(e))},a.onclose=function(){return o(u)}}return s(e,[{key:"subscribe",value:function(e,t){var n=this.client.subscribe(e,t);return n.destination=e,this.subCallBack[e]={callback:t,id:n.id},n}},{key:"unsubscribe",value:function(e){var t=this.subCallBack[e];t&&(this.client.unsubscribe(t.id),delete this.subCallBack[e])}},{key:"send",value:function(e,t){return this.client.send(e,null,t)}},{key:"call",value:function(e,t,n){var r={"reply-to":"/temp-queue/rpc",rpc_id:this.count};return this.rpcCallBack[this.count++]=n,this.client.send(e,r,t)}},{key:"debug",set:function(e){this.client.debug=e}},{key:"onreceive",set:function(e){this.client.onreceive=e}}]),e}();t.default=a},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r,i,o,s,u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a={}.hasOwnProperty,l=[].slice;r={LF:"\n",NULL:"\0"},o=function(){function e(e){var n,i,o,s,u,c,a,l,f,h,d,b,p,g,v,y,m;for(s=e.search(RegExp(""+r.LF+r.LF)),u=e.substring(0,s).split(r.LF),o=u.shift(),c={},b=function(e){return e.replace(/^\s+|\s+$/g,"")},y=u.reverse(),p=0,v=y.length;p<v;p++)h=y[p],l=h.indexOf(":"),c[b(h.substring(0,l))]=b(h.substring(l+1));if(n="",d=s+2,c["content-length"])f=parseInt(c["content-length"]),n=(""+e).substring(d,d+f);else for(i=null,a=g=d,m=e.length;(d<=m?g<m:g>m)&&(i=e.charAt(a),i!==r.NULL);a=d<=m?++g:--g)n+=i;return new t(o,c,n)}var t=function(){function t(e,r,i){n(this,t),this.command=e,this.headers=null!=r?r:{};try{if("MESSAGE"===e&&"string"==typeof i&&/^\s*(\{.*\}|\[.*\])\s*$/.test(i)){var o=JSON.parse(i);o&&(i=o)}}catch(e){}this.body=null!=i?i:""}return c(t,[{key:"toString",value:function(){var e,n,i,o,s;e=[this.command],i=this.headers["content-length"]===!1,i&&delete this.headers["content-length"],s=this.headers;for(n in s)a.call(s,n)&&(o=s[n],e.push(""+n+":"+o));var c=this.body;return c&&"object"===("undefined"==typeof c?"undefined":u(c))&&(c=JSON.stringify(c)),c&&!i&&e.push("content-length:"+t.sizeOfUTF8(c)),e.push(r.LF+c),e.join(r.LF)}}],[{key:"sizeOfUTF8",value:function(e){return e?encodeURI(e).match(/%..|./g).length:0}},{key:"unmarshall",value:function(t){var n,i,o,s;return i=t.split(RegExp(""+r.NULL+r.LF+"*")),s={frames:[],partial:""},s.frames=function(){var t,r,o,s;for(o=i.slice(0,-1),s=[],t=0,r=o.length;t<r;t++)n=o[t],s.push(e(n));return s}(),o=i.slice(-1)[0],o===r.LF||o.search(RegExp(""+r.NULL+r.LF+"*$"))!==-1?s.frames.push(e(o)):s.partial=o,s}},{key:"marshall",value:function(e,n,i){var o;return o=new t(e,n,i),o.toString()+r.NULL}}]),t}();return t}(),i=function(){function e(){return Date.now?Date.now():(new Date).valueOf}var t=function(){function t(e){n(this,t),this.ws=e,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={},this.partialData="",this.debug=null}return c(t,[{key:"_transmit",value:function(e,t,n){var r;for(r=o.marshall(e,t,n),"function"==typeof this.debug&&this.debug(">>> "+r);;){if(!(r.length>this.maxWebSocketFrameSize))return this.ws.send(r);this.ws.send(r.substring(0,this.maxWebSocketFrameSize)),r=r.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+r.length)}}},{key:"_setupHeartbeat",value:function(e){var t,n,i,o,u,c;(u=e.version)!==s.VERSIONS.V1_1&&u!==s.VERSIONS.V1_2||(c=function(){var t,n,r,i;for(r=e["heart-beat"].split(","),i=[],t=0,n=r.length;t<n;t++)o=r[t],i.push(parseInt(o));return i}(),n=c[0],t=c[1],0!==this.heartbeat.outgoing&&0!==t&&(i=Math.max(this.heartbeat.outgoing,t),"function"==typeof this.debug&&this.debug("send PING every "+i+"ms"),this.pinger=s.setInterval(i,function(e){return function(){return e.ws.send(r.LF),"function"==typeof e.debug?e.debug(">>> PING"):void 0}}(this))),0!==this.heartbeat.incoming&&0!==n&&(i=Math.max(this.heartbeat.incoming,n),"function"==typeof this.debug&&this.debug("check PONG every "+i+"ms")))}},{key:"_parseConnect",value:function(){var e,t,n,r;switch(e=1<=arguments.length?l.call(arguments,0):[],r={},e.length){case 2:r=e[0],t=e[1];break;case 3:e[1]instanceof Function?(r=e[0],t=e[1],n=e[2]):(r.login=e[0],r.passcode=e[1],t=e[2]);break;case 4:r.login=e[0],r.passcode=e[1],t=e[2],n=e[3];break;default:r.login=e[0],r.passcode=e[1],t=e[2],n=e[3],r.host=e[4]}return[r,t,n]}},{key:"connect",value:function(){var t,n,i,u;return t=1<=arguments.length?l.call(arguments,0):[],u=this._parseConnect.apply(this,t),i=u[0],this.connectCallback=u[1],n=u[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(t){return function(i){var s,u,c,a,l,f,h,d,b,p,g,v,y;if(a="undefined"!=typeof ArrayBuffer&&i.data instanceof ArrayBuffer?(s=new Uint8Array(i.data),"function"==typeof t.debug?t.debug("--- got data length: "+s.length):void 0,function(){var e,t,n;for(n=[],e=0,t=s.length;e<t;e++)u=s[e],n.push(String.fromCharCode(u));return n}().join("")):i.data,t.serverActivity=e(),a===r.LF)return void("function"==typeof t.debug&&t.debug("<<< PONG"));for("function"==typeof t.debug&&t.debug("<<< "+a),b=o.unmarshall(t.partialData+a),t.partialData=b.partial,v=b.frames,y=[],p=0,g=v.length;p<g;p++)switch(l=v[p],l.command){case"CONNECTED":"function"==typeof t.debug&&t.debug("connected to server "+l.headers.server),t.connected=!0,t._setupHeartbeat(l.headers),y.push("function"==typeof t.connectCallback?t.connectCallback(l):void 0);break;case"MESSAGE":d=l.headers.subscription,h=t.subscriptions[d]||t.onreceive,h?(c=t,f=l.headers["message-id"],l.ack=function(e){return null==e&&(e={}),c.ack(f,d,e)},l.nack=function(e){return null==e&&(e={}),c.nack(f,d,e)},y.push(h(l))):y.push("function"==typeof t.debug?t.debug("Unhandled received MESSAGE: "+l):void 0);break;case"RECEIPT":y.push("function"==typeof t.onreceipt?t.onreceipt(l):void 0);break;case"ERROR":y.push("function"==typeof n?n(l):void 0);break;default:y.push("function"==typeof t.debug?t.debug("Unhandled frame: "+l):void 0)}return y}}(this),this.ws.onclose=function(e){return function(){var t;return t="Whoops! Lost connection to "+e.ws.url,"function"==typeof e.debug&&e.debug(t),e._cleanUp(),"function"==typeof n?n(t):void 0}}(this),this.ws.onopen=function(e){return function(){return"function"==typeof e.debug&&e.debug("Web Socket Opened..."),i["accept-version"]=s.VERSIONS.supportedVersions(),i["heart-beat"]=[e.heartbeat.outgoing,e.heartbeat.incoming].join(","),e._transmit("CONNECT",i)}}(this)}},{key:"disconnect",value:function(e,t){return null==t&&(t={}),this._transmit("DISCONNECT",t),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof e?e():void 0}},{key:"_cleanUp",value:function(){if(this.connected=!1,this.pinger&&s.clearInterval(this.pinger),this.ponger)return s.clearInterval(this.ponger)}},{key:"send",value:function(e,t,n){return null==t&&(t={}),null==n&&(n=""),t.destination=e,this._transmit("SEND",t,n)}},{key:"subscribe",value:function(e,t,n){var r;return null==n&&(n={}),n.id||(n.id="sub-"+this.counter++),n.destination=e,this.subscriptions[n.id]=t,this._transmit("SUBSCRIBE",n),r=this,{id:n.id,unsubscribe:function(){return r.unsubscribe(n.id)}}}},{key:"unsubscribe",value:function(e){return delete this.subscriptions[e],this._transmit("UNSUBSCRIBE",{id:e})}},{key:"begin",value:function(e){var t,n;return n=e||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:n}),t=this,{id:n,commit:function(){return t.commit(n)},abort:function(){return t.abort(n)}}}},{key:"commit",value:function(e){return this._transmit("COMMIT",{transaction:e})}},{key:"abort",value:function(e){return this._transmit("ABORT",{transaction:e})}},{key:"ack",value:function(e,t,n){return null==n&&(n={}),n["message-id"]=e,n.subscription=t,this._transmit("ACK",n)}},{key:"nack",value:function(e,t,n){return null==n&&(n={}),n["message-id"]=e,n.subscription=t,this._transmit("NACK",n)}}]),t}();return t}(),s={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(e,t){var n,r;return null==t&&(t=["v10.stomp","v11.stomp"]),n=s.WebSocketClass||WebSocket,r=new n(e,t),new i(r)},over:function(e){return new i(e)},Frame:o,setInterval:function(e,t){return window.setInterval(t,e)},clearInterval:function(e){return window.clearInterval(e)}},t.default=s}])});
//# sourceMappingURL=rabbitMQ.min.js.map